<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>VoicecastingPro - Professional Voice Talent Network</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <script src="https://www.paypal.com/sdk/js?client-id=AXOrnxVTPG4w2eAqaY2KnZKplxouVL3lfU2AWdU-S6U5Waq8CnpUzs9Zdjkkm3I1tdyv4o3XDZPTPLe9&vault=true&intent=subscription"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap');

        :root {
            --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --secondary-gradient: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            --dark-gradient: linear-gradient(135deg, #0c0c0c 0%, #1a1a2e 50%, #16213e 100%);
            --glass-bg: rgba(255, 255, 255, 0.1);
            --glass-border: rgba(255, 255, 255, 0.18);
            --text-primary: #ffffff;
            --text-secondary: #b8c6db;
            --accent-color: #00d4ff;
            --warning-color: #ff6b6b;
            --success-color: #4ecdc4;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html {
            scroll-behavior: smooth;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: var(--dark-gradient);
            color: var(--text-primary);
            overflow-x: hidden;
            line-height: 1.6;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            will-change: scroll-position;
        }

        .text-center { text-align: center; }

        /* Enhanced Animated Background */
        .animated-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            overflow: hidden;
            background: var(--dark-gradient);
        }



        /* Animated Gradient Overlay */
        .gradient-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(45deg, 
                rgba(102, 126, 234, 0.03) 0%, 
                rgba(118, 75, 162, 0.05) 25%, 
                rgba(240, 147, 251, 0.03) 50%, 
                rgba(245, 87, 108, 0.05) 75%, 
                rgba(0, 212, 255, 0.03) 100%);
            animation: gradientShift 20s ease-in-out infinite;
        }

        @keyframes gradientShift {
            0%, 100% { opacity: 0.3; transform: rotate(0deg) scale(1); }
            33% { opacity: 0.5; transform: rotate(120deg) scale(1.1); }
            66% { opacity: 0.4; transform: rotate(240deg) scale(0.9); }
        }

        /* Floating Particles */
        .floating-particles {
            position: absolute;
            width: 100%;
            height: 100%;
        }

        .particle {
            position: absolute;
            border-radius: 50%;
            pointer-events: none;
        }

        .particle-1 {
            width: 4px;
            height: 4px;
            background: rgba(102, 126, 234, 0.6);
            left: 10%;
            animation: float1 15s infinite linear;
        }

        .particle-2 {
            width: 6px;
            height: 6px;
            background: rgba(240, 147, 251, 0.5);
            left: 20%;
            animation: float2 18s infinite linear;
        }

        .particle-3 {
            width: 3px;
            height: 3px;
            background: rgba(0, 212, 255, 0.7);
            left: 30%;
            animation: float3 22s infinite linear;
        }

        .particle-4 {
            width: 5px;
            height: 5px;
            background: rgba(118, 75, 162, 0.6);
            left: 40%;
            animation: float1 20s infinite linear;
            animation-delay: -5s;
        }

        .particle-5 {
            width: 4px;
            height: 4px;
            background: rgba(245, 87, 108, 0.5);
            left: 50%;
            animation: float2 16s infinite linear;
            animation-delay: -8s;
        }

        .particle-6 {
            width: 7px;
            height: 7px;
            background: rgba(102, 126, 234, 0.4);
            left: 60%;
            animation: float3 25s infinite linear;
            animation-delay: -12s;
        }

        .particle-7 {
            width: 3px;
            height: 3px;
            background: rgba(240, 147, 251, 0.6);
            left: 70%;
            animation: float1 19s infinite linear;
            animation-delay: -3s;
        }

        .particle-8 {
            width: 5px;
            height: 5px;
            background: rgba(0, 212, 255, 0.5);
            left: 80%;
            animation: float2 21s infinite linear;
            animation-delay: -10s;
        }

        .particle-9 {
            width: 4px;
            height: 4px;
            background: rgba(118, 75, 162, 0.7);
            left: 90%;
            animation: float3 17s infinite linear;
            animation-delay: -6s;
        }

        .particle-10 {
            width: 6px;
            height: 6px;
            background: rgba(245, 87, 108, 0.4);
            left: 15%;
            animation: float1 23s infinite linear;
            animation-delay: -15s;
        }

        /* Larger Floating Shapes */
        .floating-shapes {
            position: absolute;
            width: 100%;
            height: 100%;
        }

        .shape {
            position: absolute;
            border-radius: 50%;
            animation: floatLarge 30s infinite ease-in-out;
            will-change: transform;
        }

        .shape-1 {
            width: 80px;
            height: 80px;
            background: radial-gradient(circle, rgba(102, 126, 234, 0.1) 0%, rgba(102, 126, 234, 0.05) 70%, transparent 100%);
            left: 5%;
            animation-delay: 0s;
        }

        .shape-2 {
            width: 120px;
            height: 120px;
            background: radial-gradient(circle, rgba(240, 147, 251, 0.08) 0%, rgba(240, 147, 251, 0.03) 70%, transparent 100%);
            left: 85%;
            animation-delay: -10s;
        }

        .shape-3 {
            width: 60px;
            height: 60px;
            background: radial-gradient(circle, rgba(0, 212, 255, 0.12) 0%, rgba(0, 212, 255, 0.06) 70%, transparent 100%);
            left: 45%;
            animation-delay: -20s;
        }

        .shape-4 {
            width: 100px;
            height: 100px;
            background: radial-gradient(circle, rgba(118, 75, 162, 0.09) 0%, rgba(118, 75, 162, 0.04) 70%, transparent 100%);
            left: 25%;
            animation-delay: -5s;
        }

        .shape-5 {
            width: 70px;
            height: 70px;
            background: radial-gradient(circle, rgba(245, 87, 108, 0.1) 0%, rgba(245, 87, 108, 0.05) 70%, transparent 100%);
            left: 75%;
            animation-delay: -15s;
        }

        /* Geometric Patterns */
        .geometric-patterns {
            position: absolute;
            width: 100%;
            height: 100%;
        }

        .triangle {
            position: absolute;
            width: 0;
            height: 0;
            animation: rotate 40s linear infinite;
        }

        .triangle-1 {
            border-left: 15px solid transparent;
            border-right: 15px solid transparent;
            border-bottom: 25px solid rgba(102, 126, 234, 0.06);
            left: 15%;
            top: 20%;
            animation-delay: 0s;
        }

        .triangle-2 {
            border-left: 20px solid transparent;
            border-right: 20px solid transparent;
            border-bottom: 35px solid rgba(240, 147, 251, 0.05);
            left: 75%;
            top: 60%;
            animation-delay: -20s;
        }

        .triangle-3 {
            border-left: 12px solid transparent;
            border-right: 12px solid transparent;
            border-bottom: 20px solid rgba(0, 212, 255, 0.07);
            left: 55%;
            top: 80%;
            animation-delay: -10s;
        }

        .square {
            position: absolute;
            background: rgba(118, 75, 162, 0.04);
            animation: pulse 8s ease-in-out infinite;
            border-radius: 3px;
        }

        .square-1 {
            width: 25px;
            height: 25px;
            left: 30%;
            top: 15%;
            animation-delay: 0s;
        }

        .square-2 {
            width: 35px;
            height: 35px;
            left: 80%;
            top: 40%;
            animation-delay: -4s;
        }

        .square-3 {
            width: 20px;
            height: 20px;
            left: 10%;
            top: 70%;
            animation-delay: -2s;
        }

        /* Orbiting Elements */
        .orbit-container {
            position: absolute;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
        }

        .orbit {
            position: absolute;
            border: 1px solid rgba(102, 126, 234, 0.1);
            border-radius: 50%;
            animation: spin 60s linear infinite;
        }

        .orbit-1 {
            width: 300px;
            height: 300px;
            animation-delay: 0s;
        }

        .orbit-2 {
            width: 500px;
            height: 500px;
            animation-delay: -20s;
            animation-duration: 80s;
        }

        .orbit-3 {
            width: 700px;
            height: 700px;
            animation-delay: -40s;
            animation-duration: 100s;
        }

        .orbit-dot {
            position: absolute;
            width: 8px;
            height: 8px;
            background: rgba(0, 212, 255, 0.6);
            border-radius: 50%;
            top: -4px;
            left: 50%;
            transform: translateX(-50%);
        }

        /* Pulsing Elements */
        .pulse-elements {
            position: absolute;
            width: 100%;
            height: 100%;
        }

        .pulse-dot {
            position: absolute;
            border-radius: 50%;
            animation: pulseDot 4s ease-in-out infinite;
        }

        .pulse-dot-1 {
            width: 6px;
            height: 6px;
            background: rgba(102, 126, 234, 0.8);
            left: 20%;
            top: 30%;
            animation-delay: 0s;
        }

        .pulse-dot-2 {
            width: 8px;
            height: 8px;
            background: rgba(240, 147, 251, 0.7);
            left: 60%;
            top: 25%;
            animation-delay: -1s;
        }

        .pulse-dot-3 {
            width: 5px;
            height: 5px;
            background: rgba(0, 212, 255, 0.9);
            left: 85%;
            top: 70%;
            animation-delay: -2s;
        }

        .pulse-dot-4 {
            width: 7px;
            height: 7px;
            background: rgba(245, 87, 108, 0.6);
            left: 35%;
            top: 75%;
            animation-delay: -3s;
        }

        /* Wave Effect */
        .wave-container {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 200px;
            overflow: hidden;
        }

        .wave {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 200%;
            height: 100px;
            background: linear-gradient(90deg, 
                transparent 0%, 
                rgba(102, 126, 234, 0.03) 25%, 
                rgba(240, 147, 251, 0.05) 50%, 
                rgba(0, 212, 255, 0.03) 75%, 
                transparent 100%);
            border-radius: 50% 50% 0 0;
            animation: wave 20s ease-in-out infinite;
        }

        .wave-2 {
            animation-delay: -10s;
            animation-duration: 25s;
            opacity: 0.5;
            height: 80px;
        }

        /* Animation Keyframes */
        @keyframes float1 {
            0% { 
                transform: translate3d(0, 100vh, 0); 
                opacity: 0; 
            }
            10% { 
                opacity: 1; 
            }
            90% { 
                opacity: 1; 
            }
            100% { 
                transform: translate3d(20px, -100px, 0); 
                opacity: 0; 
            }
        }

        @keyframes float2 {
            0% { 
                transform: translate3d(0, 100vh, 0) rotate(0deg); 
                opacity: 0; 
            }
            10% { 
                opacity: 1; 
            }
            90% { 
                opacity: 1; 
            }
            100% { 
                transform: translate3d(-15px, -100px, 0) rotate(360deg); 
                opacity: 0; 
            }
        }

        @keyframes float3 {
            0% { 
                transform: translate3d(0, 100vh, 0) scale(0.5); 
                opacity: 0; 
            }
            10% { 
                opacity: 1; 
                transform: translate3d(0, 90vh, 0) scale(1); 
            }
            50% { 
                transform: translate3d(30px, 50vh, 0) scale(1.2); 
            }
            90% { 
                opacity: 1; 
                transform: translate3d(-10px, 10vh, 0) scale(0.8); 
            }
            100% { 
                transform: translate3d(10px, -100px, 0) scale(0.5); 
                opacity: 0; 
            }
        }

        @keyframes floatLarge {
            0%, 100% { 
                transform: translate3d(0, 100vh, 0) scale(1); 
                opacity: 0; 
            }
            10% { 
                opacity: 0.6; 
            }
            50% { 
                transform: translate3d(50px, 50vh, 0) scale(1.1); 
                opacity: 0.8; 
            }
            90% { 
                opacity: 0.6; 
            }
        }

        @keyframes rotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        @keyframes spin {
            from { transform: translate(-50%, -50%) rotate(0deg); }
            to { transform: translate(-50%, -50%) rotate(360deg); }
        }

        @keyframes pulse {
            0%, 100% { 
                transform: scale(1); 
                opacity: 0.4; 
            }
            50% { 
                transform: scale(1.5); 
                opacity: 0.8; 
            }
        }

        @keyframes pulseDot {
            0%, 100% { 
                transform: scale(1); 
                opacity: 0.6; 
                box-shadow: 0 0 0 0 currentColor; 
            }
            50% { 
                transform: scale(1.3); 
                opacity: 1; 
                box-shadow: 0 0 0 10px transparent; 
            }
        }

        @keyframes wave {
            0%, 100% { 
                transform: translateX(-25%) translateY(0); 
            }
            50% { 
                transform: translateX(-75%) translateY(-20px); 
            }
        }

        /* Interactive Cursor */
        .interactive-cursor {
            position: fixed;
            width: 20px;
            height: 20px;
            background: radial-gradient(circle, rgba(0, 212, 255, 0.3) 0%, transparent 70%);
            border-radius: 50%;
            pointer-events: none;
            transform: translate(-50%, -50%);
            z-index: 9999;
            transition: all 0.1s ease;
            opacity: 0;
        }

        /* Navigation */
        .navbar {
            position: fixed;
            top: 0;
            width: 100%;
            background: rgba(0, 0, 0, 0.95);
            border-bottom: 1px solid var(--glass-border);
            z-index: 1000;
            transition: all 0.2s ease;
            will-change: transform;
            backdrop-filter: blur(20px);
        }

        .navbar.scrolled {
            background: rgba(0, 0, 0, 0.98);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        }

        .nav-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 1rem 2rem;
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .logo {
            font-size: 1.6rem;
            font-weight: 800;
            background: var(--primary-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            position: relative;
            cursor: pointer;
            flex-shrink: 0;
            min-width: 180px;
        }

        .logo::after {
            content: '';
            position: absolute;
            bottom: -5px;
            left: 0;
            width: 100%;
            height: 2px;
            background: var(--primary-gradient);
            transform: scaleX(0);
            transition: transform 0.3s ease;
        }

        .logo:hover::after {
            transform: scaleX(1);
        }

        .nav-links {
            display: flex;
            list-style: none;
            gap: 2rem;
            align-items: center;
            flex: 1;
            justify-content: center;
            margin: 0 1rem;
        }

        .nav-link {
            color: var(--text-secondary);
            text-decoration: none;
            font-weight: 500;
            position: relative;
            transition: all 0.3s ease;
            cursor: pointer;
            white-space: nowrap;
        }

        .nav-link:hover {
            color: var(--text-primary);
            transform: translateY(-2px);
        }

        .nav-link::after {
            content: '';
            position: absolute;
            bottom: -5px;
            left: 50%;
            width: 0;
            height: 2px;
            background: var(--accent-color);
            transition: all 0.3s ease;
            transform: translateX(-50%);
        }

        .nav-link:hover::after {
            width: 100%;
        }

        .nav-cta {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.1), rgba(255, 255, 255, 0.05));
            border: 1px solid rgba(255, 255, 255, 0.15);
            color: white;
            padding: 0.7rem 1.5rem;
            border-radius: 25px;
            text-decoration: none;
            font-weight: 600;
            font-size: 0.9rem;
            letter-spacing: 0.3px;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            white-space: nowrap;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            position: relative;
            overflow: hidden;
            cursor: pointer;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(20px);
        }

        .nav-cta::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.6s ease;
        }

        .nav-cta:hover::before {
            left: 100%;
        }

        .nav-cta:hover {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.2), rgba(255, 255, 255, 0.1));
            border-color: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
        }

        .nav-cta-icon {
            width: 14px;
            height: 14px;
            background: var(--accent-color);
            border-radius: 50%;
            position: relative;
            flex-shrink: 0;
            box-shadow: 0 0 10px rgba(0, 212, 255, 0.3);
        }

        .nav-cta-icon::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 6px;
            height: 6px;
            background: white;
            border-radius: 50%;
            transform: translate(-50%, -50%);
        }

        .nav-cta-icon.white {
            background: white;
            box-shadow: 0 0 10px rgba(255, 255, 255, 0.3);
        }

        .nav-cta-icon.white::after {
            background: var(--accent-color);
        }

        .nav-auth {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            flex-shrink: 0;
            min-width: 320px;
            justify-content: flex-end;
        }

        .nav-signin {
            background: transparent;
            border: 1px solid rgba(255, 255, 255, 0.15);
            color: var(--text-primary);
            padding: 0.7rem 1.5rem;
            border-radius: 25px;
            text-decoration: none;
            font-weight: 600;
            font-size: 0.9rem;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            cursor: pointer;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            backdrop-filter: blur(20px);
        }

        .nav-signin:hover {
            background: rgba(255, 255, 255, 0.08);
            border-color: var(--accent-color);
            color: var(--accent-color);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
        }

        body.menu-open {
            overflow: hidden;
            position: fixed;
            width: 100%;
        }

        /* Mobile Menu */
        .mobile-menu-toggle {
            display: none;
            background: none;
            border: none;
            color: var(--text-primary);
            font-size: 1.5rem;
            cursor: pointer;
            padding: 0.5rem;
        }

        .mobile-menu {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100vh;
            background: rgba(0, 0, 0, 0.95);
            z-index: 1001;
            padding-top: 80px;
            backdrop-filter: blur(20px);
        }

        .mobile-menu.active {
            display: block;
        }

        .mobile-menu-content {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 2rem;
            padding: 2rem;
        }

        .mobile-menu .nav-link {
            font-size: 1.3rem;
            color: var(--text-primary);
            text-decoration: none;
            padding: 1rem 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            width: 100%;
            text-align: center;
        }

        .mobile-menu .nav-cta {
            margin-top: 1rem;
            padding: 1rem 2rem;
            font-size: 1.1rem;
            justify-content: center;
            width: 200px;
        }

        .mobile-menu .nav-signin {
            margin-top: 0.5rem;
            padding: 0.8rem 2rem;
            font-size: 1rem;
            width: 180px;
            text-align: center;
        }

        /* Page System */
        .page {
            display: none;
            min-height: 100vh;
            padding: 8rem 2rem 4rem;
        }

        .page.active {
            display: block;
        }

        .page-container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .page-title {
            font-size: 3rem;
            font-weight: 800;
            text-align: center;
            margin-bottom: 3rem;
            background: var(--primary-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        /* Hero Section */
        .hero {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .hero-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 2rem;
            z-index: 2;
        }

        .hero-badge {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            background: rgba(255, 255, 255, 0.08);
            border: 1px solid var(--glass-border);
            padding: 0.5rem 1.5rem;
            border-radius: 50px;
            margin-bottom: 2rem;
            animation: fadeInUp 1s ease 0.2s both;
            backdrop-filter: blur(20px);
        }

        .hero h1 {
            font-size: clamp(3rem, 8vw, 6rem);
            font-weight: 900;
            margin-bottom: 1.5rem;
            background: linear-gradient(135deg, #ffffff 0%, #b8c6db 50%, #ffffff 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            line-height: 1.1;
            animation: fadeInUp 1s ease 0.4s both;
        }

        .hero-subtitle {
            font-size: 1.4rem;
            color: var(--text-secondary);
            margin-bottom: 3rem;
            max-width: 700px;
            margin-left: auto;
            margin-right: auto;
            font-weight: 400;
            animation: fadeInUp 1s ease 0.6s both;
        }

        .hero-cta {
            display: flex;
            gap: 1.5rem;
            justify-content: center;
            flex-wrap: wrap;
            animation: fadeInUp 1s ease 0.8s both;
        }

        .btn {
            padding: 1rem 2.5rem;
            border: none;
            border-radius: 50px;
            font-weight: 600;
            font-size: 1.1rem;
            cursor: pointer;
            transition: all 0.4s ease;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            position: relative;
            overflow: hidden;
        }

        .btn-primary {
            background: var(--primary-gradient);
            color: white;
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
        }

        .btn-primary:hover {
            transform: translateY(-4px);
            box-shadow: 0 15px 35px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: transparent;
            color: var(--text-primary);
            border: 2px solid var(--glass-border);
            backdrop-filter: blur(20px);
        }

        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.08);
            transform: translateY(-4px);
            box-shadow: 0 10px 25px rgba(255, 255, 255, 0.1);
        }

        /* Glass Card */
        .glass-card {
            background: rgba(255, 255, 255, 0.08);
            border: 1px solid var(--glass-border);
            border-radius: 20px;
            padding: 2.5rem;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            backdrop-filter: blur(20px);
        }

        .glass-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.05), transparent);
            transition: left 0.6s ease;
        }

        .glass-card:hover::before {
            left: 100%;
        }

        .glass-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.2);
            border-color: rgba(255, 255, 255, 0.25);
        }

        /* Features Section */
        .features {
            padding: 8rem 2rem;
            max-width: 1400px;
            margin: 0 auto;
        }

        .section-header {
            text-align: center;
            margin-bottom: 5rem;
        }

        .section-title {
            font-size: 3.5rem;
            font-weight: 800;
            margin-bottom: 1.5rem;
            background: var(--primary-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .section-subtitle {
            font-size: 1.3rem;
            color: var(--text-secondary);
            max-width: 600px;
            margin: 0 auto;
        }

        .features-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 2.5rem;
        }

        .feature-card {
            text-align: center;
            position: relative;
        }

        .feature-icon {
            width: 80px;
            height: 80px;
            margin: 0 auto 2rem;
            background: var(--primary-gradient);
            border-radius: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            color: white;
            position: relative;
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.3);
        }

        .feature-icon::after {
            content: '';
            position: absolute;
            inset: -3px;
            background: var(--primary-gradient);
            border-radius: 23px;
            z-index: -1;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .feature-card:hover .feature-icon::after {
            opacity: 1;
        }

        .feature-card h3 {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 1rem;
            color: var(--text-primary);
        }

        .feature-card p {
            color: var(--text-secondary);
            font-size: 1.1rem;
            line-height: 1.7;
        }

        /* Search Section */
        .search-section {
            margin-bottom: 3rem;
        }

        .search-bar {
            position: relative;
            margin-bottom: 2rem;
        }

        .search-input {
            width: 100%;
            padding: 1rem 1rem 1rem 3rem;
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid var(--glass-border);
            border-radius: 15px;
            color: var(--text-primary);
            font-size: 1.1rem;
            transition: all 0.2s ease;
            backdrop-filter: blur(20px);
        }

        .search-input:focus {
            outline: none;
            border-color: var(--accent-color);
            box-shadow: 0 0 0 4px rgba(0, 212, 255, 0.1);
        }

        .search-icon {
            position: absolute;
            left: 1rem;
            top: 50%;
            transform: translateY(-50%);
            color: var(--accent-color);
            font-size: 1.2rem;
        }

        .filters {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
        }

        .filter-select {
            width: 100%;
            padding: 0.8rem 1rem;
            background: rgba(12, 12, 12, 0.9);
            border: 1px solid rgba(102, 126, 234, 0.3);
            border-radius: 10px;
            color: var(--text-primary);
            font-size: 0.95rem;
            transition: all 0.2s ease;
            appearance: none;
            -webkit-appearance: none;
            -moz-appearance: none;
            background-image: url("data:image/svg+xml;charset=US-ASCII,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 4 5'><path fill='%2300d4ff' d='M2 0L0 2h4zm0 5L0 3h4z'/></svg>");
            background-repeat: no-repeat;
            background-position: right 0.8rem center;
            background-size: 10px;
            padding-right: 2.5rem;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(20px);
        }

        .filter-select:hover {
            border-color: rgba(102, 126, 234, 0.5);
            background: rgba(12, 12, 12, 0.9);
            transform: translateY(-1px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
        }

        .filter-select:focus {
            outline: none;
            border-color: var(--accent-color);
            background: rgba(12, 12, 12, 0.95);
            box-shadow: 0 0 0 3px rgba(0, 212, 255, 0.1);
        }

        .filter-select option {
            background: linear-gradient(135deg, #0c0c0c 0%, #1a1a2e 50%, #16213e 100%) !important;
            color: var(--text-primary) !important;
            padding: 0.8rem !important;
            border: none !important;
            font-weight: 500 !important;
        }

        .filter-select option:hover {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%) !important;
            color: #ffffff !important;
        }

        .filter-select option:checked,
        .filter-select option:focus {
            background: linear-gradient(135deg, #00d4ff 0%, #667eea 100%) !important;
            color: #ffffff !important;
        }

        /* Content Sections */
        .content-section {
            margin-bottom: 4rem;
        }

        .content-section h2 {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 1.5rem;
            color: var(--accent-color);
        }

        .content-section h3 {
            font-size: 1.8rem;
            font-weight: 600;
            margin-bottom: 1rem;
            color: var(--text-primary);
        }

        .content-section p {
            font-size: 1.1rem;
            line-height: 1.7;
            color: var(--text-secondary);
            margin-bottom: 1.5rem;
        }

        .content-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 2rem;
            margin: 2rem 0;
        }

        /* Steps */
        .steps-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 2rem;
            margin: 3rem 0;
        }

        .step-card {
            background: var(--glass-bg);
            border: 1px solid var(--glass-border);
            border-radius: 20px;
            padding: 2rem;
            text-align: center;
            backdrop-filter: blur(20px);
            position: relative;
        }

        .step-number {
            width: 60px;
            height: 60px;
            background: var(--primary-gradient);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            font-weight: 800;
            color: white;
            margin: 0 auto 1.5rem;
        }

        /* FAQ */
        .faq-item {
            background: var(--glass-bg);
            border: 1px solid var(--glass-border);
            border-radius: 15px;
            padding: 1.5rem;
            margin-bottom: 1rem;
            backdrop-filter: blur(20px);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .faq-item:hover {
            border-color: var(--accent-color);
        }

        .faq-question {
            font-weight: 600;
            font-size: 1.1rem;
            color: var(--text-primary);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .faq-answer {
            margin-top: 1rem;
            color: var(--text-secondary);
            line-height: 1.6;
            display: none;
        }

        .faq-item.active .faq-answer {
            display: block;
        }

        .faq-icon {
            transition: transform 0.3s ease;
        }

        .faq-item.active .faq-icon {
            transform: rotate(180deg);
        }

        /* Testimonials */
        .testimonial-card {
            background: var(--glass-bg);
            border: 1px solid var(--glass-border);
            border-radius: 20px;
            padding: 2rem;
            backdrop-filter: blur(20px);
            text-align: center;
        }

        .testimonial-avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: var(--primary-gradient);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            font-weight: 800;
            color: white;
            margin: 0 auto 1.5rem;
        }

        .testimonial-text {
            font-style: italic;
            font-size: 1.1rem;
            line-height: 1.6;
            margin-bottom: 1.5rem;
            color: var(--text-secondary);
        }

        .testimonial-author {
            font-weight: 600;
            color: var(--accent-color);
        }

        /* Forms */
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 2rem;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: var(--text-primary);
        }

        .form-input,
        .form-textarea,
        .form-select {
            width: 100%;
            padding: 1rem 1.2rem;
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid var(--glass-border);
            border-radius: 12px;
            color: var(--text-primary);
            font-size: 1rem;
            transition: all 0.2s ease;
            appearance: none;
            -webkit-appearance: none;
            -moz-appearance: none;
            backdrop-filter: blur(20px);
        }

        .form-select {
            background-image: url("data:image/svg+xml;charset=US-ASCII,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 4 5'><path fill='%23ffffff' d='M2 0L0 2h4zm0 5L0 3h4z'/></svg>");
            background-repeat: no-repeat;
            background-position: right 1rem center;
            background-size: 12px;
            padding-right: 3rem;
        }

        .form-input:focus,
        .form-textarea:focus,
        .form-select:focus {
            outline: none;
            border-color: var(--accent-color);
            box-shadow: 0 0 0 4px rgba(0, 212, 255, 0.1);
        }

        .form-select option {
            background: #1a1a2e !important;
            color: #ffffff !important;
            padding: 0.5rem !important;
            border: none !important;
        }

        .form-select option:hover {
            background: var(--accent-color) !important;
            color: #ffffff !important;
        }

        .form-select option:checked,
        .form-select option:focus {
            background: var(--primary-gradient) !important;
            color: #ffffff !important;
        }

        .form-textarea {
            resize: vertical;
            min-height: 120px;
        }

        /* Signup Steps */
        .signup-step {
            display: none;
        }

        .signup-step.active {
            display: block;
        }

        .step-indicator {
            display: flex;
            justify-content: center;
            margin-bottom: 3rem;
            gap: 1rem;
        }

        .step-dot {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.08);
            border: 2px solid var(--glass-border);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text-secondary);
            font-weight: 600;
            transition: all 0.2s ease;
        }

        .step-dot.active {
            background: var(--primary-gradient);
            border-color: transparent;
            color: white;
        }

        .step-dot.completed {
            background: var(--success-color);
            border-color: transparent;
            color: white;
        }

        .pricing-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 2rem;
            margin: 2rem 0;
        }

        .pricing-card {
            background: var(--glass-bg);
            border: 2px solid var(--glass-border);
            border-radius: 25px;
            padding: 2.5rem 2rem;
            backdrop-filter: blur(20px);
            position: relative;
            overflow: hidden;
            text-align: center;
            transition: all 0.3s ease;
        }

        .pricing-card.recommended {
            border-color: var(--accent-color);
            transform: scale(1.05);
        }

        .pricing-badge {
            position: absolute;
            top: -1px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--secondary-gradient);
            color: white;
            padding: 0.5rem 1.5rem;
            border-radius: 0 0 15px 15px;
            font-weight: 600;
            font-size: 0.9rem;
        }

        .pricing-amount {
            font-size: 3rem;
            font-weight: 900;
            color: var(--accent-color);
            margin: 1.5rem 0 0.5rem;
        }

        .pricing-period {
            color: var(--text-secondary);
            font-size: 1rem;
            margin-bottom: 2rem;
        }

        .pricing-features {
            text-align: left;
            margin-bottom: 2rem;
            list-style: none;
        }

        .pricing-features li {
            display: flex;
            align-items: center;
            gap: 0.8rem;
            margin-bottom: 0.8rem;
            color: var(--text-secondary);
        }

        .pricing-features .check {
            color: var(--success-color);
            font-weight: bold;
        }

        .discount-badge {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background: var(--warning-color);
            color: white;
            padding: 0.3rem 0.8rem;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        /* Notifications */
        .notification {
            position: fixed;
            top: 100px;
            right: 20px;
            background: var(--success-color);
            color: white;
            padding: 1rem 1.5rem;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            z-index: 1001;
            opacity: 0;
            transform: translateX(100%);
            transition: all 0.3s ease;
            backdrop-filter: blur(20px);
        }

        .notification.show {
            opacity: 1;
            transform: translateX(0);
        }

        .notification.error {
            background: var(--warning-color);
        }

        /* Progress Bar */
        .progress-bar {
            width: 100%;
            height: 6px;
            background: rgba(255, 255, 255, 0.08);
            border-radius: 3px;
            margin-bottom: 2rem;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: var(--primary-gradient);
            border-radius: 3px;
            transition: width 0.2s ease;
        }

        /* Auth Form Styles */
        .auth-form-container {
            max-width: 450px;
            margin: 0 auto;
        }

        .auth-form {
            background: rgba(255, 255, 255, 0.08);
            border: 1px solid var(--glass-border);
            border-radius: 25px;
            padding: 3rem 2.5rem;
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.2);
            backdrop-filter: blur(20px);
        }

        .auth-form h2 {
            text-align: center;
            margin-bottom: 0.5rem;
            color: var(--text-primary);
            font-size: 2rem;
            font-weight: 700;
        }

        .auth-form-subtitle {
            text-align: center;
            color: var(--text-secondary);
            margin-bottom: 2rem;
            font-size: 1rem;
        }

        .auth-form .form-group {
            margin-bottom: 1.5rem;
        }

        .auth-form .form-input {
            padding: 1.2rem 1.5rem;
            font-size: 1rem;
            border-radius: 15px;
        }

        .auth-form .btn {
            width: 100%;
            padding: 1.3rem;
            margin-bottom: 1.5rem;
            border-radius: 15px;
            font-size: 1.1rem;
            font-weight: 600;
        }

        .auth-divider {
            text-align: center;
            margin: 2rem 0;
            position: relative;
            color: var(--text-secondary);
        }

        .auth-divider::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 0;
            right: 0;
            height: 1px;
            background: var(--glass-border);
            z-index: 1;
        }

        .auth-divider span {
            background: var(--dark-gradient);
            padding: 0 1rem;
            position: relative;
            z-index: 2;
        }

        .auth-links {
            text-align: center;
            color: var(--text-secondary);
        }

        .auth-links a {
            color: var(--accent-color);
            text-decoration: none;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .auth-links a:hover {
            color: var(--text-primary);
            text-decoration: underline;
        }

        .forgot-password {
            text-align: right;
            margin-bottom: 1.5rem;
        }

        .forgot-password a {
            color: var(--accent-color);
            text-decoration: none;
            font-size: 0.9rem;
            transition: all 0.3s ease;
        }

        .forgot-password a:hover {
            color: var(--text-primary);
            text-decoration: underline;
        }

        /* Password Reset Styles */
        .password-reset-sent {
            background: rgba(78, 205, 196, 0.15);
            border: 1px solid var(--success-color);
            border-radius: 15px;
            padding: 1.5rem;
            margin-bottom: 2rem;
            text-align: center;
        }

        .password-reset-sent .success-icon {
            font-size: 2rem;
            color: var(--success-color);
            margin-bottom: 1rem;
        }

        .password-reset-sent h3 {
            color: var(--success-color);
            margin-bottom: 0.5rem;
        }

        .password-reset-sent p {
            color: var(--text-secondary);
            margin: 0;
        }

  .footer {
    background: rgba(0, 0, 0, 0.9);
    border-top: 1px solid var(--glass-border);
    padding: 4rem 2rem 2rem;
    margin-top: 6rem;
    backdrop-filter: blur(20px);
    position: relative;
    z-index: 1;
    display: block !important;
    visibility: visible !important;
}

        .footer-content {
            max-width: 1400px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 3rem;
            margin-bottom: 3rem;
        }

        .footer-section h4 {
            color: var(--accent-color);
            font-weight: 700;
            margin-bottom: 1.5rem;
            font-size: 1.2rem;
        }

        .footer-link {
            color: var(--text-secondary);
            text-decoration: none;
            display: block;
            margin-bottom: 0.8rem;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .footer-link:hover {
            color: var(--text-primary);
            transform: translateX(5px);
        }

        .footer-bottom {
            max-width: 1400px;
            margin: 0 auto;
            border-top: 1px solid var(--glass-border);
            padding-top: 2rem;
            text-align: center;
            color: var(--text-secondary);
        }

        .footer-logo {
            font-size: 1.5rem;
            font-weight: 800;
            background: var(--primary-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 1rem;
        }

        /* Hover Effects */
        .hover-lift {
            transition: transform 0.3s ease;
        }

       .hover-lift:hover {
            transform: translateY(-5px);
        }

       /* Bio read more functionality - FORCED VERSION */
.talent-bio {
    max-height: 4.8em !important; /* About 3 lines */
    overflow: hidden !important;
    transition: max-height 0.3s ease !important;
    margin: 0 !important;
    line-height: 1.6 !important;
}

.talent-bio.expanded {
    max-height: none !important;
}

.project-description {
    max-height: 4.8em !important; /* About 3 lines */
    overflow: hidden !important;
    transition: max-height 0.3s ease !important;
    margin: 0 !important;
}

.project-description.expanded {
    max-height: none !important;
}

.read-more-btn {
    transition: color 0.2s ease !important;
}

.read-more-btn:hover {
    color: var(--text-primary) !important;
}


        /* Animations */
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(40px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes pulseAnimation {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .pulse {
            animation: pulseAnimation 2s infinite;
        }

        /* Loading States */
        .loading {
            pointer-events: none;
            opacity: 0.7;
        }

        .loading::after {
            content: '';
            display: inline-block;
            width: 16px;
            height: 16px;
            border: 2px solid #ffffff;
            border-radius: 50%;
            border-top-color: transparent;
            animation: spin 1s linear infinite;
            margin-left: 8px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Bio read more functionality */
        .talent-bio {
            max-height: 4.8em; /* About 3 lines */
            overflow: hidden;
            transition: max-height 0.3s ease;
            margin: 0;
        }

        .talent-bio.expanded {
            max-height: none;
        }

.project-description {
    max-height: 4.8em; /* About 3 lines */
    overflow: hidden;
    transition: max-height 0.3s ease;
    margin: 0;
}

.project-description.expanded {
    max-height: none;
}
        .read-more-btn {
            transition: color 0.2s ease;
        }

        .read-more-btn:hover {
            color: var(--text-primary) !important;
        }

        /* Responsive adjustments for animations */
        @media (max-width: 768px) {
            .orbit-1, .orbit-2, .orbit-3 {
                display: none;
            }
            
            .shape {
                transform: scale(0.7);
            }
            
            .triangle, .square {
                transform: scale(0.8);
            }
            
            .wave-container {
                height: 100px;
            }

            .nav-links {
                display: none;
            }

            .mobile-menu-toggle {
                display: block;
            }

            .nav-container {
                padding: 1rem;
                gap: 0.5rem;
                justify-content: space-between;
            }

            .logo {
                font-size: 1.4rem;
                min-width: 150px;
            }

            .nav-auth {
                gap: 0.5rem;
                min-width: auto;
            }

            .nav-cta {
                padding: 0.5rem 1rem;
                font-size: 0.8rem;
                border-radius: 20px;
                margin-right: 0.3rem;
            }

            .nav-cta span {
                display: none;
            }

            .nav-signin {
                padding: 0.5rem 1rem;
                font-size: 0.8rem;
                border-radius: 20px;
            }

            .nav-signin span {
                display: none;
            }

            .hero {
                padding: 2rem 1rem;
            }

            .hero h1 {
                font-size: 2.5rem;
                line-height: 1.2;
            }

            .hero-subtitle {
                font-size: 1.1rem;
                padding: 0 1rem;
            }

            .hero-cta {
                flex-direction: column;
                align-items: center;
                gap: 1rem;
            }

            .btn {
                width: 100%;
                max-width: 280px;
                justify-content: center;
            }

            .section-title {
                font-size: 2.5rem;
            }

            .features {
                padding: 4rem 1rem;
            }

            .features-grid {
                grid-template-columns: 1fr;
                gap: 1.5rem;
            }

            .form-grid {
                grid-template-columns: 1fr;
            }

            .page-container {
                padding: 0 1rem;
            }

            .glass-card {
                padding: 1.5rem;
            }

            .auth-form {
                padding: 2rem 1.5rem;
                margin: 0 1rem;
            }

            .auth-form-container {
                max-width: 100%;
            }

            .pricing-cards {
                grid-template-columns: 1fr;
                gap: 1.5rem;
            }

            .pricing-card.recommended {
                transform: none;
            }

            .footer-content {
                grid-template-columns: repeat(2, 1fr);
                gap: 2rem;
            }

            .steps-container {
                grid-template-columns: 1fr;
            }

            .content-grid {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 480px) {
            .logo {
                font-size: 1.2rem;
                min-width: 130px;
            }

            .nav-container {
                padding: 0.8rem;
            }

            .nav-cta {
                padding: 0.4rem 0.8rem;
                font-size: 0.75rem;
                border-radius: 15px;
            }

            .nav-signin {
                padding: 0.4rem 0.8rem;
                font-size: 0.75rem;
                border-radius: 15px;
            }

            .hero h1 {
                font-size: 2rem;
            }

            .hero-subtitle {
                font-size: 1rem;
            }

            .section-title {
                font-size: 2rem;
            }

            .page-title {
                font-size: 2rem;
            }

            .glass-card {
                padding: 1rem;
                border-radius: 15px;
            }

            .auth-form {
                padding: 1.5rem 1rem;
                border-radius: 20px;
            }

            .auth-form h2 {
                font-size: 1.8rem;
            }

            .form-input,
            .form-textarea,
            .form-select {
                padding: 0.8rem 1rem;
            }

            .btn {
                padding: 0.8rem 1.5rem;
                font-size: 1rem;
            }

            .pricing-amount {
                font-size: 2.5rem;
            }

            .footer-content {
                grid-template-columns: 1fr;
                text-align: center;
            }

            .footer {
                padding: 3rem 1rem 2rem;
            }

            .mobile-menu-content {
                padding: 1rem;
            }

            .mobile-menu .nav-link {
                font-size: 1.1rem;
                padding: 0.8rem 0;
            }

            .mobile-menu .nav-cta {
                margin-top: 0.5rem;
                padding: 0.8rem 1.5rem;
                font-size: 1rem;
                justify-content: center;
                width: 200px;
            }

            .mobile-menu .nav-cta span {
                display: inline;
            }

            .mobile-menu .nav-signin {
                margin-top: 0.5rem;
                padding: 0.8rem 1.5rem;
                font-size: 1rem;
                width: 180px;
                text-align: center;
            }

            .mobile-menu .nav-signin span {
                display: inline;
            }
        }

/* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.3);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--primary-gradient);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--secondary-gradient);
        }

       /* Message delete animation */
        @keyframes fadeOut {
            from {
                opacity: 1;
                transform: scale(1);
            }
            to {
                opacity: 0;
                transform: scale(0.95);
            }
        }

        /* Policy alert animations */
        @keyframes slideInRight {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        @keyframes bounceIn {
            0% {
                transform: translate(-50%, -50%) scale(0.3);
                opacity: 0;
            }
            50% {
                transform: translate(-50%, -50%) scale(1.05);
            }
            70% {
                transform: translate(-50%, -50%) scale(0.9);
            }
            100% {
                transform: translate(-50%, -50%) scale(1);
                opacity: 1;
            }
        }

        /* Enhanced message input validation styles */
        #message-input.has-violations {
            border-color: var(--warning-color) !important;
            box-shadow: 0 0 0 3px rgba(255, 107, 107, 0.2) !important;
        }

        .validation-highlight {
            background: rgba(255, 107, 107, 0.2) !important;
            border-radius: 3px;
            padding: 0 2px;
        }

   /* Ensure all clickable elements have pointer cursor */
        [onclick], button, .btn, .nav-link, .nav-cta, .nav-signin, .footer-link {
            cursor: pointer !important;
        }

        /* Back to Top Button Styles */
        #back-to-top:hover {
            transform: translateY(15px) scale(1.1);
            box-shadow: 0 12px 35px rgba(102, 126, 234, 0.4);
            background: var(--secondary-gradient);
        }

     #back-to-top.show {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }

        /* Mobile responsiveness for back to top */
        @media (max-width: 768px) {
            #back-to-top {
                bottom: 20px;
                right: 20px;
                width: 50px;
                height: 50px;
                font-size: 1.2rem;
            }
        }
    </style>
</head>
<body>
    <!-- Enhanced Animated Background -->
    <div class="animated-bg">
        <!-- Animated Gradient Overlay -->
        <div class="gradient-overlay"></div>

        <!-- Floating Particles -->
        <div class="floating-particles">
            <div class="particle particle-1"></div>
            <div class="particle particle-2"></div>
            <div class="particle particle-3"></div>
            <div class="particle particle-4"></div>
            <div class="particle particle-5"></div>
            <div class="particle particle-6"></div>
            <div class="particle particle-7"></div>
            <div class="particle particle-8"></div>
            <div class="particle particle-9"></div>
            <div class="particle particle-10"></div>
        </div>

        <!-- Larger Floating Shapes -->
        <div class="floating-shapes">
            <div class="shape shape-1"></div>
            <div class="shape shape-2"></div>
            <div class="shape shape-3"></div>
            <div class="shape shape-4"></div>
            <div class="shape shape-5"></div>
        </div>

        <!-- Geometric Patterns -->
        <div class="geometric-patterns">
            <div class="triangle triangle-1"></div>
            <div class="triangle triangle-2"></div>
            <div class="triangle triangle-3"></div>
            <div class="square square-1"></div>
            <div class="square square-2"></div>
            <div class="square square-3"></div>
        </div>

        <!-- Orbiting Elements -->
        <div class="orbit-container">
            <div class="orbit orbit-1">
                <div class="orbit-dot"></div>
            </div>
            <div class="orbit orbit-2">
                <div class="orbit-dot"></div>
            </div>
            <div class="orbit orbit-3">
                <div class="orbit-dot"></div>
            </div>
        </div>

        <!-- Pulsing Elements -->
        <div class="pulse-elements">
            <div class="pulse-dot pulse-dot-1"></div>
            <div class="pulse-dot pulse-dot-2"></div>
            <div class="pulse-dot pulse-dot-3"></div>
            <div class="pulse-dot pulse-dot-4"></div>
        </div>

        <!-- Wave Effect -->
        <div class="wave-container">
            <div class="wave"></div>
            <div class="wave wave-2"></div>
        </div>
    </div>

    <!-- Interactive Cursor -->
    <div class="interactive-cursor" id="cursor"></div>

    <!-- Navigation -->
    <nav class="navbar" id="navbar">
        <div class="nav-container">
            <div class="logo" onclick="showPage('home'); return false;" style="cursor: pointer;">VoicecastingPro</div>
           <ul class="nav-links">
    <li><a class="nav-link" href="#" onclick="showPage('home'); return false;">Home</a></li>
    <li><a class="nav-link" href="#" onclick="showPage('browse-talent'); return false;">Browse Talent</a></li>
    <li><a class="nav-link" href="#" onclick="showPage('projects'); return false;">Projects</a></li>
  <li id="post-project-nav" style="display: none;"><a class="nav-link" href="#" onclick="checkAuthAndPostProject(); return false;">Post Project</a></li>
    <li><a class="nav-link" href="#" onclick="showPage('messages'); return false;">Messages</a></li>
    <li><a class="nav-link" href="#" onclick="showPage('pricing'); return false;">Pricing</a></li>
    <li><a class="nav-link" href="#" onclick="showPage('help-center'); return false;">Help</a></li>
    <li><a class="nav-link" href="#" onclick="showPage('account-settings'); return false;">Settings</a></li>
</ul>
            <div class="nav-auth" id="nav-auth">
                <div class="nav-signin" onclick="showPage('signin')" id="nav-signin-btn">
                    <i class="fas fa-sign-in-alt"></i>
                    <span>Sign In</span>
                </div>
                <div class="nav-cta" onclick="showPage('client-signup')" style="margin-right: 0.5rem;" id="nav-client-btn">
                    <div class="nav-cta-icon white"></div>
                    <span>Join as Client</span>
                </div>
                <div class="nav-cta" onclick="showPage('talent-signup')" id="nav-talent-btn">
    <div class="nav-cta-icon"></div>
    <span>Join as Talent</span>
</div>
                <button class="mobile-menu-toggle" onclick="toggleMobileMenu()">
                    <i class="fas fa-bars" id="menu-icon"></i>
                </button>
            </div>
        </div>
    </nav>

    <!-- Mobile Menu -->
<div class="mobile-menu" id="mobile-menu">
    <div class="mobile-menu-content">
        <!-- Content will be dynamically updated by updateMobileMenuContent() -->
    </div>
</div>

    <!-- Notification -->
    <div class="notification" id="notification"></div>

    <!-- Talent Contact Modal -->
    <div id="talent-contact-modal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.8); z-index: 1002; backdrop-filter: blur(10px);">
        <div style="display: flex; align-items: center; justify-content: center; height: 100%; padding: 2rem;">
            <div class="glass-card" style="max-width: 600px; width: 100%; margin: 0 1rem;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                    <h3 style="color: var(--accent-color); margin: 0;">Contact Voice Talent</h3>
                    <button onclick="closeTalentContactModal()" style="background: none; border: none; color: var(--text-secondary); font-size: 1.5rem; cursor: pointer;">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                
                <div id="talent-contact-info" style="background: rgba(102, 126, 234, 0.1); border-radius: 10px; padding: 1rem; margin-bottom: 1.5rem;">
                    <!-- Talent info will be populated here -->
                </div>

                <form id="talent-contact-form">
<div class="form-group">
    <label class="form-label">Deadline</label>
    <input type="date" name="deadline" class="form-input" required min="" id="project-deadline-input">
    <small style="color: var(--text-secondary); font-size: 0.9rem; display: block; margin-top: 0.5rem;">
        When should the voice over work be completed?
    </small>
</div>

                    <div class="form-group">
                        <label class="form-label">Job Post Expiration</label>
                        <select name="jobExpiration" class="form-select" required>
                            <option value="7">7 days (Rush jobs)</option>
                            <option value="14">14 days (Quick turnaround)</option>
                            <option value="30" selected>30 days (Standard)</option>
                            <option value="60">60 days (Extended posting)</option>
                            <option value="90">90 days (Long-term projects)</option>
                        </select>
                        <small style="color: var(--text-secondary); font-size: 0.9rem; display: block; margin-top: 0.5rem;">
                            How long should this job posting remain visible? After this time, the post will be automatically removed.
                        </small>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Your Contact Email</label>
                        <input type="email" name="clientEmail" class="form-input" placeholder="your@email.com" required>
                    </div>

                <div class="form-group">
    <label class="form-label">Your Message *</label>
    <textarea name="coverLetter" class="form-textarea" rows="5" placeholder="Describe your project, timeline, budget, and any specific requirements..." required></textarea>
</div>

                    <div class="form-group">
                        <label class="form-label">Project Budget (Optional)</label>
                        <select name="budget" class="form-select">
                            <option value="">Select budget range</option>
                            <option value="under-500">Under $500</option>
                            <option value="500-1000">$500 - $1,000</option>
                            <option value="1000-2500">$1,000 - $2,500</option>
                            <option value="2500-5000">$2,500 - $5,000</option>
                            <option value="5000+">$5,000+</option>
                        </select>
                    </div>

                    <div style="display: flex; gap: 1rem;">
                        <button type="button" class="btn btn-secondary" style="flex: 1;" onclick="closeTalentContactModal()">
                            <i class="fas fa-times"></i>
                            Cancel
                        </button>
                 <button type="submit" class="btn btn-primary" style="flex: 2;">
                            <i class="fas fa-paper-plane"></i>
                            Send Message & Setup Payment
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Sign In Page -->
    <div id="signin" class="page">
        <div class="page-container">
            <div class="auth-form-container">
                <div class="auth-form">
                    <h2>Welcome Back</h2>
                    <p class="auth-form-subtitle">Sign in to your VoicecastingPro account</p>
                    
                    <form id="signin-form">
                        <div class="form-group">
                            <label class="form-label">Email Address</label>
                            <input type="email" name="email" class="form-input" placeholder="your@email.com" required>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Password</label>
                            <input type="password" name="password" class="form-input" placeholder="Enter your password" required>
                        </div>

                        <div class="forgot-password">
                            <a href="#" onclick="showPasswordReset(); return false;">Forgot password?</a>
                        </div>

                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-sign-in-alt"></i>
                            Sign In
                        </button>
                    </form>

                    <div class="auth-divider">
                        <span>or</span>
                    </div>

                    <div class="auth-links">
                        <p>Don't have an account?</p>
                        <div style="display: flex; gap: 1rem; margin-top: 1rem; flex-wrap: wrap;">
                            <a href="#" onclick="showPage('client-signup'); return false;" class="btn btn-secondary" style="flex: 1; min-width: 150px; text-align: center; padding: 0.8rem 1rem; text-decoration: none;">
                                <i class="fas fa-briefcase"></i>
                                Join as Client
                            </a>
                            <a href="#" onclick="showPage('talent-signup'); return false;" class="btn btn-secondary" style="flex: 1; min-width: 150px; text-align: center; padding: 0.8rem 1rem; text-decoration: none;">
                                <i class="fas fa-microphone"></i>
                                Join as Talent
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Client Signup Page -->
    <div id="client-signup" class="page">
        <div class="page-container">
            <div class="auth-form-container">
                <div class="auth-form">
                    <h2>Join as Client</h2>
                    <p class="auth-form-subtitle">Create your free account to post projects and hire voice talent</p>
                    
                    <form id="client-signup-form">
                        <div class="form-grid">
                            <div class="form-group">
                                <label class="form-label">First Name *</label>
                                <input type="text" name="firstName" class="form-input" placeholder="Your first name" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Last Name *</label>
                                <input type="text" name="lastName" class="form-input" placeholder="Your last name" required>
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Email Address *</label>
                            <input type="email" name="email" class="form-input" placeholder="your@email.com" required>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Password *</label>
                            <input type="password" name="password" class="form-input" placeholder="Create a secure password" required>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Confirm Password *</label>
                            <input type="password" name="confirmPassword" class="form-input" placeholder="Confirm your password" required>
                        </div>

                        <div style="margin-bottom: 1.5rem;">
                            <label style="display: flex; align-items: center; gap: 0.5rem; color: var(--text-secondary); font-size: 0.9rem;">
                                <input type="checkbox" required style="margin: 0;">
                                I agree to the <a href="#" onclick="showPage('terms-of-service'); return false;" style="color: var(--accent-color);">Terms of Service</a> and <a href="#" onclick="showPage('privacy-policy'); return false;" style="color: var(--accent-color);">Privacy Policy</a>
                            </label>
                        </div>

                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-user-plus"></i>
                            Create Free Account
                        </button>
                    </form>

                    <div class="auth-divider">
                        <span>or</span>
                    </div>

                    <div class="auth-links">
                        <p>Already have an account? <a href="#" onclick="showPage('signin'); return false;">Sign In</a></p>
                        <p style="margin-top: 1rem;">Are you a voice talent? <a href="#" onclick="showPage('talent-signup'); return false;">Join as Voice Talent</a></p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Password Reset Page -->
    <div id="password-reset" class="page">
        <div class="page-container">
            <div class="auth-form-container">
                <div class="auth-form">
                    <h2>Reset Password</h2>
                    <p class="auth-form-subtitle">Enter your email to receive reset instructions</p>
                    
                    <div id="reset-success" class="password-reset-sent" style="display: none;">
                        <div class="success-icon">
                            <i class="fas fa-check-circle"></i>
                        </div>
                        <h3>Check Your Email</h3>
                        <p>We've sent password reset instructions to your email address.</p>
                        <div style="margin-top: 1rem; padding: 1rem; background: rgba(0, 212, 255, 0.1); border-radius: 10px; font-size: 0.9rem;">
                            <strong> Important:</strong> Click the link in your email to set a new password. The link will bring you back to this site automatically.
                        </div>
                    </div>
                    
                    <form id="password-reset-form">
                        <div class="form-group">
                            <label class="form-label">Email Address</label>
                            <input type="email" name="reset-email" class="form-input" placeholder="your@email.com" required>
                        </div>

                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-paper-plane"></i>
                            Send Reset Link
                        </button>
                    </form>

                    <div class="auth-divider">
                        <span>or</span>
                    </div>

                    <div class="auth-links">
                        <p>Remember your password? <a href="#" onclick="showPage('signin'); return false;">Sign In</a></p>
                        <p style="margin-top: 1rem;">New to VoicecastingPro? <a href="#" onclick="showPage('talent-signup'); return false;">Join as Voice Talent</a></p>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- Home Page -->
    <div id="home" class="page active">
        <!-- Hero Section -->
        <section class="hero">
            <div class="hero-content">
                <div class="hero-badge">
                    <i class="fas fa-star"></i>
                    <span>Premium Voice Talent Network</span>
                </div>
        <h1>Direct Voice Talent<br>Connections</h1>
<p class="hero-subtitle">
    No middlemen, no commissions. Talent keeps 100% of their fees with a simple subscription. Clients post projects free.
</p>
                <div class="hero-cta">
                    <div class="btn btn-primary" onclick="showPage('browse-talent')">
                        <i class="fas fa-search"></i>
                        Browse Talent
                    </div>
   <div class="btn btn-secondary" onclick="showPage('account-type-selection')">
    <i class="fas fa-user-plus"></i>
    Start Free Profile Setup
</div>
                </div>
            </div>
        </section>

        <!-- Features Section -->
        <section class="features">
            <div class="section-header">
                <h2 class="section-title">Why Choose VoicecastingPro?</h2>
                <p class="section-subtitle">                <p class="section-subtitle">Our platform makes professional voice casting simple: easy-to-use, responsive help, and great results.
</p>
            </div>
            <div class="features-grid">
                <div class="feature-card glass-card hover-lift">
                    <div class="feature-icon">
                        <i class="fas fa-microphone-alt"></i>
                    </div>
 <h3>Professional Voice Talent</h3>
<p>Access experienced voice actors with diverse skills, languages, and specializations ready to bring your projects to life.</p>
                </div>
                <div class="feature-card glass-card hover-lift">
                    <div class="feature-icon">
                        <i class="fas fa-brain"></i>
                    </div>
<h3>Smart Filtering</h3>
<p>Advanced search and filtering tools help you quickly find the perfect voice talent for your specific project needs.</p>
                </div>
                <div class="feature-card glass-card hover-lift">
                    <div class="feature-icon">
                        <i class="fas fa-shield-alt"></i>
                    </div>
                    <h3>Secure & Reliable</h3>
                    <p>Enterprise-grade security, encrypted payments, and guaranteed project delivery with our comprehensive protection system.</p>
                </div>
                <div class="feature-card glass-card hover-lift">
                    <div class="feature-icon">
                        <i class="fas fa-rocket"></i>
                    </div>
                    <h3>Lightning Fast</h3>
                    <p>Get professional voice overs delivered faster than ever with our streamlined workflow and priority support system.</p>
                </div>
                <div class="feature-card glass-card hover-lift">
                    <div class="feature-icon">
                        <i class="fas fa-globe"></i>
                    </div>
                    <h3>Global Network</h3>
                    <p>Connect with native speakers in 50+ languages and dialects from every corner of the world, available 24/7.</p>
                </div>
         <div class="feature-card glass-card hover-lift">
    <div class="feature-icon">
        <i class="fas fa-chart-line"></i>
    </div>
    <h3>Project Management</h3>
    <p>Keep track of your posted projects, manage applications, and communicate directly with talent through our streamlined dashboard.</p>
</div>
            </div>
        </section>
    </div>

    <!-- Browse Talent Page -->
    <div id="browse-talent" class="page">
        <div class="page-container">
            <h1 class="page-title">Discover Exceptional Voice Talent</h1>
            
            <div class="search-section">
                <div class="search-bar">
                    <i class="fas fa-search search-icon"></i>
                    <input type="text" class="search-input" placeholder="Search by name, language, or specialty..." id="talent-search">
                </div>
                
                <div class="filters">
                    <select class="filter-select" id="language-filter">
                        <option>All Languages</option>
                        <option>English</option>
                        <option>Spanish</option>
                        <option>French</option>
                        <option>German</option>
                        <option>Japanese</option>
                        <option>Mandarin</option>
                    </select>
                    <select class="filter-select" id="genre-filter">
                        <option>All Genres</option>
                        <option>Commercial</option>
                        <option>Narration</option>
                        <option>Character</option>
                        <option>Animation</option>
                        <option>E-learning</option>
                        <option>Audiobook</option>
                    </select>
                    <select class="filter-select" id="gender-filter">
                        <option>All Genders</option>
                        <option>Male</option>
                        <option>Female</option>
                        <option>Non-binary</option>
                    </select>
                    <select class="filter-select" id="price-filter">
                        <option>Price Range</option>
                        <option>$50-100/hr</option>
                        <option>$100-200/hr</option>
                        <option>$200-300/hr</option>
                        <option>$300+/hr</option>
                    </select>
                </div>
            </div>

            <div class="content-grid" id="talent-grid">
                <!-- Talent cards will be populated by API call -->
            </div>
        </div>
    </div>

    <!-- Projects Page -->
    <div id="projects" class="page">
        <div class="page-container">
            <h1 class="page-title">Available Projects</h1>
            
<!-- Account Access Notice (will be shown/hidden based on status) -->
<div id="subscription-notice" class="glass-card" style="margin-bottom: 2rem; background: rgba(255, 107, 107, 0.1); border-color: var(--warning-color); display: none;">
    <div style="text-align: center;">
        <div style="font-size: 2rem; margin-bottom: 1rem;"></div>
        <h3 style="color: var(--warning-color); margin-bottom: 1rem;" id="access-notice-title">Account Required</h3>
        <p style="color: var(--text-secondary); margin-bottom: 1.5rem;" id="access-notice-text">
            To apply to projects, please sign in or create an account.
        </p>
        <div id="access-notice-buttons">
            <button class="btn btn-primary" onclick="handleProjectsPageAccess()">
                <i class="fas fa-user-plus"></i>
                <span id="subscription-notice-text">Get Access</span>
            </button>
        </div>
    </div>
</div>
            
            <div class="search-section">
                <div class="search-bar">
                    <i class="fas fa-search search-icon"></i>
                    <input type="text" class="search-input" placeholder="Search projects..." id="project-search">
                </div>
            </div>

            <div id="projects-grid">
                <!-- Projects will be populated by API call -->
            </div>
        </div>
    </div>

    <!-- Post Project Page -->
    <div id="post-project" class="page">
        <div class="page-container">
            <h1 class="page-title">Post Your Project</h1>
            
            <!-- Authentication Status Notice -->
            <div id="post-project-auth-notice" class="glass-card" style="margin-bottom: 2rem; background: rgba(78, 205, 196, 0.1); border-color: var(--success-color); text-align: center; display: none;">
                <div style="display: flex; align-items: center; justify-content: center; gap: 0.5rem; color: var(--success-color); font-weight: 600;">
                    <i class="fas fa-check-circle"></i>
                    <span>Welcome back! You're signed in and ready to post projects.</span>
                </div>
            </div>
            
            <div class="glass-card" style="max-width: 800px; margin: 0 auto;">
                <form id="project-form">
                    <div class="form-group">
                        <label class="form-label">Project Title</label>
                        <input type="text" name="title" class="form-input" placeholder="e.g., Commercial Voice Over for Tech Product" required>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Project Description</label>
                        <textarea name="description" class="form-textarea" rows="4" placeholder="Describe your project in detail, including tone, style, and any specific requirements..." required></textarea>
                    </div>

                    <div class="form-grid">
                        <div class="form-group">
                            <label class="form-label">Language</label>
                            <select name="language" class="form-select" required>
                                <option value="">Select Language</option>
                                <option>English</option>
                                <option>Spanish</option>
                                <option>French</option>
                                <option>German</option>
                                <option>Japanese</option>
                                <option>Mandarin</option>
                                <option>Other</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Genre</label>
                            <select name="genre" class="form-select">
                                <option value="">Select Genre</option>
                                <option>Commercial</option>
                                <option>Narration</option>
                                <option>Character</option>
                                <option>Animation</option>
                                <option>E-learning</option>
                                <option>Audiobook</option>
                                <option>Other</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-grid">
                        <div class="form-group">
                            <label class="form-label">Budget Range</label>
                            <select name="budgetRange" class="form-select" required>
                                <option value="">Select Budget</option>
                                <option value="under-100">Under $100</option>
                                <option value="100-300">$100 - $300</option>
                                <option value="300-500">$300 - $500</option>
                                <option value="500-1000">$500 - $1000</option>
                                <option value="1000-2000">$1000 - $2000</option>
                                <option value="2000+">$2000+</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Voice Gender Preference</label>
                            <select name="voiceGender" class="form-select">
                                <option value="">No Preference</option>
                                <option>Male</option>
                                <option>Female</option>
                                <option>Non-binary</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Estimated Duration</label>
                        <select name="estimatedDuration" class="form-select">
                            <option value="">Select Duration</option>
                            <option value="under-30s">Under 30 seconds</option>
                            <option value="30s-2min">30 seconds - 2 minutes</option>
                            <option value="2-10min">2 - 10 minutes</option>
                            <option value="10-60min">10 - 60 minutes</option>
                            <option value="1hour+">1+ hours</option>
                        </select>
                    </div>

                    <div class="form-group">
    <label class="form-label">Deadline</label>
    <input type="date" name="deadline" class="form-input" required>
</div>

<div class="form-group">
    <label class="form-label">Job Post Expiration</label>
    <select name="jobExpiration" class="form-select" required>
        <option value="7">7 days (Rush jobs)</option>
        <option value="14">14 days (Quick turnaround)</option>
        <option value="30" selected>30 days (Standard)</option>
        <option value="60">60 days (Extended posting)</option>
        <option value="90">90 days (Long-term projects)</option>
    </select>
    <small style="color: var(--text-secondary); font-size: 0.9rem; display: block; margin-top: 0.5rem;">
        How long should this job posting remain visible? After this time, the post will be automatically removed.
    </small>
</div>

<div class="form-group">
                            <label class="form-label">Your Contact Email</label>
                            <input type="email" name="clientEmail" class="form-input" placeholder="your@email.com" required>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Payment Protection *</label>
                            <div style="background: rgba(0, 212, 255, 0.1); border-radius: 10px; padding: 1.5rem; margin-bottom: 1rem;">
                                <div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 1rem;">
                                    <i class="fas fa-shield-alt" style="color: var(--accent-color);"></i>
                                    <strong style="color: var(--accent-color);">Secure Payment Protection</strong>
                                </div>
                                <p style="color: var(--text-secondary); margin: 0; font-size: 0.9rem;">
                                    Choose how you want to protect payments. Escrow ensures talent gets paid and you get quality work.
                                </p>
                            </div>
                            <select name="paymentProtection" class="form-select" required>
                                <option value="">Choose Payment Protection</option>
                                <option value="escrow-full">Full Escrow - Pay upfront, funds held until completion  Recommended</option>
                                <option value="escrow-milestone">Milestone Payments - Pay in phases as work progresses</option>
                                <option value="invoice-protected">Protected Invoice - Pay after delivery with dispute protection</option>
                            </select>
                            <small style="color: var(--text-secondary); font-size: 0.9rem; display: block; margin-top: 0.5rem;">
                                 Escrow-protected projects receive 3x more applications from top talent
                            </small>
                        </div>

                        <button type="submit" class="btn btn-primary" style="width: 100%; padding: 1.2rem;">
                            <i class="fas fa-rocket"></i>
                            Post Project with Payment Protection
                        </button>
                </form>
            </div>
        </div>
    </div>


    <!-- Account Type Selection Page -->
    <div id="account-type-selection" class="page">
        <div class="page-container">
            <h1 class="page-title">Choose Your Account Type</h1>
            
            <div style="max-width: 800px; margin: 0 auto; text-align: center;">
                <p style="font-size: 1.2rem; color: var(--text-secondary); margin-bottom: 3rem;">
                    Welcome to VoicecastingPro! Please select how you'd like to use our platform:
                </p>
                
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 2rem; margin-bottom: 2rem;">
                    <!-- Client Option -->
                    <div class="glass-card hover-lift" style="cursor: pointer; transition: all 0.3s ease;" onclick="showPage('client-signup')">
                        <div style="text-align: center; padding: 1rem;">
                         <div style="width: 120px; height: 120px; margin: 0 auto 2rem; background: var(--primary-gradient); border-radius: 50%; display: flex; align-items: center; justify-content: center; box-shadow: 0 15px 35px rgba(102, 126, 234, 0.3); position: relative;">
                                <i class="fas fa-briefcase" style="font-size: 3rem; color: white;"></i>
                                <div style="position: absolute; inset: -3px; background: var(--primary-gradient); border-radius: 50%; z-index: -1; opacity: 0.3;"></div>
                            </div>
                            <h3 style="color: var(--accent-color); margin-bottom: 1rem;">I'm a Client</h3>
                            <p style="color: var(--text-secondary); margin-bottom: 1.5rem; line-height: 1.6;">
                                I need voice talent for my projects. I want to post jobs and hire voice actors.
                            </p>
                            <div style="background: rgba(78, 205, 196, 0.1); border-radius: 10px; padding: 1rem; margin-bottom: 1rem;">
                                <p style="color: var(--success-color); font-weight: 600; margin: 0;">
                                     Completely FREE Forever
                                </p>
                            </div>
                            <ul style="text-align: left; color: var(--text-secondary); margin-bottom: 1.5rem;">
                                <li>Post unlimited projects</li>
                                <li>Browse all voice talent</li>
                                <li>Direct messaging</li>
                                <li>No fees or commissions</li>
                            </ul>
                            <button class="btn btn-primary" style="width: 100%;">
                                <i class="fas fa-briefcase"></i>
                                Start as Client (Free)
                            </button>
                        </div>
                    </div>
                    
                    <!-- Talent Option -->
                    <div class="glass-card hover-lift" style="cursor: pointer; transition: all 0.3s ease;" onclick="showPage('talent-signup')">
                        <div style="text-align: center; padding: 1rem;">
                      <div style="width: 120px; height: 120px; margin: 0 auto 2rem; background: var(--secondary-gradient); border-radius: 50%; display: flex; align-items: center; justify-content: center; box-shadow: 0 15px 35px rgba(240, 147, 251, 0.3); position: relative;">
                                <i class="fas fa-microphone-alt" style="font-size: 3rem; color: white;"></i>
                                <div style="position: absolute; inset: -3px; background: var(--secondary-gradient); border-radius: 50%; z-index: -1; opacity: 0.3;"></div>
                            </div>
                            <h3 style="color: var(--accent-color); margin-bottom: 1rem;">I'm Voice Talent</h3>
                            <p style="color: var(--text-secondary); margin-bottom: 1.5rem; line-height: 1.6;">
                                I'm a voice actor looking for work. I want to apply to projects and get hired.
                            </p>
                            <div style="background: rgba(102, 126, 234, 0.1); border-radius: 10px; padding: 1rem; margin-bottom: 1rem;">
                                <p style="color: var(--accent-color); font-weight: 600; margin: 0;">
                                     Simple Subscription: $35/month
                                </p>
                            </div>
                            <ul style="text-align: left; color: var(--text-secondary); margin-bottom: 1.5rem;">
                                <li>Apply to unlimited projects</li>
                                <li>Featured profile placement</li>
                                <li>Keep 100% of your fees</li>
                                <li>Audio demo hosting</li>
                            </ul>
                            <button class="btn btn-primary" style="width: 100%;">
                                <i class="fas fa-microphone"></i>
                                Start as Talent
                            </button>
                        </div>
                    </div>
                </div>
                
                <div style="text-align: center; margin-top: 2rem; padding: 1rem; background: rgba(0, 212, 255, 0.1); border-radius: 10px;">
                    <p style="color: var(--text-secondary); margin: 0; font-size: 0.9rem;">
                        <strong>Not sure?</strong> You can always change your account type later or create multiple accounts.
                    </p>
                </div>
            </div>
        </div>
    </div>

    <!-- Talent Signup Page -->
    <div id="talent-signup" class="page">
        <div class="page-container">
            <h1 class="page-title">Join as Voice Talent</h1>
            
            <!-- Progress Bar -->
            <div class="progress-bar">
                <div class="progress-fill" id="progress-fill" style="width: 33.33%;"></div>
            </div>
            
            <!-- Step Indicator -->
         <div class="step-indicator">
    <div class="step-dot active" id="step1-dot">1</div>
    <div class="step-dot" id="step2-dot">2</div>
    <div class="step-dot" id="step3-dot">3</div>
</div>

<div style="text-align: center; margin-bottom: 2rem; color: var(--text-secondary); font-size: 0.95rem;">
    <span style="color: var(--accent-color); font-weight: 600;">Profile Setup</span>  
    Demo Upload  
    Choose Plan & Subscribe
</div>

            <!-- Step 1: Profile Setup -->
            <div class="signup-step active" id="step1">
                <div class="glass-card" style="max-width: 800px; margin: 0 auto;">
                    <h3 style="text-align: center; margin-bottom: 2rem; color: var(--accent-color);">Create Your Profile</h3>
                    <p style="text-align: center; color: var(--text-secondary); margin-bottom: 2rem;">
                        Build your professional voice talent profile to showcase your skills and experience.
                    </p>
                    
                    <form id="profile-form">
                        <div class="form-grid">
                            <div class="form-group">
                                <label class="form-label">First Name *</label>
                                <input type="text" name="firstName" class="form-input" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Last Name *</label>
                                <input type="text" name="lastName" class="form-input" required>
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Email Address *</label>
                            <input type="email" name="email" class="form-input" required>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Password *</label>
                            <input type="password" name="password" class="form-input" required>
                        </div>


<div class="form-group">
                            <label class="form-label">Profile Photo (Optional)</label>
                            <input type="file" name="profilePhoto" class="form-input" accept=".jpg,.jpeg,.png,.gif" style="padding: 0.8rem;">
                            <small style="color: var(--text-secondary); font-size: 0.9rem; display: block; margin-top: 0.5rem;">
                                Upload a professional headshot (JPG, PNG, GIF - max 5MB)
                            </small>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Professional Bio *</label>
                            <textarea name="bio" class="form-textarea" rows="4" placeholder="Tell clients about your experience, expertise, and what makes you unique as a voice talent..." required></textarea>
                        </div>

                        <div class="form-grid">
                            <div class="form-group">
                                <label class="form-label">Languages *</label>
                                <input type="text" name="languages" class="form-input" placeholder="e.g., English (Native), Spanish (Fluent)" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Specialties *</label>
                                <input type="text" name="specialties" class="form-input" placeholder="e.g., Commercial, Narration, Character" required>
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Hourly Rate Range *</label>
                            <select name="hourlyRateRange" class="form-select" required>
                                <option value="">Select your rate range</option>
                                <option value="50-100">$50-100 per finished hour</option>
                                <option value="100-200">$100-200 per finished hour</option>
                                <option value="200-300">$200-300 per finished hour</option>
                                <option value="300-500">$300-500 per finished hour</option>
                                <option value="500+">$500+ per finished hour</option>
                            </select>
                        </div>

                        <button type="button" class="btn btn-primary" style="width: 100%; padding: 1.2rem;" onclick="nextStep(2)">
                            <i class="fas fa-arrow-right"></i>
                            Continue to Demo Upload
                        </button>
                    </form>
                </div>
            </div>

            <!-- Step 2: Demo Upload -->
            <div class="signup-step" id="step2">
                <div class="glass-card" style="max-width: 800px; margin: 0 auto;">
                    <h3 style="text-align: center; margin-bottom: 2rem; color: var(--accent-color);">Upload Demo Reels</h3>
                    <p style="text-align: center; color: var(--text-secondary); margin-bottom: 2rem;">
                        Showcase your voice talent with high-quality audio demos that highlight your range and expertise.
                    </p>
                    
                    <form id="demo-form">
                        <div class="form-group">
                            <label class="form-label">Demo Reel Files</label>
                            <input type="file" name="audioDemo" class="form-input" accept="audio/*" multiple>
                            <small style="color: var(--text-secondary); font-size: 0.9rem; display: block; margin-top: 0.5rem;">
                                Upload up to 5 audio demos (MP3, WAV, AIFF - max 10MB each)
                            </small>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Demo Descriptions</label>
                            <textarea name="descriptions" class="form-textarea" rows="4" placeholder="Briefly describe each demo reel - what style, genre, or character it represents..."></textarea>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Years of Experience</label>
                            <select name="experienceYears" class="form-select">
                                <option value="0">Less than 1 year</option>
                                <option value="1">1-3 years</option>
                                <option value="3">3-5 years</option>
                                <option value="5">5-10 years</option>
                                <option value="10">10+ years</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Professional Equipment</label>
                            <textarea name="equipmentDescription" class="form-textarea" rows="2" placeholder="List your microphone, audio interface, recording software, and studio setup..."></textarea>
                        </div>

                        <div style="display: flex; gap: 1rem;">
                            <button type="button" class="btn btn-secondary" style="flex: 1; padding: 1.2rem;" onclick="prevStep(1)">
                                <i class="fas fa-arrow-left"></i>
                                Back to Profile
                            </button>
                            <button type="button" class="btn btn-primary" style="flex: 1; padding: 1.2rem;" onclick="nextStep(3)">
                                <i class="fas fa-arrow-right"></i>
                                Choose Subscription
                            </button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Step 3: Subscription Selection -->
            <div class="signup-step" id="step3">
                <div style="max-width: 1000px; margin: 0 auto;">
                    <h3 style="text-align: center; margin-bottom: 1rem; color: var(--accent-color);">Choose Your Membership</h3>
                    <p style="text-align: center; color: var(--text-secondary); margin-bottom: 3rem;">
                        Select the subscription plan that works best for you. You can change or cancel anytime.
                    </p>

                    <!-- Pricing Cards - Side by Side -->
                    <div class="pricing-cards">
                        <!-- Monthly Plan -->
                        <div class="pricing-card" id="monthly-card">
                            <div class="pricing-badge">Monthly Plan</div>
                            <div class="pricing-amount">$35</div>
                            <div class="pricing-period">per month</div>
                            <ul class="pricing-features">
                                <li><span class="check"></span> Unlimited project applications</li>
                                <li><span class="check"></span> Featured profile placement</li>
                                <li><span class="check"></span> Direct client contact</li>
                                <li><span class="check"></span> Audio demo hosting</li>
                                <li><span class="check"></span> Analytics and insights</li>
                                <li><span class="check"></span> Priority customer support</li>
                                <li><span class="check"></span> Custom branding options</li>
                                <li><span class="check"></span> Advanced portfolio tools</li>
                            </ul>
                            <button class="btn btn-primary" style="width: 100%; margin-top: 1rem;" onclick="selectPlan('monthly', 35)">
                                <i class="fab fa-paypal"></i>
                                Subscribe Monthly - $35
                            </button>
                        </div>

                        <!-- Annual Plan -->
                        <div class="pricing-card recommended" id="annual-card">
                            <div class="pricing-badge">Best Value</div>
                            <div class="discount-badge">Save $84/year</div>
                            <div class="pricing-amount">$29</div>
                            <div class="pricing-period">per month<br><small style="color: var(--text-secondary);">billed annually ($348)</small></div>
                            <ul class="pricing-features">
                                <li><span class="check"></span> Unlimited project applications</li>
                                <li><span class="check"></span> Featured profile placement</li>
                                <li><span class="check"></span> Direct client contact</li>
                                <li><span class="check"></span> Audio demo hosting</li>
                                <li><span class="check"></span> Analytics and insights</li>
                                <li><span class="check"></span> Priority customer support</li>
                                <li><span class="check"></span> Custom branding options</li>
                                <li><span class="check"></span> Advanced portfolio tools</li>
                            </ul>
                            <button class="btn btn-primary pulse" style="width: 100%; margin-top: 1rem;" onclick="selectPlan('annual', 348)">
                                <i class="fab fa-paypal"></i>
                                Subscribe Annually - $348
                            </button>
                        </div>
                    </div>

                    <!-- PayPal Container -->
                    <div id="paypal-button-container" style="display: none; margin-top: 2rem; max-width: 400px; margin-left: auto; margin-right: auto; min-height: 60px;"></div>

                    <div style="display: flex; gap: 1rem; margin-top: 2rem; max-width: 400px; margin-left: auto; margin-right: auto;">
                        <button type="button" class="btn btn-secondary" style="flex: 1; padding: 1.2rem;" onclick="prevStep(2)">
                            <i class="fas fa-arrow-left"></i>
                            Back to Demos
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Pricing Page -->
    <div id="pricing" class="page">
        <div class="page-container">
            <h1 class="page-title">Simple, Transparent Pricing</h1>
            
            <!-- Client Pricing Section -->
            <div class="content-section">
                <h2 style="text-align: center; margin-bottom: 3rem;">For Clients - Always Free</h2>
                <div style="max-width: 600px; margin: 0 auto;">
                    <div class="glass-card hover-lift">
                        <div style="text-align: center;">
                            <h3 style="font-size: 2rem; margin-bottom: 1rem; color: var(--text-primary);">Free Forever</h3>
                            <div style="font-size: 3.5rem; font-weight: 900; color: var(--success-color); margin-bottom: 0.5rem;">$0</div>
                            <p style="color: var(--text-secondary); margin-bottom: 2rem;">No hidden fees, ever</p>
                            <ul class="pricing-features">
                                <li><span class="check"></span> Post unlimited projects</li>
                                <li><span class="check"></span> Browse all voice talent</li>
                                <li><span class="check"></span> Direct messaging</li>
                                <li><span class="check"></span> Project management tools</li>
                                <li><span class="check"></span> Basic support</li>
                                <li><span class="check"></span> Secure payments</li>
                                <li><span class="check"></span> Quality guarantee</li>
                            </ul>
                            <button class="btn btn-primary" style="width: 100%; margin-top: 1.5rem;" onclick="checkAuthAndPostProject()">
                                <i class="fas fa-rocket"></i>
                                Start Posting Projects
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Voice Talent Pricing Section -->
         <div class="content-section">
    <h2 style="text-align: center; margin-bottom: 2rem;">For Voice Talent</h2>
    
    <div style="text-align: center; margin-bottom: 3rem; padding: 1.5rem; background: rgba(0, 212, 255, 0.1); border-radius: 15px; max-width: 800px; margin-left: auto; margin-right: auto; margin-bottom: 3rem;">
        <div style="color: var(--accent-color); margin-bottom: 0.5rem;">
            <i class="fas fa-info-circle" style="font-size: 1.2rem;"></i>
        </div>
        <p style="color: var(--text-primary); margin: 0; font-weight: 600; font-size: 1.1rem;">
            Simple 3-Step Process
        </p>
        <p style="color: var(--text-secondary); margin: 0.5rem 0 0 0; font-size: 0.95rem;">
            Create Profile  Upload Demos  Choose Subscription Plan
        </p>
    </div>
    
    <div class="pricing-cards" style="max-width: 1000px; margin: 0 auto;">
                    <!-- Monthly Plan -->
                    <div class="pricing-card hover-lift">
                        <div class="pricing-badge">Monthly Plan</div>
                        <div class="pricing-amount">$35</div>
                        <div class="pricing-period">per month</div>
                        <ul class="pricing-features">
                            <li><span class="check"></span> Unlimited project applications</li>
                            <li><span class="check"></span> Featured profile placement</li>
                            <li><span class="check"></span> Direct client contact</li>
                            <li><span class="check"></span> Audio demo hosting</li>
                            <li><span class="check"></span> Analytics and insights</li>
                            <li><span class="check"></span> Priority customer support</li>
                            <li><span class="check"></span> Custom branding options</li>
                            <li><span class="check"></span> Advanced portfolio tools</li>
                        </ul>
                      <button class="btn btn-primary" style="width: 100%; margin-top: 1.5rem;" onclick="handlePricingPlanSelection('monthly', 35)">
    <i class="fab fa-paypal"></i>
    Start Monthly Plan
</button>
                    </div>

                    <!-- Annual Plan -->
                    <div class="pricing-card recommended hover-lift">
                        <div class="pricing-badge">Best Value</div>
                        <div class="discount-badge">Save $84/year</div>
                        <div class="pricing-amount">$29</div>
                        <div class="pricing-period">per month<br><small style="color: var(--text-secondary);">billed annually ($348)</small></div>
                        <ul class="pricing-features">
                            <li><span class="check"></span> Unlimited project applications</li>
                            <li><span class="check"></span> Featured profile placement</li>
                            <li><span class="check"></span> Direct client contact</li>
                            <li><span class="check"></span> Audio demo hosting</li>
                            <li><span class="check"></span> Analytics and insights</li>
                            <li><span class="check"></span> Priority customer support</li>
                            <li><span class="check"></span> Custom branding options</li>
                            <li><span class="check"></span> Advanced portfolio tools</li>
                        </ul>
<button class="btn btn-primary pulse" style="width: 100%; margin-top: 1.5rem;" onclick="handlePricingPlanSelection('annual', 348)">
    <div class="nav-cta-icon white" style="margin-right: 0.5rem;"></div>
    Start Annual Plan
</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Contact Us Page -->
    <div id="contact-us" class="page">
        <div class="page-container">
            <h1 class="page-title">Contact Us</h1>
            
            <div style="max-width: 1000px; margin: 0 auto;">
                <div class="content-grid">
                    <!-- Contact Form -->
                    <div class="glass-card">
                        <h3 style="color: var(--accent-color); margin-bottom: 1.5rem;">Send us a Message</h3>
                        <form id="contact-form">
                            <div class="form-group">
                                <label class="form-label">Your Name *</label>
                                <input type="text" name="name" class="form-input" placeholder="Your full name" required>
                            </div>

                            <div class="form-group">
                                <label class="form-label">Email Address *</label>
                                <input type="email" name="email" class="form-input" placeholder="your@email.com" required>
                            </div>

                            <div class="form-group">
                                <label class="form-label">Subject *</label>
                                <select name="subject" class="form-select" required>
                                    <option value="">Select a topic</option>
                                    <option>General Inquiry</option>
                                    <option>Technical Support</option>
                                    <option>Billing Question</option>
                                    <option>Partnership Opportunity</option>
                                    <option>Report an Issue</option>
                                    <option>Feature Request</option>
                                    <option>Other</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label class="form-label">Message *</label>
                                <textarea name="message" class="form-textarea" rows="5" placeholder="Tell us how we can help you..." required></textarea>
                            </div>

                            <button type="submit" class="btn btn-primary" style="width: 100%; padding: 1.2rem;">
                                <i class="fas fa-paper-plane"></i>
                                Send Message
                            </button>
                        </form>
                    </div>

                    <!-- Contact Information -->
                    <div class="glass-card">
                        <h3 style="color: var(--accent-color); margin-bottom: 1.5rem;">Get in Touch</h3>
                        
                        <div style="margin-bottom: 2rem;">
                            <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 1.5rem;">
                                <div style="width: 50px; height: 50px; background: var(--primary-gradient); border-radius: 50%; display: flex; align-items: center; justify-content: center;">
                                    <i class="fas fa-envelope" style="color: white; font-size: 1.2rem;"></i>
                                </div>
                                <div>
                                    <h4 style="color: var(--text-primary); margin-bottom: 0.3rem;">Email Support</h4>
                                    <p style="color: var(--text-secondary); margin: 0;">support@voicecastingpro.com</p>
                                </div>
                            </div>

                            <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 1.5rem;">
                                <div style="width: 50px; height: 50px; background: var(--primary-gradient); border-radius: 50%; display: flex; align-items: center; justify-content: center;">
                                    <i class="fas fa-clock" style="color: white; font-size: 1.2rem;"></i>
                                </div>
                                <div>
                                    <h4 style="color: var(--text-primary); margin-bottom: 0.3rem;">Response Time</h4>
                                    <p style="color: var(--text-secondary); margin: 0;">Within 24 hours</p>
                                </div>
                            </div>

                            <div style="display: flex; align-items: center; gap: 1rem;">
                                <div style="width: 50px; height: 50px; background: var(--primary-gradient); border-radius: 50%; display: flex; align-items: center; justify-content: center;">
                                    <i class="fas fa-headset" style="color: white; font-size: 1.2rem;"></i>
                                </div>
                                <div>
                                    <h4 style="color: var(--text-primary); margin-bottom: 0.3rem;">Live Chat</h4>
                                    <p style="color: var(--text-secondary); margin: 0;">Available Mon-Fri, 9 AM - 5 PM EST</p>
                                </div>
                            </div>
                        </div>

                        <div class="glass-card" style="background: rgba(0, 212, 255, 0.1); border-color: var(--accent-color);">
                            <h4 style="color: var(--accent-color); margin-bottom: 1rem;">Quick Help</h4>
                            <p style="color: var(--text-secondary); margin-bottom: 1rem;">Check out our Help Center for instant answers to common questions.</p>
                            <button class="btn btn-secondary" onclick="showPage('help-center')" style="width: 100%;">
                                <i class="fas fa-question-circle"></i>
                                Visit Help Center
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- About Us Page -->
    <div id="about-us" class="page">
        <div class="page-container">
            <h1 class="page-title">About VoicecastingPro</h1>
            
            <div style="max-width: 1000px; margin: 0 auto;">
                <div class="glass-card" style="text-align: center; margin-bottom: 3rem;">
                    <h2 style="color: var(--accent-color); margin-bottom: 1.5rem;">Connecting Voices, Creating Stories</h2>
                    <p style="font-size: 1.2rem; color: var(--text-secondary); line-height: 1.7;">
                        VoicecastingPro is the premier platform where exceptional voice talent meets visionary clients. 
                        We're dedicated to making professional voice casting accessible, transparent, and rewarding for everyone.
                    </p>
                </div>

                <div class="content-grid">
                    <div class="glass-card">
                        <div class="feature-icon" style="margin: 0 auto 1.5rem;">
                            <i class="fas fa-target"></i>
                        </div>
                        <h3 style="color: var(--accent-color); margin-bottom: 1rem;">Our Mission</h3>
                        <p style="color: var(--text-secondary); line-height: 1.7;">
                            To revolutionize the voice-over industry by creating a seamless, professional platform that empowers talent and delights clients through cutting-edge technology and unmatched service.
                        </p>
                    </div>

                    <div class="glass-card">
                        <div class="feature-icon" style="margin: 0 auto 1.5rem;">
                            <i class="fas fa-eye"></i>
                        </div>
                        <h3 style="color: var(--accent-color); margin-bottom: 1rem;">Our Vision</h3>
                        <p style="color: var(--text-secondary); line-height: 1.7;">
                            To become the global standard for voice casting, where every project finds its perfect voice and every voice artist finds meaningful opportunities to showcase their craft.
                        </p>
                    </div>

                    <div class="glass-card">
                        <div class="feature-icon" style="margin: 0 auto 1.5rem;">
                            <i class="fas fa-heart"></i>
                        </div>
                        <h3 style="color: var(--accent-color); margin-bottom: 1rem;">Our Values</h3>
                        <p style="color: var(--text-secondary); line-height: 1.7;">
                            Integrity, innovation, and inclusivity drive everything we do. We believe in fair compensation for talent, transparent processes, and building lasting relationships.
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Terms of Service Page -->
    <div id="terms-of-service" class="page">
        <div class="page-container">
            <h1 class="page-title">Terms of Service</h1>
            
            <div style="max-width: 800px; margin: 0 auto;">
                <div class="glass-card">
                    <p style="color: var(--text-secondary); margin-bottom: 2rem; text-align: center;">
                        <strong>Effective Date:</strong> January 1, 2025
                    </p>

                    <div style="margin-bottom: 2rem;">
                        <h3 style="color: var(--accent-color); margin-bottom: 1rem;">1. Acceptance of Terms</h3>
                        <p style="color: var(--text-secondary); line-height: 1.7; margin-bottom: 1rem;">
                            By accessing and using VoicecastingPro, you accept and agree to be bound by the terms and provision of this agreement. 
                            If you do not agree to abide by the above, please do not use this service.
                        </p>
                    </div>

                    <div style="margin-bottom: 2rem;">
                        <h3 style="color: var(--accent-color); margin-bottom: 1rem;">2. Platform Services</h3>
                        <p style="color: var(--text-secondary); line-height: 1.7; margin-bottom: 1rem;">
                            VoicecastingPro provides a platform connecting voice talent with clients seeking voice-over services. 
                            We facilitate connections but do not directly provide voice-over services.
                        </p>
                    </div>

                    <div style="margin-bottom: 2rem;">
                        <h3 style="color: var(--accent-color); margin-bottom: 1rem;">3. User Accounts</h3>
                        <p style="color: var(--text-secondary); line-height: 1.7; margin-bottom: 1rem;">
                            Users must provide accurate, current, and complete information during registration. 
                            You are responsible for maintaining the confidentiality of your account credentials.
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Privacy Policy Page -->
    <div id="privacy-policy" class="page">
        <div class="page-container">
            <h1 class="page-title">Privacy Policy</h1>
            
            <div style="max-width: 800px; margin: 0 auto;">
                <div class="glass-card">
                    <p style="color: var(--text-secondary); margin-bottom: 2rem; text-align: center;">
                        <strong>Effective Date:</strong> January 1, 2025
                    </p>

                    <div style="margin-bottom: 2rem;">
                        <h3 style="color: var(--accent-color); margin-bottom: 1rem;">Information We Collect</h3>
                        <p style="color: var(--text-secondary); line-height: 1.7; margin-bottom: 1rem;">
                            We collect information you provide directly to us, such as when you create an account, upload demos, 
                            post projects, or contact us for support. This includes your name, email address, profile information, 
                            and payment details.
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Help Center Page -->
    <div id="help-center" class="page">
        <div class="page-container">
            <h1 class="page-title">Help Center</h1>
            
            <div class="search-section">
                <div class="search-bar">
                    <i class="fas fa-search search-icon"></i>
                    <input type="text" class="search-input" placeholder="Search help articles..." id="help-search">
                </div>
            </div>

            <div class="content-section">
                <h2>Frequently Asked Questions</h2>
                
                <div class="faq-item" onclick="toggleFaq(this)">
                    <div class="faq-question">
                        How do I post a project?
                        <i class="fas fa-chevron-down faq-icon"></i>
                    </div>
                    <div class="faq-answer">
                        Posting a project is completely free and easy. Click "Post Project" in the navigation, fill out the project details including description, budget, timeline, and requirements. Once submitted, qualified voice talent will start applying within hours.
                    </div>
                </div>

                <div class="faq-item" onclick="toggleFaq(this)">
                    <div class="faq-question">
                        How much does it cost to use VoicecastingPro?
                        <i class="fas fa-chevron-down faq-icon"></i>
                    </div>
                    <div class="faq-answer">
                        For clients, VoicecastingPro is completely free. You can post unlimited projects, browse talent, and communicate directly with voice artists at no cost. Voice talent pay $35/month for professional membership to access projects and premium features.
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Account Settings Page -->
    <div id="account-settings" class="page">
        <div class="page-container">
            <h1 class="page-title">Account Settings</h1>
            
            <!-- Only show if user is signed in -->
            <div id="account-content" style="display: none;">
                <!-- Profile Information -->
                <div class="glass-card" style="margin-bottom: 2rem;">
                    <h3 style="color: var(--accent-color); margin-bottom: 1.5rem;">
                        <i class="fas fa-user"></i> Profile Information
                    </h3>
                    <div id="profile-info">
                        <!-- Profile info will be populated here -->
                    </div>
                 <button class="btn btn-secondary" onclick="editProfile()" style="margin-top: 1rem;">
                        <i class="fas fa-edit"></i> Edit Profile
                    </button>
                    
                  <!-- Demo Management for Talent -->
                    <div id="demo-management-section" style="display: none; margin-top: 1rem;">
                        <button class="btn btn-primary" onclick="showDemoManagement()">
                            <i class="fas fa-microphone"></i> Manage Audio Demos
                        </button>
                    </div>
                    
                    <!-- Project Management for Clients -->
                    <div id="client-project-management-section" style="display: none; margin-top: 1rem;">
                        <button class="btn btn-primary" onclick="showClientProjectManagement()">
                            <i class="fas fa-briefcase"></i> Manage My Projects
                        </button>
                    </div>
                </div>

                <!-- Subscription Management (only for talent) -->
                <div id="subscription-section" class="glass-card" style="margin-bottom: 2rem; display: none;">
                    <h3 style="color: var(--accent-color); margin-bottom: 1.5rem;">
                        <i class="fas fa-credit-card"></i> Subscription Management
                    </h3>
                    
                    <div id="subscription-info">
                        <!-- Subscription info will be populated here -->
                    </div>
                    
                    <div style="display: flex; gap: 1rem; margin-top: 1.5rem; flex-wrap: wrap;">
                        <button class="btn btn-secondary" onclick="changeSubscriptionPlan()">
                            <i class="fas fa-exchange-alt"></i> Change Plan
                        </button>
                        <button class="btn" onclick="cancelSubscription()" 
                                style="background: var(--warning-color); color: white;">
                            <i class="fas fa-times-circle"></i> Cancel Subscription
                        </button>
                    </div>
                </div>

                <!-- Account Deletion -->
                <div class="glass-card" style="border-color: var(--warning-color); background: rgba(255, 107, 107, 0.05);">
                    <h3 style="color: var(--warning-color); margin-bottom: 1.5rem;">
                        <i class="fas fa-exclamation-triangle"></i> Danger Zone
                    </h3>
                    <p style="color: var(--text-secondary); margin-bottom: 1.5rem;">
                        Once you delete your account, there is no going back. This will permanently delete your profile, 
                        cancel any active subscriptions, and remove all your data.
                    </p>
                    <button class="btn" onclick="deleteAccount()" 
                            style="background: var(--warning-color); color: white;">
                        <i class="fas fa-trash-alt"></i> Delete Account Permanently
                    </button>
                </div>
            </div>

            <!-- Show this if user is not signed in -->
            <div id="account-login-prompt" class="glass-card" style="text-align: center;">
                <h3 style="color: var(--accent-color); margin-bottom: 1rem;">Sign In Required</h3>
                <p style="color: var(--text-secondary); margin-bottom: 1.5rem;">
                    Please sign in to access your account settings.
                </p>
                <button class="btn btn-primary" onclick="showPage('signin')">
                    <i class="fas fa-sign-in-alt"></i> Sign In
                </button>
            </div>
        </div>
    </div>

<!-- Messages Page -->
    <div id="messages" class="page">
        <div class="page-container">
            <h1 class="page-title">Messages & Conversations</h1>
            
            <!-- Project Conversations List -->
            <div class="glass-card" style="margin-bottom: 2rem;">
                <h3 style="color: var(--accent-color); margin-bottom: 1.5rem;">
                    <i class="fas fa-comments"></i> Your Project Conversations
                </h3>
                <div id="conversations-list">
                    <div style="text-align: center; color: var(--text-secondary);">
                        <i class="fas fa-spinner fa-spin"></i> Loading conversations...
                    </div>
                </div>
            </div>

            <!-- Message Thread (Hidden by default) -->
 <div id="message-thread" class="glass-card" style="display: none;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem; padding-bottom: 1rem; border-bottom: 1px solid var(--glass-border);">
                    <h3 style="color: var(--accent-color); margin: 0;" id="thread-title">Project Conversation</h3>
                    <div style="display: flex; gap: 0.5rem; align-items: center;">
                        <button onclick="reportCurrentConversation()" 
                                style="background: rgba(255, 107, 107, 0.8); border: none; color: white; padding: 0.5rem 1rem; border-radius: 20px; cursor: pointer; font-size: 0.9rem; transition: all 0.2s ease;"
                                title="Report inappropriate behavior">
                            <i class="fas fa-flag"></i> Report
                        </button>
                        <button onclick="closeMessageThread()" style="background: none; border: none; color: var(--text-secondary); font-size: 1.2rem; cursor: pointer;">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                </div>

                <!-- Messages Container -->
                <div id="messages-container" style="max-height: 400px; overflow-y: auto; margin-bottom: 1.5rem; padding: 1rem; background: rgba(0, 0, 0, 0.2); border-radius: 10px;">
                    <div id="messages-list">
                        <!-- Messages will be loaded here -->
                    </div>
                </div>

<!-- Send Message Form -->
    <form id="send-message-form">
    <div style="margin-bottom: 1rem;">
        <textarea id="message-input" class="form-input" rows="3" placeholder="Type your message..." required style="resize: vertical; min-height: 80px;" oninput="validateMessageInput(this)"></textarea>
        <div id="message-validation-warning" style="display: none; background: rgba(255, 107, 107, 0.1); border: 1px solid var(--warning-color); border-radius: 8px; padding: 0.8rem; margin-top: 0.5rem;">
            <div style="display: flex; align-items: center; gap: 0.5rem; color: var(--warning-color); font-weight: 600; margin-bottom: 0.5rem;">
                <i class="fas fa-exclamation-triangle"></i>
                <span>Personal Information Detected</span>
            </div>
            <div id="validation-details" style="color: var(--text-secondary); font-size: 0.9rem;"></div>
        </div>
        <div id="message-guidelines" style="background: rgba(0, 212, 255, 0.1); border-radius: 8px; padding: 1rem; margin-top: 0.5rem;">
            <div style="color: var(--accent-color); font-weight: 600; margin-bottom: 0.5rem;">
                <i class="fas fa-shield-alt"></i> Safe Communication Guidelines:
            </div>
            <div style="color: var(--text-secondary); font-size: 0.9rem; line-height: 1.4;">
                 Keep all communication on VoicecastingPro<br>
                 Don't share email, phone, or social media<br>
                 Use our secure file sharing for demos<br>
                 Report any requests for external contact
            </div>
        </div>
    </div>
    
    <!-- File Attachment Section -->
    <div style="margin-bottom: 1rem;">
        <div style="display: flex; gap: 1rem; align-items: center; flex-wrap: wrap;">
            <label class="btn btn-secondary" style="margin: 0; padding: 0.6rem 1rem; cursor: pointer;">
                <i class="fas fa-paperclip"></i>
                Attach File
                <input type="file" id="message-file-input" style="display: none;" 
       accept=".txt,.pdf,.doc,.docx,.mp3,.wav,.aiff,.m4a,.jpg,.jpeg,.png" 
       onchange="handleFileSelection(this)">
            </label>
            <div id="selected-file-info" style="display: none; color: var(--accent-color); font-size: 0.9rem;">
                <i class="fas fa-file"></i>
                <span id="selected-file-name"></span>
                <button type="button" onclick="clearSelectedFile()" style="background: none; border: none; color: var(--warning-color); margin-left: 0.5rem; cursor: pointer;">
                    <i class="fas fa-times"></i>
                </button>
            </div>
        </div>
   <small style="color: var(--text-secondary); font-size: 0.8rem; display: block; margin-top: 0.5rem;">
    Attach: Audio (MP3, WAV, M4A), Scripts (PDF, DOC, TXT), Images (JPG, PNG) - Max 20MB
</small>
    </div>
    
    <div style="display: flex; gap: 1rem; align-items: center;">
        <button type="submit" class="btn btn-primary" style="flex: 1;">
            <i class="fas fa-paper-plane"></i>
            Send Message
        </button>
    </div>
</form>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="footer">

    <!-- Footer -->
    <footer class="footer">
        <div class="footer-content">
            <div class="footer-section">
                <div class="footer-logo">VoicecastingPro</div>
               <p style="color: var(--text-secondary);">Connecting clients with voice talent worldwide. Professional, secure, and designed for creative success.</p>
            </div>
            <div class="footer-section">
                <h4>For Clients</h4>
                <a class="footer-link" href="#" onclick="checkAuthAndPostProject(); return false;">Post a Project</a>
                <a class="footer-link" href="#" onclick="showPage('browse-talent'); return false;">Browse Talent</a>
                <a class="footer-link" href="#" onclick="showPage('pricing'); return false;">Pricing</a>
                <a class="footer-link" href="#" onclick="showPage('client-signup'); return false;">Sign Up Free</a>
            </div>
            <div class="footer-section">
                <h4>For Talent</h4>
                <a class="footer-link" href="#" onclick="showPage('talent-signup'); return false;">Join as Talent</a>
                <a class="footer-link" href="#" onclick="showPage('projects'); return false;">Browse Projects</a>
                <a class="footer-link" href="#" onclick="showPage('pricing'); return false;">Membership Plans</a>
                <a class="footer-link" href="#" onclick="showPage('help-center'); return false;">Support</a>
            </div>
            <div class="footer-section">
                <h4>Company</h4>
                <a class="footer-link" href="#" onclick="showPage('about-us'); return false;">About Us</a>
                <a class="footer-link" href="#" onclick="showPage('terms-of-service'); return false;">Terms of Service</a>
                <a class="footer-link" href="#" onclick="showPage('privacy-policy'); return false;">Privacy Policy</a>
                <a class="footer-link" href="#" onclick="showPage('help-center'); return false;">Help Center</a>
                <a class="footer-link" href="#" onclick="showPage('contact-us'); return false;">Contact Us</a>
            </div>
        </div>
        <div class="footer-bottom">
            <p>&copy; 2025 VoicecastingPro. All rights reserved. Built for voice professionals worldwide.</p>
        </div>
    </footer>

    <script>
// Prevent JavaScript errors from breaking navigation
window.addEventListener('error', function(e) {
    console.error('JavaScript error caught:', e.error);
    // Don't let errors break the navigation
    return false;
});

        // Global variables
        let currentStep = 1;
        let selectedPlan = null;
        let planPrice = 0;
        let talentProfileComplete = false;
        let talentSubscribed = false;
        let isUserSignedIn = false;
        let currentUser = null;
        let authToken = null;

        // API Base URL - change this to your Render.com URL
        const API_BASE_URL = window.location.origin;

        // Enhanced interactive cursor
        const cursor = document.getElementById('cursor');
        let mouseX = 0;
        let mouseY = 0;
        let cursorX = 0;
        let cursorY = 0;

        document.addEventListener('mousemove', (e) => {
            mouseX = e.clientX;
            mouseY = e.clientY;
            cursor.style.opacity = '1';
        });

        document.addEventListener('mouseleave', () => {
            cursor.style.opacity = '0';
        });

        function updateCursor() {
            const diff = 0.15;
            cursorX += (mouseX - cursorX) * diff;
            cursorY += (mouseY - cursorY) * diff;
            
            cursor.style.left = cursorX + 'px';
            cursor.style.top = cursorY + 'px';
            
            requestAnimationFrame(updateCursor);
        }
        updateCursor();

        /* Enhanced hover effects for interactive elements */
        document.querySelectorAll('button, .btn, .nav-link, .nav-cta, .nav-signin, .footer-link, [onclick]').forEach(element => {
            element.style.cursor = 'pointer';
            element.addEventListener('mouseenter', () => {
                cursor.style.transform = 'translate(-50%, -50%) scale(2)';
                cursor.style.background = 'radial-gradient(circle, rgba(0, 212, 255, 0.5) 0%, transparent 70%)';
            });
            
            element.addEventListener('mouseleave', () => {
                cursor.style.transform = 'translate(-50%, -50%) scale(1)';
                cursor.style.background = 'radial-gradient(circle, rgba(0, 212, 255, 0.3) 0%, transparent 70%)';
            });
        });

       // Handle URL routing for password reset and other deep links
        function handleUrlRouting() {
            const urlParams = new URLSearchParams(window.location.search);
            const path = window.location.pathname;
            
            // Handle password reset links
            if (path.includes('reset-password') || path.includes('password-reset') || urlParams.has('reset') || urlParams.has('token')) {
                const token = urlParams.get('token') || urlParams.get('reset');
                if (token) {
                    console.log('Password reset token found:', token);
                    showPasswordResetWithToken(token);
                    return true;
                } else {
                    showPage('password-reset');
                    return true;
                }
            }
            
            return false;
        }
        
        // Show password reset page with token
        function showPasswordResetWithToken(token) {
            showPage('password-reset');
            
            const requestForm = document.getElementById('password-reset-form');
            if (requestForm) {
                requestForm.style.display = 'none';
            }
            
            const resetContainer = document.querySelector('#password-reset .auth-form');
            if (resetContainer && !document.getElementById('actual-reset-form')) {
                const resetFormHtml = `
                    <div id="actual-reset-form">
                        <h2>Set New Password</h2>
                        <p class="auth-form-subtitle">Enter your new password below</p>
                        
                        <form id="new-password-form">
                            <input type="hidden" name="reset-token" value="${token}">
                            
                            <div class="form-group">
                                <label class="form-label">New Password</label>
                                <input type="password" name="new-password" class="form-input" placeholder="Enter new password" required minlength="6">
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Confirm New Password</label>
                                <input type="password" name="confirm-password" class="form-input" placeholder="Confirm new password" required minlength="6">
                            </div>
                            
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-lock"></i>
                                Update Password
                            </button>
                        </form>
                        
                        <div class="auth-links">
                            <p>Remember your password? <a href="#" onclick="showPage('signin'); return false;">Sign In</a></p>
                        </div>
                    </div>
                `;
                
                resetContainer.insertAdjacentHTML('beforeend', resetFormHtml);
                document.getElementById('new-password-form').addEventListener('submit', handlePasswordReset);
            }
            
            showNotification(' Password reset link verified! Please enter your new password.', 'success');
        }
        
        // Handle password reset form submission
        async function handlePasswordReset(e) {
            e.preventDefault();
            
            const form = e.target;
            const formData = new FormData(form);
            const newPassword = formData.get('new-password');
            const confirmPassword = formData.get('confirm-password');
            const token = formData.get('reset-token');
            
            if (newPassword !== confirmPassword) {
                showNotification(' Passwords do not match. Please try again.', 'error');
                return;
            }
            
            const submitBtn = form.querySelector('button[type="submit"]');
            submitBtn.classList.add('loading');
            submitBtn.disabled = true;
            
            try {
                const response = await apiCall('/api/auth/reset-password', {
                    method: 'POST',
                    body: JSON.stringify({
                        token: token,
                        newPassword: newPassword
                    })
                });
                
                showNotification(' Password updated successfully! You can now sign in.', 'success');
                window.history.replaceState({}, document.title, window.location.pathname);
                
              // Check for redirect parameter from email links
const urlParams = new URLSearchParams(window.location.search);
const redirectPage = urlParams.get('redirect');

setTimeout(() => {
    if (redirectPage === 'messages') {
        showPage('messages');
        showNotification(' Welcome back! Loading your conversations...', 'success');
    } else {
        showPage('browse-talent');
    }
}, 1500);
                
            } catch (error) {
                showNotification(' Password reset failed. Link may be expired.', 'error');
            } finally {
                submitBtn.classList.remove('loading');
                submitBtn.disabled = false;
            }
        }

// Initialize app
document.addEventListener('DOMContentLoaded', () => {
  console.log('VoicecastingPro loaded successfully');
    
    // Initialize platform safeguards
    initializePlatformSafeguards();
    
    // Ensure mobile menu is properly initialized
    try {
        updateMobileMenuContent();
    } catch (error) {
        console.error('Error initializing mobile menu:', error);
    }

    // Load cached subscription status
    try {
        const cachedSubscribed = localStorage.getItem('talentSubscribed');
        const cachedProfileComplete = localStorage.getItem('talentProfileComplete');
        
        if (cachedSubscribed === 'true') {
            talentSubscribed = true;
            console.log(' Loaded cached subscription status: subscribed');
        }
        
        if (cachedProfileComplete === 'true') {
            talentProfileComplete = true;
            console.log(' Loaded cached profile status: complete');
        }
    } catch (error) {
        console.log('localStorage not available for caching');
    }
    
    // Handle URL routing first (for password reset links, etc.)
    const routeHandled = handleUrlRouting();
    
    // Handle page parameter from email links
    const urlParams = new URLSearchParams(window.location.search);
    const pageParam = urlParams.get('page');
    if (pageParam && !routeHandled) {
        console.log(' Email link detected, navigating to:', pageParam);
        showPage(pageParam);
    } 
              
           // Check if user is already signed in
            checkExistingAuth();
            
            // Initialize deadline minimum date
            setProjectDeadlineMinDate();
            
            // Load initial data
            loadInitialData();
        });

    // Check for existing authentication
async function checkExistingAuth() {
    try {
        const token = localStorage.getItem('token');
        const user = localStorage.getItem('user');
        
        if (token && user) {
            authToken = token;
            currentUser = JSON.parse(user);
            isUserSignedIn = true;
            
            // Check subscription status for talent users
            if (currentUser.account_type === 'talent') {
                await checkTalentSubscriptionStatus();
            }
            
            updateUIForSignedInUser();
        }
    } catch (error) {
        console.log('localStorage not available (sandboxed environment) - this is normal in Claude artifacts');
        // localStorage will work normally when deployed to Render.com
    }
}

// Check talent subscription status from server
async function checkTalentSubscriptionStatus() {
    try {
        console.log(' Checking talent subscription status...');
        const response = await apiCall('/api/subscriptions/status');
        console.log(' Subscription status response:', response);
        
        if (response.subscription && response.subscription.status === 'active') {
            talentSubscribed = true;
            talentProfileComplete = true;
            localStorage.setItem('talentSubscribed', 'true');
            localStorage.setItem('talentProfileComplete', 'true');
            console.log(' Talent subscription is active');
        } else {
            talentSubscribed = false;
            localStorage.setItem('talentSubscribed', 'false');
            console.log(' No active subscription found');
        }
    } catch (error) {
        console.error('Failed to check subscription status:', error);
        // Don't set to false if we can't check - might be a network issue
        console.log(' Could not verify subscription status, using cached value');
        
        // Try to get cached values
        const cachedSubscribed = localStorage.getItem('talentSubscribed');
        if (cachedSubscribed === 'true') {
            talentSubscribed = true;
        }
    }
}

        // Update UI for signed in user
     function updateUIForSignedInUser() {
    const navAuth = document.getElementById('nav-auth');
    if (isUserSignedIn && currentUser) {
        const accountType = currentUser.account_type === 'talent' ? 'Talent' : 'Client';
        
        navAuth.innerHTML = `
            <div class="nav-signin" style="background: rgba(0, 212, 255, 0.1); color: var(--accent-color); cursor: default;">
                <i class="fas fa-user"></i>
                <span>${currentUser.first_name} (${accountType})</span>
            </div>
            <div class="nav-cta" onclick="signOut()" style="background: rgba(255, 107, 107, 0.8); cursor: pointer;">
                <i class="fas fa-sign-out-alt"></i>
                <span>Sign Out</span>
            </div>
            <button class="mobile-menu-toggle" onclick="toggleMobileMenu()">
                <i class="fas fa-bars" id="menu-icon"></i>
            </button>
        `;
    }
    
    updatePostProjectAuthNotice();
    
    // Show/hide Post Project link based on account type
    const postProjectNav = document.getElementById('post-project-nav');
    if (postProjectNav) {
        if (isUserSignedIn && currentUser && currentUser.account_type === 'client') {
            postProjectNav.style.display = 'block';
        } else {
            postProjectNav.style.display = 'none';
        }
    }
}

        // Sign out function
        function signOut() {
    try {
        localStorage.removeItem('token');
        localStorage.removeItem('user');
        localStorage.removeItem('talentProfileComplete');
        localStorage.removeItem('talentSubscribed');
        localStorage.clear(); // Clear everything
    } catch (error) {
        console.log('localStorage not available - will work when deployed');
    }
    
    authToken = null;
    currentUser = null;
    isUserSignedIn = false;
    talentProfileComplete = false;
    talentSubscribed = false;
    currentConversation = null;
    selectedPlan = null;
    planPrice = 0;
    currentStep = 1;
            
            // Update UI immediately
            const navAuth = document.getElementById('nav-auth');
            navAuth.innerHTML = `
                <div class="nav-signin" onclick="showPage('signin')">
                    <i class="fas fa-sign-in-alt"></i>
                    <span>Sign In</span>
                </div>
                <div class="nav-cta" onclick="showPage('client-signup')" style="margin-right: 0.5rem;">
                    <div class="nav-cta-icon white"></div>
                    <span>Join as Client</span>
                </div>
                <div class="nav-cta" onclick="showPage('talent-signup')">
                    <div class="nav-cta-icon"></div>
                    <span>Join as Talent</span>
                </div>
            `;
            
            // Show success message and redirect
            showNotification(' Successfully signed out!', 'success');
            setTimeout(() => {
                showPage('home');
            }, 1000);
        }

        // Load initial data
        async function loadInitialData() {
            await loadTalentData();
            await loadProjectsData();
        }

        // Navbar scroll effect
        let ticking = false;
        
        function updateNavbar() {
            const navbar = document.getElementById('navbar');
            if (window.scrollY > 50) {
                navbar.classList.add('scrolled');
            } else {
                navbar.classList.remove('scrolled');
            }
            ticking = false;
        }
        
        window.addEventListener('scroll', () => {
            if (!ticking) {
                requestAnimationFrame(updateNavbar);
                ticking = true;
            }
        });

        // Enhanced parallax effect on scroll
        window.addEventListener('scroll', () => {
            const scrolled = window.pageYOffset;
            const parallaxElements = document.querySelectorAll('.floating-particles, .floating-shapes');
            
            parallaxElements.forEach(element => {
                const speed = element.classList.contains('floating-particles') ? 0.5 : 0.3;
                element.style.transform = `translateY(${scrolled * speed}px)`;
            });
        });

        // Random particle generation
        function createRandomParticle() {
            const particleContainer = document.querySelector('.floating-particles');
            const particle = document.createElement('div');
            
            particle.className = 'particle';
            particle.style.width = Math.random() * 6 + 2 + 'px';
            particle.style.height = particle.style.width;
            particle.style.left = Math.random() * 100 + '%';
            particle.style.background = `rgba(${Math.random() * 255}, ${Math.random() * 255}, ${Math.random() * 255}, ${Math.random() * 0.5 + 0.2})`;
            particle.style.animation = `float${Math.floor(Math.random() * 3) + 1} ${Math.random() * 10 + 15}s infinite linear`;
            particle.style.animationDelay = `-${Math.random() * 20}s`;
            
            particleContainer.appendChild(particle);
            
            // Remove particle after animation
            setTimeout(() => {
                if (particle.parentNode) {
                    particle.parentNode.removeChild(particle);
                }
            }, 25000);
        }

        // Generate random particles periodically
        setInterval(createRandomParticle, 3000);

        // Navigation functionality
      function showPage(pageId) {
    try {
        console.log('Navigating to page:', pageId);
        
        // Hide all pages
        document.querySelectorAll('.page').forEach(page => {
            page.classList.remove('active');
        });
        
        // Show selected page
        const targetPage = document.getElementById(pageId);
        if (targetPage) {
            targetPage.classList.add('active');
            window.scrollTo({ top: 0, behavior: 'smooth' });
            console.log('Successfully navigated to:', pageId);
        } else {
            console.error('Page not found:', pageId);
            showNotification(' Page not found: ' + pageId, 'error');
            return;
        }

 // Handle messages page - redirect to signin if not authenticated
        if (pageId === 'messages' && !isUserSignedIn) {
            console.log(' Not signed in, redirecting to signin with messages redirect');
            window.history.replaceState({}, '', '/?page=signin&redirect=messages');
            showPage('signin');
            return;
        }

        // Handle subscription notice on projects page
        if (pageId === 'projects') {
            updateProjectsPageAccess();
        }
        
      // Handle auth notice on post-project page
        if (pageId === 'post-project') {
            updatePostProjectAuthNotice();
            setProjectDeadlineMinDate();
        }

        // Initialize account settings page
        if (pageId === 'account-settings') {
            initializeAccountSettings();
        }

        // Reset signup process if navigating away from talent-signup
        if (pageId !== 'talent-signup') {
            resetSignupProcess();
        }

        // Close mobile menu if open
        closeMobileMenu();
    } catch (error) {
        console.error('Error navigating to page:', pageId, error);
        showNotification(' Navigation error: ' + error.message, 'error');
    }
}
        // Update post project page auth notice
        function updatePostProjectAuthNotice() {
            const authNotice = document.getElementById('post-project-auth-notice');
            
            if (isUserSignedIn && currentUser) {
                authNotice.style.display = 'block';
            } else {
                authNotice.style.display = 'none';
            }
        }

 // Update projects page based on user and subscription status
async function updateProjectsPageAccess() {
    const subscriptionNotice = document.getElementById('subscription-notice');
    const noticeTitle = document.getElementById('access-notice-title');
    const noticeText = document.getElementById('access-notice-text');
    const noticeButtons = document.getElementById('access-notice-buttons');

    if (!isUserSignedIn) {
        // Not signed in - offer account type selection
        subscriptionNotice.style.display = 'block';
        noticeTitle.textContent = 'Sign In Required';
        noticeText.textContent = 'To apply to projects, please sign in or create an account.';
        noticeButtons.innerHTML = `
            <div style="display: flex; gap: 1rem; justify-content: center; flex-wrap: wrap;">
                <button class="btn btn-secondary" onclick="showPage('signin')">
                    <i class="fas fa-sign-in-alt"></i>
                    Sign In
                </button>
                <button class="btn btn-primary" onclick="showPage('account-type-selection')">
                    <i class="fas fa-user-plus"></i>
                    Create Account
                </button>
            </div>
        `;
    } else if (currentUser.account_type === 'client') {
        // Signed in as client - explain limitation
        subscriptionNotice.style.display = 'block';
        noticeTitle.textContent = 'Voice Talent Account Required';
        noticeText.textContent = 'Only voice talent can apply to projects. You\'re currently signed in as a client.';
        noticeButtons.innerHTML = `
            <div style="display: flex; gap: 1rem; justify-content: center; flex-wrap: wrap;">
                <button class="btn btn-secondary" onclick="showPage('post-project')">
                    <i class="fas fa-plus-circle"></i>
                    Post a Project Instead
                </button>
                <button class="btn btn-primary" onclick="showPage('talent-signup')">
                    <i class="fas fa-microphone"></i>
                    Create Talent Account
                </button>
            </div>
            <p style="font-size: 0.9rem; color: var(--text-secondary); margin-top: 1rem;">
                You can have both client and talent accounts with different emails.
            </p>
        `;
    } else if (currentUser.account_type === 'talent') {
        // For talent users, check subscription status more thoroughly
        console.log(' Checking talent subscription access...');
        console.log('Local subscription status:', talentSubscribed);
        console.log('Local profile status:', talentProfileComplete);
        
        // If we're uncertain about subscription status, check the server
        if (!talentSubscribed) {
            console.log(' Local status shows not subscribed, checking server...');
            
            // Show loading state
            subscriptionNotice.style.display = 'block';
            noticeTitle.textContent = 'Checking Subscription Status...';
            noticeText.textContent = 'Please wait while we verify your subscription.';
            noticeButtons.innerHTML = `
                <div style="display: flex; justify-content: center;">
                    <i class="fas fa-spinner fa-spin" style="font-size: 1.5rem; color: var(--accent-color);"></i>
                </div>
            `;
            
            try {
                await checkTalentSubscriptionStatus();
                console.log(' Server check complete. New status:', talentSubscribed);
                
                // Recursively call this function to update UI with new status
                setTimeout(() => updateProjectsPageAccess(), 100);
                return;
                
            } catch (error) {
                console.error(' Failed to check server subscription status:', error);
                // Continue with local status
            }
        }
        
        if (!talentSubscribed) {
            // No subscription - show subscription required
            if (talentProfileComplete) {
                subscriptionNotice.style.display = 'block';
                noticeTitle.textContent = 'Subscription Required';
                noticeText.textContent = 'To apply to projects, you need an active subscription.';
                noticeButtons.innerHTML = `
                    <button class="btn btn-primary" onclick="showPage('talent-signup'); showStep(3)">
                        <i class="fas fa-crown"></i>
                        Complete Subscription
                    </button>
                `;
            } else {
                subscriptionNotice.style.display = 'block';
                noticeTitle.textContent = 'Complete Profile & Subscribe';
                noticeText.textContent = 'Complete your profile setup and subscribe to start applying to projects.';
                noticeButtons.innerHTML = `
                    <button class="btn btn-primary" onclick="showPage('talent-signup'); showStep(1)">
                        <i class="fas fa-user-edit"></i>
                        Complete Setup
                    </button>
                `;
            }
        } else {
            // Fully set up talent with active subscription - hide notice
            console.log(' Talent has active subscription, hiding notice');
            subscriptionNotice.style.display = 'none';
        }
    }
}
// Handle projects page access button clicks
function handleProjectsPageAccess() {
    if (!isUserSignedIn) {
        const choice = confirm(`To apply to projects, you need an account:\n\n` +
            `OK = Sign in to existing account\n` +
            `Cancel = Create new account\n\n` +
            `Choose your preferred option:`);
        
        if (choice) {
            showPage('signin');
        } else {
            showPage('account-type-selection');
        }
    } else if (currentUser.account_type === 'client') {
        const choice = confirm(`You're signed in as a client, but only voice talent can apply to projects.\n\n` +
            `Would you like to:\n\n` +
            `OK = Create a talent account\n` +
            `Cancel = Post a project instead\n\n` +
            `Note: You can have both account types.`);
        
        if (choice) {
            showPage('talent-signup');
        } else {
            showPage('post-project');
        }
    } else {
        // Talent user - handle subscription
        if (talentProfileComplete) {
            showPage('talent-signup');
            showStep(3);
        } else {
            showPage('talent-signup');
            showStep(1);
        }
    }
}

        // Show password reset page
        function showPasswordReset() {
            showPage('password-reset');
        }

        // Mobile menu functionality
       function toggleMobileMenu() {
    try {
        const mobileMenu = document.getElementById('mobile-menu');
        const menuIcon = document.getElementById('menu-icon');
        
        if (!mobileMenu || !menuIcon) {
            console.error('Mobile menu elements not found');
            return;
        }
        
        if (mobileMenu.classList.contains('active')) {
            closeMobileMenu();
        } else {
            // Update mobile menu content based on user status
            updateMobileMenuContent();
            mobileMenu.classList.add('active');
            menuIcon.className = 'fas fa-times';
            document.body.classList.add('menu-open');
        }
    } catch (error) {
        console.error('Error toggling mobile menu:', error);
        // Fallback: ensure menu is closed on error
        const mobileMenu = document.getElementById('mobile-menu');
        const menuIcon = document.getElementById('menu-icon');
        if (mobileMenu) mobileMenu.classList.remove('active');
        if (menuIcon) menuIcon.className = 'fas fa-bars';
        document.body.classList.remove('menu-open');
    }
}

       function updateMobileMenuContent() {
    const mobileMenuContent = document.querySelector('.mobile-menu-content');
    
    let menuHTML = `
        <a class="nav-link" href="#" onclick="showPage('home'); closeMobileMenu(); return false;">Home</a>
        <a class="nav-link" href="#" onclick="showPage('browse-talent'); closeMobileMenu(); return false;">Browse Talent</a>
        <a class="nav-link" href="#" onclick="showPage('projects'); closeMobileMenu(); return false;">Projects</a>
        <a class="nav-link" href="#" onclick="checkAuthAndPostProject(); closeMobileMenu(); return false;">Post Project</a>
        <a class="nav-link" href="#" onclick="showPage('pricing'); closeMobileMenu(); return false;">Pricing</a>
        <a class="nav-link" href="#" onclick="showPage('help-center'); closeMobileMenu(); return false;">Help</a>
    `;
    
    if (isUserSignedIn && currentUser) {
        const accountType = currentUser.account_type === 'talent' ? 'Talent' : 'Client';
        menuHTML += `
            <div style="text-align: center; padding: 1rem; color: var(--accent-color); border-top: 1px solid rgba(255, 255, 255, 0.1); margin-top: 1rem;">
                <i class="fas fa-user"></i> ${currentUser.first_name} (${accountType})
            </div>
            <div class="nav-cta" onclick="signOut(); closeMobileMenu(); return false;" style="background: rgba(255, 107, 107, 0.8);">
                <i class="fas fa-sign-out-alt"></i>
                Sign Out
            </div>
        `;
    } else {
        menuHTML += `
            <div class="nav-signin" onclick="showPage('signin'); closeMobileMenu(); return false;">
                <i class="fas fa-sign-in-alt"></i>
                Sign In
            </div>
            <div class="nav-cta" onclick="showPage('client-signup'); closeMobileMenu(); return false;">
                <div class="nav-cta-icon white"></div>
                Join as Client
            </div>
<div class="nav-cta" onclick="showPage('account-type-selection'); closeMobileMenu(); return false;">
    <div class="nav-cta-icon"></div>
    Join as Talent
</div>
        `;
    }
    
    mobileMenuContent.innerHTML = menuHTML;
}

        function closeMobileMenu() {
            try {
                const mobileMenu = document.getElementById('mobile-menu');
                const menuIcon = document.getElementById('menu-icon');
                
                if (!mobileMenu || !menuIcon) {
                    console.error('Mobile menu elements not found');
                    return;
                }
                
                mobileMenu.classList.remove('active');
                menuIcon.className = 'fas fa-bars';
                document.body.classList.remove('menu-open');
            } catch (error) {
                console.error('Error closing mobile menu:', error);
            }
        }

        // Check authentication before allowing project posting
        function checkAuthAndPostProject() {
            if (!isUserSignedIn) {
                showNotification(' To post projects, please sign in or create a free client account', 'error');
                
                setTimeout(() => {
                    const choice = confirm(`To post projects you need a free client account:\n\nOK = Create FREE client account\nCancel = Sign in to existing account`);
                    
                    if (choice) {
                        showPage('client-signup');
                    } else {
                        showPage('signin');
                    }
                }, 1500);
                return;
            }
            
            showPage('post-project');
        }

        // Contact talent function with improved client onboarding
        function contactTalent(talentName, talentEmail) {
            if (!isUserSignedIn) {
                showNotification(' To contact voice talent, please sign in or create a free client account', 'error');
                
                setTimeout(() => {
                    const choice = confirm(`Would you like to:\n\nOK = Create a FREE client account\nCancel = Sign in to existing account`);
                    
                    if (choice) {
                        showPage('client-signup');
                    } else {
                        showPage('signin');
                    }
                }, 1500);
                return;
            }

            // Show contact form modal for the talent
            showTalentContactModal(talentName, talentEmail);
        }

        // Talent contact modal functions
        function showTalentContactModal(talentName, talentEmail) {
            const modal = document.getElementById('talent-contact-modal');
            const talentInfo = document.getElementById('talent-contact-info');
            
            // Populate talent info
            talentInfo.innerHTML = `
                <div style="display: flex; align-items: center; gap: 1rem;">
                    <div style="width: 50px; height: 50px; border-radius: 50%; background: var(--primary-gradient); display: flex; align-items: center; justify-content: center; font-size: 1.2rem; font-weight: 800; color: white;">
                        ${talentName.split(' ').map(n => n[0]).join('')}
                    </div>
                    <div>
                        <h4 style="margin: 0; color: var(--text-primary);">Contacting: ${talentName}</h4>
                        <p style="margin: 0; color: var(--text-secondary); font-size: 0.9rem;">Your message will be sent directly to their email</p>
                    </div>
                </div>
            `;
            
            // Store talent info for form submission
            modal.setAttribute('data-talent-name', talentName);
            modal.setAttribute('data-talent-email', talentEmail);
            
            // Show modal
            modal.style.display = 'block';
            document.body.style.overflow = 'hidden';
        }

        function closeTalentContactModal() {
            const modal = document.getElementById('talent-contact-modal');
            modal.style.display = 'none';
            document.body.style.overflow = '';
            
            // Reset form
            document.getElementById('talent-contact-form').reset();
        }

 // Play talent demo function - FIXED VERSION with better audio handling
async function playTalentDemo(talentId, talentName) {
    try {
        showNotification(' Loading audio demos...', 'success');
        
        const response = await apiCall(`/api/talent/${talentId}/demos`);
        const demos = response.demos || [];
        
        if (demos.length === 0) {
            showNotification(` No audio demos available for ${talentName}`, 'error');
            return;
        }
        
        console.log(`Found ${demos.length} demos for ${talentName}:`, demos);
        
        // Add talent email to demos for contact functionality
        const demosWithContact = demos.map(demo => ({
            ...demo,
            talent_email: response.talent_email || ''
        }));
        
        showAudioPlayerModal(talentName, demosWithContact);
        
    } catch (error) {
        console.error('Failed to load demos:', error);
        showNotification(` Failed to load demos: ${error.message}`, 'error');
    }
}

// Proper audio URL construction
function getAudioUrl(demoUrl) {
    if (!demoUrl) return '';
    
    // Handle different URL formats
    if (demoUrl.startsWith('http')) {
        return demoUrl; // Already a full URL
    } else if (demoUrl.startsWith('/')) {
        return `${API_BASE_URL}${demoUrl}`; // Absolute path
    } else {
        return `${API_BASE_URL}/uploads/demos/${demoUrl}`; // Relative path
    }
}

// FIXED: Enhanced audio error handling
function handleAudioErrorFixed(audioElement) {
    console.error(' Audio Error Details:');
    console.error('Demo ID:', audioElement.getAttribute('data-demo-id'));
    console.error('Audio element:', audioElement);
    console.error('Error code:', audioElement.error?.code);
    console.error('Error message:', audioElement.error?.message);
    console.error('Network state:', audioElement.networkState);
    console.error('Ready state:', audioElement.readyState);
    console.error('Current src:', audioElement.currentSrc);
    
    const sources = audioElement.querySelectorAll('source');
    sources.forEach((source, index) => {
        console.error(`Source ${index + 1}:`, source.src, 'Type:', source.type);
    });
    
    const errorDiv = audioElement.parentNode.querySelector('.audio-error-message');
    if (errorDiv) {
        const errorText = errorDiv.querySelector('.error-text');
        
        // Show more specific error message
        const errorCode = audioElement.error?.code;
        let userMessage = 'Failed to load audio file.';
        
        switch (errorCode) {
            case 1: // MEDIA_ERR_ABORTED
                userMessage = 'Audio loading was aborted.';
                break;
            case 2: // MEDIA_ERR_NETWORK
                userMessage = 'Network error loading audio.';
                break;
            case 3: // MEDIA_ERR_DECODE
                userMessage = 'Audio format not supported.';
                break;
            case 4: // MEDIA_ERR_SRC_NOT_SUPPORTED
                userMessage = 'Audio file not found or unsupported format.';
                break;
        }
        
        if (errorText) {
            errorText.textContent = userMessage;
        }
        
        errorDiv.style.display = 'block';
    }
    
    showNotification(` ${userMessage || 'Audio playback error'}`, 'error');
}

// Enhanced audio URL construction with better error handling
function getAudioUrl(demoUrl) {
    if (!demoUrl) {
        console.warn('No demo URL provided');
        return '';
    }
    
    console.log('Original demo URL:', demoUrl);
    
    // Handle different URL formats
    let finalUrl;
    if (demoUrl.startsWith('http://') || demoUrl.startsWith('https://')) {
        finalUrl = demoUrl; // Already a full URL
    } else if (demoUrl.startsWith('/')) {
        finalUrl = `${API_BASE_URL}${demoUrl}`; // Absolute path
    } else {
        finalUrl = `${API_BASE_URL}/uploads/demos/${demoUrl}`; // Relative path
    }
    
    console.log('Final audio URL:', finalUrl);
    return finalUrl;
}

// FIXED: Audio player modal with proper audio playback
function showAudioPlayerModal(talentName, demos) {
    const modal = document.createElement('div');
    modal.className = 'audio-player-modal';
    modal.style.cssText = `
        position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
        background: rgba(0, 0, 0, 0.9); z-index: 1002; 
        backdrop-filter: blur(10px); display: flex; 
        align-items: center; justify-content: center; padding: 2rem;
    `;
    
    // Create demos HTML without inline event handlers (we'll add them programmatically)
    const demosHtml = demos.map((demo, index) => {
        const demoUrl = getAudioUrl(demo.url);
        
        return `
            <div class="glass-card" style="margin-bottom: 1rem; background: rgba(102, 126, 234, 0.1);" data-demo-id="${demo.id}">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                    <div>
                        <h4 style="margin: 0; color: var(--text-primary);">${demo.title || 'Demo'}</h4>
                        <p style="margin: 0; color: var(--text-secondary); font-size: 0.9rem;">${demo.description || 'No description'}</p>
                        ${demo.duration ? `<span style="color: var(--accent-color); font-size: 0.8rem;">Duration: ${demo.duration}</span>` : ''}
                    </div>
                </div>
                
                <div style="background: rgba(0, 0, 0, 0.3); border-radius: 10px; padding: 1rem;">
                    <audio controls style="width: 100%;" preload="metadata" data-demo-id="${demo.id}">
                        <source src="${demoUrl}" type="audio/mpeg">
                        <source src="${demoUrl}" type="audio/wav">
                        <source src="${demoUrl}" type="audio/mp4">
                        <source src="${demoUrl}" type="audio/aac">
                        Your browser does not support the audio element.
                    </audio>
                    <div class="audio-error-message" style="display: none; color: var(--warning-color); text-align: center; margin-top: 0.5rem; font-size: 0.9rem;">
                        <i class="fas fa-exclamation-triangle"></i>
                        <span class="error-text">Failed to load audio file.</span>
                        <button class="retry-audio-btn" style="background: none; border: none; color: var(--accent-color); cursor: pointer; text-decoration: underline; margin-left: 0.5rem;">Try again</button>
                    </div>
                </div>
            </div>
        `;
    }).join('');
    
    const contactEmail = demos[0]?.talent_email || '';
    
    modal.innerHTML = `
        <div class="glass-card" style="max-width: 600px; width: 100%; margin: 0 1rem; max-height: 80vh; overflow-y: auto;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                <h3 style="color: var(--accent-color); margin: 0;"> ${talentName}'s Voice Demos</h3>
                <button class="modal-close-btn" type="button"
                        style="background: none; border: none; color: var(--text-secondary); font-size: 1.5rem; cursor: pointer;">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div id="demos-list">
                ${demosHtml}
            </div>
            
            <div style="text-align: center; margin-top: 1.5rem;">
                <button class="contact-talent-btn btn btn-primary" data-talent-name="${talentName}" data-talent-email="${contactEmail}">
                    <i class="fas fa-envelope"></i>
                    Contact ${talentName.split(' ')[0]}
                </button>
            </div>
        </div>
    `;
    
    document.body.appendChild(modal);
    document.body.style.overflow = 'hidden';
    
    // Add event listeners programmatically (more reliable than inline handlers)
    const closeBtn = modal.querySelector('.modal-close-btn');
    closeBtn.addEventListener('click', function() {
        closeAudioPlayerModal(modal);
    });
    
    // Handle contact button
    const contactBtn = modal.querySelector('.contact-talent-btn');
    contactBtn.addEventListener('click', function() {
        const talentName = this.getAttribute('data-talent-name');
        const talentEmail = this.getAttribute('data-talent-email');
        contactTalent(talentName, talentEmail);
    });
    
    // Handle audio error events
    const audioElements = modal.querySelectorAll('audio');
    audioElements.forEach(audio => {
        audio.addEventListener('error', function() {
            handleAudioErrorFixed(this);
        });
        
        audio.addEventListener('loadstart', function() {
            console.log('Loading audio demo:', this.getAttribute('data-demo-id'));
        });
        
        audio.addEventListener('canplay', function() {
            console.log('Audio ready to play:', this.getAttribute('data-demo-id'));
            // Hide error message if it was showing
            const errorDiv = this.parentNode.querySelector('.audio-error-message');
            if (errorDiv) {
                errorDiv.style.display = 'none';
            }
        });
    });
    
    // Handle retry buttons
    const retryBtns = modal.querySelectorAll('.retry-audio-btn');
    retryBtns.forEach(btn => {
        btn.addEventListener('click', function() {
            const audioElement = this.closest('.glass-card').querySelector('audio');
            const errorDiv = this.closest('.audio-error-message');
            
            errorDiv.style.display = 'none';
            audioElement.load(); // Reload the audio element
        });
    });
    
    // Close on background click
    modal.addEventListener('click', (e) => {
        if (e.target === modal) {
            closeAudioPlayerModal(modal);
        }
    });
}


// Close audio player modal
function closeAudioPlayerModal(modal) {
    // Stop all audio playback
    const audioElements = modal.querySelectorAll('audio');
    audioElements.forEach(audio => {
        audio.pause();
        audio.currentTime = 0;
    });
    
    if (modal && modal.parentNode) {
        modal.parentNode.removeChild(modal);
    }
    document.body.style.overflow = '';
}  
      // Talent contact form submission
        document.addEventListener('DOMContentLoaded', function() {
            const talentContactForm = document.getElementById('talent-contact-form');
            if (talentContactForm) {
                talentContactForm.addEventListener('submit', async function(e) {
                    e.preventDefault();
                    
                    const modal = document.getElementById('talent-contact-modal');
                    const talentName = modal.getAttribute('data-talent-name');
                    const talentEmail = modal.getAttribute('data-talent-email');
                    
                    const submitBtn = this.querySelector('button[type="submit"]');
                    const originalText = submitBtn.innerHTML;
                    submitBtn.classList.add('loading');
                    submitBtn.disabled = true;
                    
                    try {
                        const formData = new FormData(this);
                        
                        const contactData = {
                            talentName: talentName,
                            talentEmail: talentEmail,
                            clientName: currentUser.first_name + ' ' + currentUser.last_name,
                            clientEmail: currentUser.email,
                            subject: formData.get('subject'),
                            message: formData.get('message'),
                            budget: formData.get('budget') || 'Not specified'
                        };
                        
                        const response = await apiCall('/api/contact/talent', {
                            method: 'POST',
                            body: JSON.stringify(contactData)
                        });
                        
        showNotification(` Message sent to ${talentName} successfully!`, 'success');
                        closeTalentContactModal();
                        
                        // Show payment protection setup after successful contact
                        setTimeout(() => {
                            const budgetStr = contactData.budget || 'Not specified';
                            let budgetMin = 500, budgetMax = 1000;
                            
                            if (budgetStr.includes('under-500')) { budgetMin = 100; budgetMax = 500; }
                            else if (budgetStr.includes('500-1000')) { budgetMin = 500; budgetMax = 1000; }
                            else if (budgetStr.includes('1000-2500')) { budgetMin = 1000; budgetMax = 2500; }
                            else if (budgetStr.includes('2500-5000')) { budgetMin = 2500; budgetMax = 5000; }
                            else if (budgetStr.includes('5000+')) { budgetMin = 5000; budgetMax = 10000; }
                            
                            showPaymentSetupModal(`contact_${Date.now()}`, talentName, 'Direct Contact Project', budgetMin, budgetMax);
                        }, 2000);
                        
                    } catch (error) {
                        console.error('Contact talent error:', error);
                        showNotification(` Failed to send message: ${error.message}`, 'error');
                    } finally {
                        submitBtn.classList.remove('loading');
                        submitBtn.disabled = false;
                        submitBtn.innerHTML = originalText;
                    }
                });
            }
        });

  // Project application with subscription check and enhanced form
async function applyToProject(projectId, projectName) {
    if (!isUserSignedIn) {
        // Same error handling...
        return;
    }
    
    if (currentUser.account_type !== 'talent') {
        // Same error handling...
        return;
    }
    
    // Check subscription status in real-time before allowing application
    console.log(' Checking subscription before project application...');
    console.log('Current local status:', talentSubscribed);
    
    if (!talentSubscribed) {
        console.log(' Local status shows not subscribed, checking server...');
        showNotification(' Verifying your subscription status...', 'success');
        
        try {
            await checkTalentSubscriptionStatus();
            console.log(' Server check complete. Status:', talentSubscribed);
        } catch (error) {
            console.error(' Failed to verify subscription:', error);
        }
    }
    
    if (!talentSubscribed) {
        // Show subscription required error...
        return;
    }

    console.log(' Subscription verified, showing application modal');
    showProjectApplicationModal(projectId, projectName);
}
// Project application modal
function showProjectApplicationModal(projectId, projectName) {
    const modal = document.createElement('div');
    modal.className = 'project-application-modal';
    modal.style.cssText = `
        position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
        background: rgba(0, 0, 0, 0.8); z-index: 1002; 
        backdrop-filter: blur(10px); display: flex; 
        align-items: center; justify-content: center; padding: 2rem;
    `;
    
    modal.innerHTML = `
        <div class="glass-card" style="max-width: 600px; width: 100%; margin: 0 1rem;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                <h3 style="color: var(--accent-color); margin: 0;">Apply to Project</h3>
                <button class="modal-close-btn" type="button"
                        style="background: none; border: none; color: var(--text-secondary); font-size: 1.5rem; cursor: pointer;">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div style="background: rgba(102, 126, 234, 0.1); border-radius: 10px; padding: 1rem; margin-bottom: 1.5rem;">
                <h4 style="color: var(--accent-color); margin: 0 0 0.5rem 0;">Project: ${projectName}</h4>
                <p style="color: var(--text-secondary); margin: 0; font-size: 0.9rem;">
                    Your application will be sent directly to the client via email
                </p>
            </div>

            <form id="project-application-form" data-project-id="${projectId}">
                <div class="form-group">
                    <label class="form-label">Cover Letter *</label>
                    <textarea name="coverLetter" class="form-textarea" rows="4" 
                              placeholder="Tell the client why you're perfect for this project. Mention your relevant experience and what makes you unique..." required></textarea>
                </div>

                <div class="form-grid">
                    <div class="form-group">
                        <label class="form-label">Proposed Rate (Optional)</label>
                        <input type="text" name="proposedRate" class="form-input" 
                               placeholder="e.g., $150 for the project">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Timeline (Optional)</label>
                        <input type="text" name="timeline" class="form-input" 
                               placeholder="e.g., 2-3 business days">
                    </div>
                </div>

                <div style="display: flex; gap: 1rem; margin-top: 2rem;">
                    <button type="button" class="btn btn-secondary modal-cancel-btn" style="flex: 1;">
                        <i class="fas fa-times"></i>
                        Cancel
                    </button>
                    <button type="submit" class="btn btn-primary" style="flex: 2;">
                        <i class="fas fa-paper-plane"></i>
                        Send Application to Client
                    </button>
                </div>
            </form>
        </div>
    `;
    
    document.body.appendChild(modal);
    document.body.style.overflow = 'hidden';
    
    // Add proper event listeners for closing
    const closeBtn = modal.querySelector('.modal-close-btn');
    const cancelBtn = modal.querySelector('.modal-cancel-btn');
    
    closeBtn.addEventListener('click', function() {
        closeProjectApplicationModal(modal);
    });
    
    cancelBtn.addEventListener('click', function() {
        closeProjectApplicationModal(modal);
    });
    
    // Close on background click
    modal.addEventListener('click', function(e) {
        if (e.target === modal) {
            closeProjectApplicationModal(modal);
        }
    });
    
    // Handle form submission
    modal.querySelector('#project-application-form').addEventListener('submit', handleProjectApplication);
}

// Close project application modal
function closeProjectApplicationModal(modal) {
    if (modal && modal.parentNode) {
        modal.parentNode.removeChild(modal);
    }
    document.body.style.overflow = '';
}
// Handle project application submission
async function handleProjectApplication(e) {
    e.preventDefault();
    
    const form = e.target;
    const projectId = form.dataset.projectId;
    const formData = new FormData(form);
    
    const submitBtn = form.querySelector('button[type="submit"]');
    const originalText = submitBtn.innerHTML;
    submitBtn.classList.add('loading');
    submitBtn.disabled = true;
    
    try {
     const applicationData = {
    coverLetter: formData.get('message') || formData.get('coverLetter'),
    proposedRate: formData.get('proposedRate'),
    timeline: formData.get('timeline')
};
        
        const response = await apiCall(`/api/projects/${projectId}/apply`, {
            method: 'POST',
            body: JSON.stringify(applicationData)
        });
        
        // Close modal
        form.closest('div[style*="position: fixed"]').remove();
        document.body.style.overflow = '';
        
 showNotification(' Application sent to client successfully!', 'success');
                        
                        // Check if project has payment protection
                        setTimeout(async () => {
                            try {
                                const paymentCheck = await apiCall(`/api/projects/${projectId}/payment-status`);
                                if (!paymentCheck.hasPaymentProtection) {
                                    showNotification(' Tip: This project doesn\'t have payment protection yet. The client will be prompted to set it up.', 'success');
                                } else {
                                    showNotification(' This project has payment protection! You\'re guaranteed to get paid when work is completed.', 'success');
                                }
                            } catch (error) {
                                showNotification(' The client will receive your application and contact you if interested.', 'success');
                            }
                        }, 2000);
        
} catch (error) {
    console.error('Project application error:', error);
    
    form.closest('div[style*="position: fixed"]').remove();
    document.body.style.overflow = '';
    
    if (error.message.includes('404')) {
        showNotification(' Project application endpoint not available. Please contact support.', 'error');
    } else if (error.message.includes('401')) {
        showNotification(' Please sign in again to apply to projects.', 'error');
    } else {
        showNotification(` Failed to send application: ${error.message}`, 'error');
    }
    
} finally {
    submitBtn.classList.remove('loading');
    submitBtn.disabled = false;
    submitBtn.innerHTML = originalText;
}
}

        // FAQ toggle functionality
        function toggleFaq(element) {
            element.classList.toggle('active');
        }

// Personal Information Detection Safeguards
      const PERSONAL_INFO_PATTERNS = {
            email: {
                pattern: /\b[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Z|a-z]{2,}\b/g,
                message: 'Email addresses are not allowed in messages. Please keep all communication on VoicecastingPro.'
            },
            phone: {
                pattern: /(\+?\d{1,4}[-.\s]?)?\(?\d{3}\)?[-.\s]?\d{3}[-.\s]?\d{4}|\b\d{3}[-.\s]?\d{3}[-.\s]?\d{4}\b|\b\d{10,11}\b/g,
                message: 'Phone numbers are not allowed in messages. Use our platform messaging for all communication.'
            },
            socialMedia: {
                pattern: /\b(skype|whatsapp|telegram|discord|instagram|facebook|twitter|linkedin|snapchat|tiktok|youtube)\s*[:@]?\s*[\w\-\.]+\b/gi,
                message: 'Social media handles and external messaging apps are not allowed. Please communicate only through VoicecastingPro.'
            },
            urls: {
                pattern: /(https?:\/\/[^\s]+)|(www\.[^\s]+)|(\b[a-z0-9]+([\-\.]{1}[a-z0-9]+)*\.[a-z]{2,5}(:[0-9]{1,5})?(\/.*)?)/gi,
                message: 'External website links are not allowed. Please share content through our platform messaging.'
            },
            externalContact: {
                pattern: /\b(call me|text me|email me|reach me at|contact me at|find me on|add me on|dm me|message me on|my number is|here\'s my number|phone me)\b/gi,
                message: 'Please keep all communication on VoicecastingPro. External contact requests are not allowed.'
            },
            personalDetails: {
                pattern: /\b(my address is|home address|office address|street address|zip code|postal code|live at|located at \d+|my location is)\b/gi,
                message: 'Please do not share personal address information for your safety and security.'
            }
        };
   function detectPersonalInfo(text) {
            const violations = [];
            
            // Get allowed names from current conversation participants
            const allowedNames = [];
            if (currentUser) {
                allowedNames.push(currentUser.first_name.toLowerCase());
                allowedNames.push(currentUser.last_name.toLowerCase());
                allowedNames.push(`${currentUser.first_name} ${currentUser.last_name}`.toLowerCase());
            }
            if (currentConversation) {
                const participantNames = currentConversation.participantName.toLowerCase().split(' ');
                allowedNames.push(...participantNames);
                allowedNames.push(currentConversation.participantName.toLowerCase());
            }
            
            for (const [type, config] of Object.entries(PERSONAL_INFO_PATTERNS)) {
                const matches = text.match(config.pattern);
                if (matches) {
                    // Filter out allowed names from violations
                    const filteredMatches = matches.filter(match => {
                        const lowerMatch = match.toLowerCase().trim();
                        
                        // Allow participant names and common first names
                        if (allowedNames.some(name => lowerMatch.includes(name))) {
                            return false;
                        }
                        
                        // Allow common first names (basic list)
                        const commonFirstNames = ['hi', 'hello', 'thanks', 'thank you', 'please', 'yes', 'no'];
                        if (commonFirstNames.includes(lowerMatch)) {
                            return false;
                        }
                        
                        return true;
                    });
                    
                    if (filteredMatches.length > 0) {
                        violations.push({
                            type: type,
                            message: config.message,
                            matches: filteredMatches
                        });
                    }
                }
            }
            
            return violations;
        }


        function sanitizeMessage(text) {
            let sanitized = text;
            
            // Replace email addresses
            sanitized = sanitized.replace(PERSONAL_INFO_PATTERNS.email.pattern, '[EMAIL REMOVED]');
            
            // Replace phone numbers
            sanitized = sanitized.replace(PERSONAL_INFO_PATTERNS.phone.pattern, '[PHONE NUMBER REMOVED]');
            
            // Replace social media mentions
            sanitized = sanitized.replace(PERSONAL_INFO_PATTERNS.socialMedia.pattern, '[EXTERNAL CONTACT REMOVED]');
            
            // Replace URLs
            sanitized = sanitized.replace(PERSONAL_INFO_PATTERNS.urls.pattern, '[EXTERNAL LINK REMOVED]');
            
            return sanitized;
        }

        function showPersonalInfoWarning(violations) {
            const modal = document.createElement('div');
            modal.className = 'personal-info-warning-modal';
            modal.style.cssText = `
                position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
                background: rgba(0, 0, 0, 0.9); z-index: 1003; 
                backdrop-filter: blur(10px); display: flex; 
                align-items: center; justify-content: center; padding: 2rem;
            `;
            
            modal.innerHTML = `
                <div class="glass-card" style="max-width: 600px; width: 100%; margin: 0 1rem; border-color: var(--warning-color); background: rgba(255, 107, 107, 0.1);">
                    <div style="text-align: center; margin-bottom: 1.5rem;">
                        <div style="font-size: 3rem; margin-bottom: 1rem;"></div>
                        <h3 style="color: var(--warning-color); margin-bottom: 1rem;">Personal Information Detected</h3>
                        <p style="color: var(--text-secondary); margin-bottom: 1.5rem;">
                            We detected personal contact information in your message. For your safety and to maintain platform integrity, please keep all communication on VoicecastingPro.
                        </p>
                    </div>
                    
                    <div style="background: rgba(0, 0, 0, 0.2); border-radius: 10px; padding: 1.5rem; margin-bottom: 1.5rem;">
                        <h4 style="color: var(--warning-color); margin-bottom: 1rem;">Issues Found:</h4>
                        ${violations.map(violation => `
                            <div style="margin-bottom: 1rem; padding: 0.8rem; background: rgba(255, 107, 107, 0.1); border-radius: 8px;">
                                <p style="margin: 0; color: var(--text-primary); font-weight: 600;">${violation.message}</p>
                                <small style="color: var(--text-secondary);">Detected: ${violation.matches.join(', ')}</small>
                            </div>
                        `).join('')}
                    </div>
                    
                    <div style="background: rgba(0, 212, 255, 0.1); border-radius: 10px; padding: 1.5rem; margin-bottom: 1.5rem;">
                        <h4 style="color: var(--accent-color); margin-bottom: 1rem;"> Platform Benefits:</h4>
                        <ul style="color: var(--text-secondary); margin: 0; padding-left: 1.5rem;">
                            <li>Secure messaging with built-in protections</li>
                            <li>Project history and file sharing</li>
                            <li>Dispute resolution and support</li>
                            <li>Professional reputation building</li>
                            <li>Payment protection and invoicing</li>
                        </ul>
                    </div>
                    
                    <div style="display: flex; gap: 1rem; justify-content: center;">
                        <button class="btn btn-secondary" onclick="closePersonalInfoWarning()" style="flex: 1; max-width: 150px;">
                            <i class="fas fa-times"></i>
                            Cancel
                        </button>
                        <button class="btn btn-primary" onclick="sendSanitizedMessage()" style="flex: 2; max-width: 200px;">
                            <i class="fas fa-shield-alt"></i>
                            Send Safe Version
                        </button>
                    </div>
                    
                    <div style="text-align: center; margin-top: 1rem; padding: 1rem; background: rgba(0, 0, 0, 0.2); border-radius: 10px; font-size: 0.9rem; color: var(--text-secondary);">
                        <strong> Privacy Policy:</strong> Sharing personal contact information violates our Terms of Service and may result in account restrictions.
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            document.body.style.overflow = 'hidden';
        }

        function closePersonalInfoWarning() {
            const modal = document.querySelector('.personal-info-warning-modal');
            if (modal) {
                modal.remove();
                document.body.style.overflow = '';
            }
        }

        function sendSanitizedMessage() {
            const messageInput = document.getElementById('message-input');
            const sanitized = sanitizeMessage(messageInput.value);
            messageInput.value = sanitized;
            
            closePersonalInfoWarning();
            
            // Proceed with sending the sanitized message
            const sendForm = document.getElementById('send-message-form');
            if (sendForm) {
                sendForm.dispatchEvent(new Event('submit'));
            }
        }

        // API Helper Functions
        async function apiCall(endpoint, options = {}) {
            const defaultHeaders = {
                'Content-Type': 'application/json',
                'Accept': 'application/json'
            };

       if (authToken) {
    defaultHeaders['Authorization'] = `Bearer ${authToken}`;
}

// Log the request for debugging
console.log(` API Call: ${endpoint}`, { 
    method: options.method || 'GET', 
    hasAuth: !!authToken,
    headers: defaultHeaders 
});

const config = {
    headers: defaultHeaders,
    ...options,
    headers: {
        ...defaultHeaders,
        ...(options.headers || {})
    }
};

            console.log(`API Call: ${endpoint}`, config);

            try {
                const response = await fetch(`${API_BASE_URL}${endpoint}`, config);
                
                console.log(`API Response: ${endpoint}`, response.status, response.statusText);
                
                // Log response headers for debugging
                console.log('Response headers:', Object.fromEntries(response.headers.entries()));
                
                if (!response.ok) {
                    let errorMessage;
                    const contentType = response.headers.get('content-type');
                    
                    if (contentType && contentType.includes('application/json')) {
                        try {
                            const errorData = await response.json();
                            errorMessage = errorData.error || errorData.message || `HTTP ${response.status}`;
                        } catch (parseError) {
                            errorMessage = `HTTP ${response.status}: ${response.statusText}`;
                        }
                    } else {
                        const errorText = await response.text();
                        errorMessage = errorText || `HTTP ${response.status}: ${response.statusText}`;
                    }
                    
                    console.error('API Error Response:', errorMessage);
                    throw new Error(errorMessage);
                }
                
                // Try to parse JSON response
                const contentType = response.headers.get('content-type');
                if (contentType && contentType.includes('application/json')) {
                    const data = await response.json();
                    console.log('API Success Response:', data);
                    return data;
                } else {
                    // Handle non-JSON responses (like plain text success messages)
                    const text = await response.text();
                    console.log('API Text Response:', text);
                    return { success: true, message: text || 'Operation completed successfully' };
                }
                
            } catch (error) {
                console.error('API Call Failed:', endpoint, error);
                
                // Network error handling
                if (error.name === 'TypeError' && error.message.includes('fetch')) {
                    throw new Error('Network error - please check your internet connection');
                }
                
                throw error;
            }
        }

        // Load talent data
        async function loadTalentData() {
            try {
                console.log('Loading talent data...');
                const response = await apiCall('/api/talent');
                console.log('Talent API response:', response);
                console.log(`Found ${response.talent?.length || 0} talent profiles`);
                
                if (response.talent && response.talent.length > 0) {
                    response.talent.forEach(talent => {
                        console.log(`Talent: ${talent.first_name} ${talent.last_name}, Subscription: ${talent.subscription_active}`);
                    });
                }
                
                displayTalentGrid(response.talent || []);
            } catch (error) {
                console.error('Failed to load talent:', error);
                displayTalentGrid([]); // Show empty state
            }
        }

        // Display talent grid
        function displayTalentGrid(talent) {
            const talentGrid = document.getElementById('talent-grid');
            if (!talentGrid) return;

            // Filter to only show actual talent accounts (not clients)
            const actualTalent = talent.filter(t => t.account_type === 'talent' && t.bio);

            if (actualTalent.length === 0) {
                talentGrid.innerHTML = `
                    <div class="glass-card" style="grid-column: 1 / -1; text-align: center;">
                        <h3>No Voice Talent Found</h3>
                        <p style="color: var(--text-secondary);">No voice talent profiles are currently available. Check back soon!</p>
                    </div>
                `;
                return;
            }

            talentGrid.innerHTML = actualTalent.map(t => {
                // Safely escape values for HTML attributes
                const talentId = String(t.id || '').replace(/'/g, '&#39;');
                const firstName = String(t.first_name || '').replace(/'/g, '&#39;');
                const lastName = String(t.last_name || '').replace(/'/g, '&#39;');
                const fullName = `${firstName} ${lastName}`;
                const email = String(t.email || '').replace(/'/g, '&#39;');
                
                return `
                <div class="glass-card hover-lift">
                    <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 1.5rem;">

<div style="width: 70px; height: 70px; border-radius: 50%; background: var(--primary-gradient); display: flex; align-items: center; justify-content: center; font-size: 1.5rem; font-weight: 800; color: white; overflow: hidden;">
                            ${t.profile_photo ? 
                                `<img src="${API_BASE_URL}/uploads/profiles/${t.profile_photo}" style="width: 100%; height: 100%; object-fit: cover;" alt="${t.first_name} ${t.last_name}">` : 
                                `${t.first_name?.[0] || ''}${t.last_name?.[0] || ''}`
                            }
                        </div>
                        <div>
                            <h3 style="margin-bottom: 0.2rem;">${t.first_name} ${t.last_name}</h3>
                            <div style="display: flex; align-items: center; gap: 0.3rem; color: #ffd700; font-size: 0.9rem;">
                                ${''.repeat(Math.floor(t.rating || 5))}
                                <span style="color: var(--text-secondary); margin-left: 0.5rem;">${t.rating || 5}.0 (${t.completed_projects || 0} reviews)</span>
                            </div>
                        </div>
                    </div>
                    
                    <div style="display: flex; flex-wrap: wrap; gap: 0.5rem; margin-bottom: 1.5rem;">
                        ${(t.languages || '').split(',').slice(0, 3).map(lang => 
                            `<span style="background: rgba(102, 126, 234, 0.2); color: var(--accent-color); padding: 0.3rem 0.8rem; border-radius: 15px; font-size: 0.9rem;">${lang.trim()}</span>`
                        ).join('')}
                    </div>

                    <div style="color: var(--text-secondary); margin-bottom: 1.5rem;">
                        <p class="talent-bio" style="line-height: 1.6;">${t.bio || 'No bio available.'}</p>
<button class="read-more-btn" onclick="toggleBio(this)" style="background: none; border: none; color: var(--accent-color); cursor: pointer; font-size: 0.9rem; text-decoration: underline; padding: 0; margin-top: 0.5rem; display: none;">
    Read more
</button>
                    </div>

                    <!-- Audio Demo Section -->
                    <div style="margin-bottom: 1.5rem;">
                        <div style="background: rgba(102, 126, 234, 0.1); border: 1px solid rgba(102, 126, 234, 0.3); border-radius: 10px; padding: 1rem; text-align: center;">
                            ${t.demo_count > 0 ? `
                                <div style="display: flex; align-items: center; justify-content: center; gap: 0.5rem; margin-bottom: 0.5rem;">
                                    <i class="fas fa-play-circle" style="color: var(--accent-color); font-size: 1.2rem;"></i>
                                    <span style="color: var(--text-primary); font-weight: 600;">${t.demo_count} Audio Demo${t.demo_count > 1 ? 's' : ''}</span>
                                </div>
                                <button class="btn btn-secondary" style="padding: 0.4rem 1rem; font-size: 0.9rem;" onclick="playTalentDemo('${talentId}', '${fullName}')">
                                    <i class="fas fa-headphones"></i>
                                    Listen to Demos
                                </button>
                            ` : `
                                <div style="color: var(--text-secondary); font-size: 0.9rem;">
                                    <i class="fas fa-microphone-slash" style="margin-right: 0.5rem;"></i>
                                    No audio demos available
                                </div>
                            `}
                        </div>
                    </div>

                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <span style="font-weight: 600; color: var(--accent-color);">${t.hourly_rate_min || 100}-${t.hourly_rate_max || 300}/hr</span>
                        <button class="btn btn-primary" style="padding: 0.6rem 1.5rem;" onclick="contactTalent('${fullName}', '${email}')">
                            <i class="fas fa-envelope" style="font-size: 0.9rem;"></i>
                            Contact
                        </button>
                    </div>
                </div>
            `;
            }).join('');
            
            // Check for bio overflow after DOM is ready - IMPROVED VERSION
setTimeout(() => {
    console.log(' Checking for bio overflow...');
    
    document.querySelectorAll('.talent-bio').forEach((bio, index) => {
        const readMoreBtn = bio.parentNode.querySelector('.read-more-btn');
        console.log(`Bio ${index}:`, {
            scrollHeight: bio.scrollHeight,
            clientHeight: bio.clientHeight,
            hasButton: !!readMoreBtn,
            textLength: bio.textContent.length,
            bioText: bio.textContent.substring(0, 50) + '...'
        });
        
        if (readMoreBtn) {
            // Force show button if bio text is longer than 120 characters OR if scrollHeight > clientHeight
            if (bio.textContent.length > 120 || bio.scrollHeight > bio.clientHeight + 2) {
                readMoreBtn.style.display = 'inline-block';
                console.log(` Showing read more button for bio ${index}`);
            } else {
                console.log(` Bio ${index} too short, hiding button`);
            }
        } else {
            console.log(` No read-more button found for bio ${index}`);
        }
    });
    
    // Also handle project descriptions
    document.querySelectorAll('.project-description').forEach((desc, index) => {
        const readMoreBtn = desc.parentNode.querySelector('.read-more-btn');
        if (readMoreBtn) {
            if (desc.textContent.length > 120 || desc.scrollHeight > desc.clientHeight + 2) {
                readMoreBtn.style.display = 'inline-block';
            }
        }
    });
}, 500); // Increased timeout to 500ms
       



 }
        // Load projects data
        async function loadProjectsData() {
            try {
                const response = await apiCall('/api/projects');
                displayProjectsGrid(response.projects || []);
            } catch (error) {
                console.error('Failed to load projects:', error);
                displayProjectsGrid([]);
            }
        }

// Load client's own projects for modal
        async function loadClientProjectsInModal() {
            const projectsGrid = document.getElementById('client-projects-grid');
            if (!projectsGrid) {
                console.error('Projects grid not found in modal');
                return;
            }
            
            try {
                console.log('Loading client projects for modal...');
                console.log('Current user:', currentUser);
                console.log('Auth token available:', !!authToken);
                
                // Get all projects and filter for current user on frontend
const response = await apiCall('/api/projects');
const allProjects = response.projects || [];
const myProjects = allProjects.filter(project => 
    project.client_email === currentUser.email || 
    project.client_id === currentUser.id
);
             console.log('My projects API response:', response);
console.log(`Found ${myProjects.length} projects for current user`);

if (myProjects.length > 0) {
    myProjects.forEach((project, index) => {
        console.log(`Project ${index + 1}:`, {
            id: project.id,
            title: project.title,
            created_at: project.created_at,
            client_id: project.client_id,
            status: project.status
        });
    });
}
                
displayClientProjectsGrid(myProjects);  
          
            } catch (error) {
                console.error('Failed to load client projects:', error);
                
                // Show error state with retry option
                projectsGrid.innerHTML = `
                    <div class="glass-card" style="text-align: center; border-color: var(--warning-color); background: rgba(255, 107, 107, 0.1);">
                        <h3 style="color: var(--warning-color);"> Failed to Load Projects</h3>
                        <p style="color: var(--text-secondary); margin-bottom: 1rem;">
                            ${error.message || 'Unable to fetch your projects from the server.'}
                        </p>
                        <div style="display: flex; gap: 1rem; justify-content: center; flex-wrap: wrap;">
                            <button class="btn btn-secondary" onclick="loadClientProjectsInModal()">
                                <i class="fas fa-refresh"></i>
                                Try Again
                            </button>
                            <button class="btn btn-primary" onclick="showPage('post-project'); closeClientProjectModal()">
                                <i class="fas fa-plus-circle"></i>
                                Post New Project
                            </button>
                        </div>
                        <div style="margin-top: 1rem; padding: 1rem; background: rgba(0, 212, 255, 0.1); border-radius: 10px; font-size: 0.9rem; color: var(--text-secondary);">
                            <strong> Troubleshooting:</strong><br>
                             Make sure you're signed in as a client<br>
                             Try refreshing the page<br>
                             Check that you've posted projects before
                        </div>
                    </div>
                `;
            }
        }


// Load client's own projects
        async function loadClientProjects() {
            try {
            // Get all projects and filter for current user on frontend
const response = await apiCall('/api/projects');
const allProjects = response.projects || [];
const myProjects = allProjects.filter(project => 
    project.client_email === currentUser.email || 
    project.client_id === currentUser.id
);
const filteredResponse = { projects: myProjects };
                displayClientProjectsGrid(response.projects || []);
            } catch (error) {
                console.error('Failed to load client projects:', error);
                displayClientProjectsGrid([]);
            }
        }

       // Display client's projects with management options
function displayClientProjectsGrid(projects) {
    const projectsGrid = document.getElementById('client-projects-grid');
    if (!projectsGrid) return;

    if (projects.length === 0) {
        projectsGrid.innerHTML = `
            <div class="glass-card" style="text-align: center;">
                <div style="font-size: 3rem; margin-bottom: 1rem;"></div>
                <h3>No Projects Posted Yet</h3>
                <p style="color: var(--text-secondary); margin-bottom: 2rem;">
                    Start by posting your first voice over project to connect with talented voice artists!
                </p>
                <div style="display: flex; gap: 1rem; justify-content: center; flex-wrap: wrap;">
                    <button class="btn btn-primary" onclick="showPage('post-project'); closeClientProjectModal()" style="min-width: 160px;">
                        <i class="fas fa-plus-circle"></i>
                        Post Your First Project
                    </button>
                    <button class="btn btn-secondary" onclick="createTestProject()" style="min-width: 160px;">
                        <i class="fas fa-flask"></i>
                        Create Test Project
                    </button>
                </div>
                <div style="margin-top: 2rem; padding: 1rem; background: rgba(0, 212, 255, 0.1); border-radius: 10px; font-size: 0.9rem; color: var(--text-secondary);">
                    <strong> Tips:</strong><br>
                     Projects are free to post<br>
                     Applications come directly to your email<br>
                     Projects auto-expire after 60 days<br>
                     You can edit or delete projects anytime
                </div>
            </div>
        `;
        return;
    }

    projectsGrid.innerHTML = projects.map(project => {
        const projectId = String(project.id || '').replace(/'/g, '&#39;');
        const projectTitle = String(project.title || '').replace(/'/g, '&#39;');
        const statusColor = project.status === 'active' ? 'var(--success-color)' : 
                          project.status === 'completed' ? 'var(--accent-color)' : 'var(--warning-color)';

// Calculate project age and expiration
        let daysUntilExpiry, isExpiringSoon, isExpired;
        const createdDate = new Date(project.created_at);
        const now = new Date();
        const daysOld = Math.floor((now - createdDate) / (1000 * 60 * 60 * 24));
        
        // DEBUG: Log project data to see what we're getting
        console.log(' PROJECT DEBUG:', {
            id: project.id,
            title: project.title,
            expiration_date: project.expiration_date,
            created_at: project.created_at,
            daysOld: daysOld
        });
        
        if (project.expiration_date) {
            // Use actual expiration date if available
            const expirationDate = new Date(project.expiration_date);
            daysUntilExpiry = Math.max(0, Math.ceil((expirationDate - now) / (1000 * 60 * 60 * 24)));
            isExpiringSoon = daysUntilExpiry <= 7;
            isExpired = daysUntilExpiry === 0;
            console.log(' Using expiration_date:', expirationDate, 'Days left:', daysUntilExpiry);
        } else {
            // Fallback for old projects without expiration_date
            daysUntilExpiry = Math.max(0, 60 - daysOld);
            isExpiringSoon = daysUntilExpiry <= 7;
            isExpired = daysUntilExpiry === 0;
            console.log(' No expiration_date found, using 60-day fallback. Days left:', daysUntilExpiry);
        }    
        return `
        <div class="glass-card hover-lift" style="${isExpired ? 'border-color: var(--warning-color); background: rgba(255, 107, 107, 0.05);' : ''}">
<div style="margin-bottom: 1.5rem;">
    <h3 style="font-size: 1.5rem; margin-bottom: 0.5rem; color: var(--text-primary);">${project.title}</h3>
    <div style="display: flex; flex-wrap: wrap; gap: 0.5rem; margin-bottom: 1rem;">
                        <span style="background: rgba(102, 126, 234, 0.2); color: var(--accent-color); padding: 0.3rem 0.8rem; border-radius: 15px; font-size: 0.9rem;">$${project.budget_min || 0}-${project.budget_max || 0}</span>
                        <span style="background: rgba(102, 126, 234, 0.2); color: var(--accent-color); padding: 0.3rem 0.8rem; border-radius: 15px; font-size: 0.9rem;">${project.language || 'Any'}</span>
                        <span style="background: rgba(102, 126, 234, 0.2); color: ${statusColor}; padding: 0.3rem 0.8rem; border-radius: 15px; font-size: 0.9rem;">${project.status || 'active'}</span>
                        ${isExpired ? 
                            `<span style="background: var(--warning-color); color: white; padding: 0.3rem 0.8rem; border-radius: 15px; font-size: 0.9rem;"> EXPIRED</span>` :
                            isExpiringSoon ? 
                            `<span style="background: rgba(255, 193, 7, 0.8); color: white; padding: 0.3rem 0.8rem; border-radius: 15px; font-size: 0.9rem;"> ${daysUntilExpiry}d left</span>` :
                            `<span style="background: rgba(40, 167, 69, 0.8); color: white; padding: 0.3rem 0.8rem; border-radius: 15px; font-size: 0.9rem;"> ${daysUntilExpiry}d left</span>`
                        }
                    </div>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 0.5rem; font-size: 0.9rem; color: var(--text-secondary); margin-bottom: 1rem;">
                        <div>Posted: ${createdDate.toLocaleDateString()}</div>
                        <div>Applications: ${project.application_count || 0}</div>
                        <div>Views: ${project.view_count || 0}</div>
                        <div>Age: ${daysOld} days</div>
                    </div>
                </div>
            </div>
            <div style="color: var(--text-secondary); margin-bottom: 2rem;">
    <p class="project-description" style="line-height: 1.6; max-height: 4.8em; overflow: hidden; transition: max-height 0.3s ease; margin: 0;">${project.description}</p>
<button class="read-more-btn" onclick="toggleProjectDescription(this)" style="background: none; border: none; color: var(--accent-color); cursor: pointer; font-size: 0.9rem; text-decoration: underline; padding: 0; margin-top: 0.5rem; display: none;">
    Read more
</button>
</div>
            
            ${isExpired ? `
                <div style="background: rgba(255, 107, 107, 0.1); border: 1px solid var(--warning-color); border-radius: 10px; padding: 1rem; margin-bottom: 1.5rem; text-align: center;">
                    <div style="color: var(--warning-color); font-weight: 600; margin-bottom: 0.5rem;">
                        <i class="fas fa-exclamation-triangle"></i> This project has expired
                    </div>
                    <div style="color: var(--text-secondary); font-size: 0.9rem;">
                        Projects are automatically removed after 60 days. Delete this project to clean up your list.
                    </div>
                </div>
            ` : ''}
            
            <div style="display: flex; gap: 1rem; flex-wrap: wrap;">
                ${!isExpired ? `
                    <button class="btn btn-secondary" onclick="editProject('${projectId}', '${projectTitle}')" style="flex: 1; min-width: 120px;">
                        <i class="fas fa-edit"></i>
                        Edit
                    </button>
                    <button class="btn btn-primary" onclick="viewProjectApplications('${projectId}', '${projectTitle}')" style="flex: 1; min-width: 120px;">
                        <i class="fas fa-eye"></i>
                        View Applications (${project.application_count || 0})
                    </button>
                ` : ''}
                <button class="btn" onclick="deleteProject('${projectId}', '${projectTitle}')" 
                        style="background: var(--warning-color); color: white; flex: 1; min-width: 120px;">
                    <i class="fas fa-trash"></i>
                    Delete
                </button>
            </div>
        </div>
    `;
    }).join('');
}

    // Display projects grid
        function displayProjectsGrid(projects) {
            const projectsGrid = document.getElementById('projects-grid');
            if (!projectsGrid) return;

            // Filter out expired projects
            const activeProjects = projects.filter(project => {
                if (project.expiration_date) {
                    return new Date(project.expiration_date) > new Date();
                }
                // Fallback: Use 60-day rule for old projects without expiration_date
                const createdDate = new Date(project.created_at);
                const daysOld = Math.floor((new Date() - createdDate) / (1000 * 60 * 60 * 24));
                return daysOld <= 60;
            });

            if (activeProjects.length === 0) {
                projectsGrid.innerHTML = `
                    <div class="glass-card" style="text-align: center;">
                        <h3>No Active Projects Available</h3>
                        <p style="color: var(--text-secondary);">Check back soon for new voice over opportunities!</p>
                    </div>
                `;
                return;
            }

           projectsGrid.innerHTML = projects.map(project => {
                const projectId = String(project.id || '').replace(/'/g, '&#39;');
                const projectTitle = String(project.title || '').replace(/'/g, '&#39;');
                
               // Calculate expiration info
                let expirationInfo = '';
                let expirationClass = '';
                
                // DEBUG: Log project data to see what we're getting
                console.log(' PUBLIC PROJECT DEBUG:', {
                    id: project.id,
                    title: project.title,
                    expiration_date: project.expiration_date,
                    created_at: project.created_at
                });
                
                if (project.expiration_date) {
                    const expirationDate = new Date(project.expiration_date);
                    const daysUntilExpiry = Math.max(0, Math.ceil((expirationDate - new Date()) / (1000 * 60 * 60 * 24)));
                    
                    console.log(' Using expiration_date:', expirationDate, 'Days left:', daysUntilExpiry);
                    
                    if (daysUntilExpiry <= 2) {
                        expirationClass = 'color: var(--warning-color); font-weight: 600;';
                        expirationInfo = ` Expires in ${daysUntilExpiry} day${daysUntilExpiry !== 1 ? 's' : ''}`;
                    } else if (daysUntilExpiry <= 7) {
                        expirationClass = 'color: var(--accent-color); font-weight: 600;';
                        expirationInfo = ` Expires in ${daysUntilExpiry} days`;
                    } else {
                        expirationClass = 'color: var(--text-secondary);';
                        expirationInfo = ` Expires in ${daysUntilExpiry} days`;
                    }
                } else {
                    // Fallback for old projects
                    const createdDate = new Date(project.created_at);
                    const daysOld = Math.floor((new Date() - createdDate) / (1000 * 60 * 60 * 24));
                    const daysLeft = Math.max(0, 60 - daysOld);
                    expirationClass = 'color: var(--text-secondary);';
                    expirationInfo = ` Expires in ${daysLeft} days`;
                    console.log(' No expiration_date found, using 60-day fallback. Days left:', daysLeft);
                }
                
                return `
                <div class="glass-card hover-lift">
  <div style="margin-bottom: 1.5rem;">
    <h3 style="font-size: 1.5rem; margin-bottom: 0.5rem; color: var(--text-primary);">${project.title}</h3>
    <div style="display: flex; flex-wrap: wrap; gap: 0.5rem; margin-bottom: 1rem;">
        <span style="background: rgba(102, 126, 234, 0.2); color: var(--accent-color); padding: 0.3rem 0.8rem; border-radius: 15px; font-size: 0.9rem;">${project.budget_min || 0}-${project.budget_max || 0}</span>
        <span style="background: rgba(102, 126, 234, 0.2); color: var(--accent-color); padding: 0.3rem 0.8rem; border-radius: 15px; font-size: 0.9rem;">${project.language || 'Any'}</span>
        <span style="background: rgba(102, 126, 234, 0.2); color: var(--accent-color); padding: 0.3rem 0.8rem; border-radius: 15px; font-size: 0.9rem;">${project.estimated_duration || 'TBD'}</span>
<span style="background: rgba(102, 126, 234, 0.2); color: var(--accent-color); padding: 0.3rem 0.8rem; border-radius: 15px; font-size: 0.9rem;">${project.estimated_duration || 'TBD'}</span>
${project.payment_protection ? 
    `<span style="background: var(--success-color); color: white; padding: 0.3rem 0.8rem; border-radius: 15px; font-size: 0.9rem;"> Escrow Protected</span>` : 
    (isUserSignedIn === true && currentUser && currentUser.account_type === 'client' && authToken ? 
        `<button onclick="setupProjectPayment('${project.id}', '${project.title}', ${project.budget_min || 500}, ${project.budget_max || 1000})" style="background: var(--warning-color); color: white; padding: 0.3rem 0.8rem; border-radius: 15px; font-size: 0.9rem; border: none; cursor: pointer; transition: all 0.2s ease;" onmouseover="this.style.background='#ff5252'" onmouseout="this.style.background='var(--warning-color)'"> Setup Payment</button>` : 
        ''
    )
}
        <span style="background: rgba(102, 126, 234, 0.1); ${expirationClass} padding: 0.3rem 0.8rem; border-radius: 15px; font-size: 0.9rem;">${expirationInfo}</span>
    </div>
</div>
<div style="color: var(--text-secondary); margin-bottom: 2rem;">
    <p class="project-description" style="line-height: 1.6;">${project.description}</p>
    ${(project.description || '').length > 120 ? `
        <button class="read-more-btn" onclick="toggleProjectDescription(this)" style="background: none; border: none; color: var(--accent-color); cursor: pointer; font-size: 0.9rem; text-decoration: underline; padding: 0; margin-top: 0.5rem;">
            Read more
        </button>
    ` : ''}
</div>

<div style="display: flex; justify-content: space-between; align-items: center; margin-top: 1.5rem;">
                    <span style="font-weight: 600; color: var(--accent-color);">Posted: ${new Date(project.created_at || Date.now()).toLocaleDateString()}</span>
<button class="btn btn-primary" onclick="applyToProject('${projectId}', '${projectTitle}')" style="padding: 0.6rem 1.5rem;">
    <i class="fas fa-paper-plane"></i>
    Apply to Project
</button>
                </div>
            </div>
        `;
        }).join('');
    }

// Clean up expired projects
        async function cleanupExpiredProjects() {
            const confirmed = confirm(`This will automatically delete all projects older than 60 days.\n\n` +
                `Are you sure you want to clean up expired projects?\n\n` +
                `This action cannot be undone.`);
            
            if (!confirmed) return;

            try {
                showNotification(' Cleaning up expired projects...', 'success');
                
                const response = await apiCall('/api/projects/cleanup-expired', {
                    method: 'POST'
                });
                
                const deletedCount = response.deletedCount || 0;
                
                if (deletedCount > 0) {
                    showNotification(` Cleaned up ${deletedCount} expired project${deletedCount > 1 ? 's' : ''}!`, 'success');
                } else {
                    showNotification(' No expired projects found to clean up.', 'success');
                }
                
                loadClientProjectsInModal(); // Reload the list
                loadProjectsData(); // Refresh public projects list
                
            } catch (error) {
                console.error('Cleanup expired projects error:', error);
                showNotification(` Failed to clean up projects: ${error.message}`, 'error');
            }
        }

       

// Delete project function
async function deleteProject(projectId, projectTitle) {
    console.log(' Starting delete process for:', projectId, projectTitle);
    
    const confirmed = confirm(`Are you sure you want to delete "${projectTitle}"?\n\n` +
        `This will:\n` +
        ` Remove the project from the website\n` +
        ` Delete all applications\n` +
        ` This action cannot be undone\n\n` +
        `Click OK to proceed with deletion.`);
    
    if (!confirmed) {
        console.log(' User cancelled deletion');
        return;
    }

    // For extra security on delete, ask for title confirmation
    const confirmTitle = prompt(`Type the project title to confirm deletion:\n\n"${projectTitle}"`);
    if (confirmTitle === null || confirmTitle !== projectTitle) {
        console.log(' Title mismatch:', confirmTitle, 'vs', projectTitle);
        showNotification(' Project deletion cancelled - title did not match.', 'error');
        return;
    }

    try {
        console.log(' Attempting to delete project...');
        showNotification(' Deleting project...', 'success');
        
        // Delete from all projects endpoint since my-projects doesn't exist
        const response = await fetch(`${API_BASE_URL}/api/projects/${projectId}`, {
            method: 'DELETE',
            headers: {
                'Content-Type': 'application/json',
                'Authorization': authToken ? `Bearer ${authToken}` : ''
            }
        });
        
        console.log(' Delete response status:', response.status);
        console.log(' Delete response headers:', response.headers);
        
        if (!response.ok) {
            const errorText = await response.text();
            console.error(' Server error:', response.status, errorText);
            throw new Error(`Server error ${response.status}: ${errorText || response.statusText}`);
        }
        
        console.log(' Delete successful!');
        showNotification(' Project deleted successfully', 'success');
        
        // Refresh the data - check if we're in modal or not
        const modalExists = document.querySelector('.client-project-modal');
        if (modalExists) {
            loadClientProjectsInModal(); // Reload the modal list
        } else {
            loadClientProjects(); // Reload the regular list
        }
        loadProjectsData(); // Refresh public projects list
        
    } catch (error) {
        console.error(' Delete project error:', error);
        showNotification(` Failed to delete project: ${error.message}`, 'error');
        
        // Show detailed error for debugging
        alert(`Debug Info:\nProject ID: ${projectId}\nError: ${error.message}\nCheck browser console for more details.`);
    }
}      

// Edit project function
function editProject(projectId, projectTitle) {
    console.log(' Edit project clicked:', { projectId, projectTitle });
    console.log(' User signed in:', isUserSignedIn);
    console.log(' Current user:', currentUser);
    
    if (!isUserSignedIn) {
        showNotification(' Please sign in to edit projects', 'error');
        return;
    }
    
    showEditProjectModal(projectId, projectTitle);
}

// Show edit project modal
async function showEditProjectModal(projectId, projectTitle) {
    try {
        console.log(' Loading edit modal for:', projectId, projectTitle);
        showNotification(' Loading project data...', 'success');
        
        // Get current project data from API
        const response = await apiCall('/api/projects');
        console.log(' All projects response:', response);
        
        const allProjects = response.projects || [];
        console.log(' Total projects found:', allProjects.length);
        
        const project = allProjects.find(p => String(p.id) === String(projectId));
        console.log(' Found project for edit:', project);
        
        if (!project) {
            console.error(' Project not found. ProjectId:', projectId, 'Available projects:', allProjects.map(p => ({id: p.id, title: p.title})));
            showNotification(' Project not found', 'error');
            return;
        }
        
        // Create modal with simplified form
        const modal = document.createElement('div');
        modal.className = 'edit-project-modal';
        modal.style.cssText = `
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
            background: rgba(0, 0, 0, 0.8); z-index: 1002; 
            backdrop-filter: blur(10px); display: flex; 
            align-items: center; justify-content: center; padding: 2rem;
        `;
        
        modal.innerHTML = `
            <div class="glass-card" style="max-width: 800px; width: 100%; margin: 0 1rem; max-height: 80vh; overflow-y: auto;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                    <h3 style="color: var(--accent-color); margin: 0;"> Edit Project</h3>
                    <button class="modal-close-btn" type="button"
                            style="background: none; border: none; color: var(--text-secondary); font-size: 1.5rem; cursor: pointer;">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                
                <div style="background: rgba(0, 212, 255, 0.1); border-radius: 10px; padding: 1rem; margin-bottom: 1.5rem;">
                    <h4 style="color: var(--accent-color); margin: 0 0 0.5rem 0;"> Editing Project</h4>
                    <p style="color: var(--text-secondary); margin: 0; font-size: 0.9rem;">
                        Project ID: ${projectId} | Original Title: "${project.title}"
                    </p>
                </div>
                
                <form id="edit-project-form" data-project-id="${projectId}">
                    <div class="form-group">
                        <label class="form-label">Project Title *</label>
                        <input type="text" name="title" class="form-input" value="${project.title || ''}" required>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Project Description *</label>
                        <textarea name="description" class="form-textarea" rows="4" required>${project.description || ''}</textarea>
                    </div>

                    <div class="form-grid">
                        <div class="form-group">
                            <label class="form-label">Language</label>
                            <select name="language" class="form-select">
                                <option value="">Select Language</option>
                                <option ${project.language === 'English' ? 'selected' : ''}>English</option>
                                <option ${project.language === 'Spanish' ? 'selected' : ''}>Spanish</option>
                                <option ${project.language === 'French' ? 'selected' : ''}>French</option>
                                <option ${project.language === 'German' ? 'selected' : ''}>German</option>
                                <option ${project.language === 'Japanese' ? 'selected' : ''}>Japanese</option>
                                <option ${project.language === 'Mandarin' ? 'selected' : ''}>Mandarin</option>
                                <option ${project.language === 'Other' ? 'selected' : ''}>Other</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Genre</label>
                            <select name="genre" class="form-select">
                                <option value="">Select Genre</option>
                                <option ${project.genre === 'Commercial' ? 'selected' : ''}>Commercial</option>
                                <option ${project.genre === 'Narration' ? 'selected' : ''}>Narration</option>
                                <option ${project.genre === 'Character' ? 'selected' : ''}>Character</option>
                                <option ${project.genre === 'Animation' ? 'selected' : ''}>Animation</option>
                                <option ${project.genre === 'E-learning' ? 'selected' : ''}>E-learning</option>
                                <option ${project.genre === 'Audiobook' ? 'selected' : ''}>Audiobook</option>
                                <option ${project.genre === 'Other' ? 'selected' : ''}>Other</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Budget Range</label>
                        <select name="budgetRange" class="form-select">
                            <option value="">Select Budget</option>
                            <option value="under-100">Under $100</option>
                            <option value="100-300">$100 - $300</option>
                            <option value="300-500">$300 - $500</option>
                            <option value="500-1000">$500 - $1000</option>
                            <option value="1000-2000">$1000 - $2000</option>
                            <option value="2000+">$2000+</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Your Contact Email</label>
                        <input type="email" name="clientEmail" class="form-input" value="${project.client_email || currentUser.email || ''}">
                    </div>

                    <div style="display: flex; gap: 1rem; margin-top: 2rem;">
                        <button type="button" class="btn btn-secondary cancel-btn" style="flex: 1;">
                            <i class="fas fa-times"></i>
                            Cancel
                        </button>
                        <button type="submit" class="btn btn-primary" style="flex: 2;">
                            <i class="fas fa-save"></i>
                            Save Changes
                        </button>
                    </div>
                </form>
            </div>
        `;
        
        document.body.appendChild(modal);
        document.body.style.overflow = 'hidden';
        
        // Add event listeners
        const closeBtn = modal.querySelector('.modal-close-btn');
        const cancelBtn = modal.querySelector('.cancel-btn');
        
        closeBtn.addEventListener('click', function() {
            closeEditProjectModal(modal);
        });
        
        cancelBtn.addEventListener('click', function() {
            closeEditProjectModal(modal);
        });
        
        // Close on background click
        modal.addEventListener('click', function(e) {
            if (e.target === modal) {
                closeEditProjectModal(modal);
            }
        });
        
        modal.querySelector('#edit-project-form').addEventListener('submit', handleEditProjectSubmit);
        
        console.log(' Edit modal created successfully');
        
    } catch (error) {
        console.error(' Error loading project for edit:', error);
        showNotification(' Failed to load project data: ' + error.message, 'error');
    }
}

// Close edit project modal
function closeEditProjectModal(modal) {
    if (modal && modal.parentNode) {
        modal.parentNode.removeChild(modal);
    }
    document.body.style.overflow = '';
}

// Handle edit project form submission
async function handleEditProjectSubmit(e) {
    e.preventDefault();
    
    const form = e.target;
    const formData = new FormData(form);
    const projectId = form.dataset.projectId;
    const submitBtn = form.querySelector('button[type="submit"]');
    
    submitBtn.classList.add('loading');
    submitBtn.disabled = true;
    
    try {




        // Parse budget range
        const budgetRange = formData.get('budgetRange');
        let budgetMin = 0, budgetMax = 0;
        
        if (budgetRange) {
            if (budgetRange === 'under-100') {
                budgetMin = 0; budgetMax = 100;
            } else if (budgetRange === '100-300') {
                budgetMin = 100; budgetMax = 300;
            } else if (budgetRange === '300-500') {
                budgetMin = 300; budgetMax = 500;
            } else if (budgetRange === '500-1000') {
                budgetMin = 500; budgetMax = 1000;
            } else if (budgetRange === '1000-2000') {
                budgetMin = 1000; budgetMax = 2000;
            } else if (budgetRange === '2000+') {
                budgetMin = 2000; budgetMax = 10000;
            }
        }
        
       const deadline = formData.get('deadline');
        
        const updateData = {
            title: formData.get('title'),
            description: formData.get('description'),
            language: formData.get('language'),
            genre: formData.get('genre'),
            voiceGender: formData.get('voiceGender'),
            budgetMin: budgetMin,
            budgetMax: budgetMax,
            estimatedDuration: formData.get('estimatedDuration'),
            deadline: deadline ? deadline + 'T12:00:00' : null,
            clientEmail: formData.get('clientEmail')
        };
        
        console.log(' Submitting project update:', updateData);
        
        const response = await apiCall(`/api/projects/${projectId}`, {
            method: 'PUT',
            body: JSON.stringify(updateData)
        });
        
        console.log(' Project update response:', response);
        showNotification(' Project updated successfully!', 'success');
        
        // Close modal
        const modal = form.closest('.edit-project-modal');
        closeEditProjectModal(modal);
        
        // Refresh the project list
        const modalExists = document.querySelector('.client-project-modal');
        if (modalExists) {
            loadClientProjectsInModal();
        } else {
            loadClientProjects();
        }
        loadProjectsData();
        
    } catch (error) {
        console.error(' Edit project error:', error);
        showNotification(` Failed to update project: ${error.message}`, 'error');
    } finally {
        submitBtn.classList.remove('loading');
        submitBtn.disabled = false;
    }
}

        // View project applications function
        function viewProjectApplications(projectId, projectTitle) {
            showNotification(' View applications feature coming soon! Applications are sent to your email.', 'success');
            // TODO: Implement applications viewer
        }

        // Form submission handlers with real API calls

        // Sign in form submission
        document.getElementById('signin-form').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const submitBtn = this.querySelector('button[type="submit"]');
            submitBtn.classList.add('loading');
            submitBtn.disabled = true;
            
            try {
                const formData = new FormData(this);
                const response = await apiCall('/api/auth/login', {
                    method: 'POST',
                    body: JSON.stringify({
                        email: formData.get('email'),
                        password: formData.get('password')
                    })
                });
                
                // Store authentication data
                try {
                    localStorage.setItem('token', response.token);
                    localStorage.setItem('user', JSON.stringify(response.user));
                } catch (error) {
                    console.log('localStorage not available - will work when deployed to Render.com');
                }
                
                authToken = response.token;
                currentUser = response.user;
                isUserSignedIn = true;
                
                updateUIForSignedInUser();
                
                showNotification(' Successfully signed in! Welcome back to VoicecastingPro.', 'success');
                
                setTimeout(() => {
                    showPage('browse-talent');
                }, 1500);
                
                this.reset();
                
            } catch (error) {
                showNotification(` ${error.message}`, 'error');
            } finally {
                submitBtn.classList.remove('loading');
                submitBtn.disabled = false;
            }
        });

        // Client signup form submission
        document.getElementById('client-signup-form').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const formData = new FormData(this);
            const password = formData.get('password');
            const confirmPassword = formData.get('confirmPassword');
            
            if (password !== confirmPassword) {
                showNotification(' Passwords do not match. Please try again.', 'error');
                return;
            }
            
            const submitBtn = this.querySelector('button[type="submit"]');
            submitBtn.classList.add('loading');
            submitBtn.disabled = true;
            
            try {
                const response = await apiCall('/api/auth/register', {
                    method: 'POST',
                    body: JSON.stringify({
                        email: formData.get('email'),
                        password: password,
                        firstName: formData.get('firstName'),
                        lastName: formData.get('lastName'),
                        accountType: 'client'
                    })
                });
                
                // Store authentication data
                try {
                    localStorage.setItem('token', response.token);
                    localStorage.setItem('user', JSON.stringify(response.user));
                } catch (error) {
                    console.log('localStorage not available - will work when deployed to Render.com');
                }
                
                authToken = response.token;
                currentUser = response.user;
                isUserSignedIn = true;
                
                updateUIForSignedInUser();
                
                showNotification(' Welcome to VoicecastingPro! Your free client account is ready.', 'success');
                
                setTimeout(() => {
                    showNotification(' You can now contact talent, post projects, and manage your voice over needs!', 'success');
                    
                    setTimeout(() => {
                        showPage('browse-talent');
                    }, 2000);
                }, 2000);
                
                this.reset();
                
            } catch (error) {
                showNotification(` ${error.message}`, 'error');
            } finally {
                submitBtn.classList.remove('loading');
                submitBtn.disabled = false;
            }
        });

        // Password reset form submission
        document.getElementById('password-reset-form').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const submitBtn = this.querySelector('button[type="submit"]');
            const originalText = submitBtn.innerHTML;
            
            submitBtn.classList.add('loading');
            submitBtn.disabled = true;
            submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Sending...';
            
            try {
                const formData = new FormData(this);
                const email = formData.get('reset-email');
                
                const response = await apiCall('/api/auth/password-reset-request', {
                    method: 'POST',
                    body: JSON.stringify({
                        email: email
                    })
                });
                
                // Hide form and show success message
                this.style.display = 'none';
                document.getElementById('reset-success').style.display = 'block';
                
                showNotification(' Password reset instructions sent to your email!', 'success');
                
            } catch (error) {
                showNotification(` ${error.message}`, 'error');
            } finally {
                submitBtn.classList.remove('loading');
                submitBtn.disabled = false;
                submitBtn.innerHTML = originalText;
            }
        });

   // Set minimum date for project deadline
        function setProjectDeadlineMinDate() {
            const deadlineInput = document.getElementById('project-deadline-input');
            if (deadlineInput) {
                const today = new Date();
                const tomorrow = new Date(today);
                tomorrow.setDate(tomorrow.getDate() + 1);
                deadlineInput.min = tomorrow.toISOString().split('T')[0];
            }
        }

        // Project form submission
        document.getElementById('project-form').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            if (!isUserSignedIn) {
                showNotification(' Please sign in or create a free client account to post projects', 'error');
                
                setTimeout(() => {
                    const choice = confirm(`To post projects you need a free client account:\n\nOK = Create FREE client account\nCancel = Sign in to existing account`);
                    
                    if (choice) {
                        showPage('client-signup');
                    } else {
                        showPage('signin');
                    }
                }, 1500);
                return;
            }
            
            const submitBtn = this.querySelector('button[type="submit"]');
            submitBtn.classList.add('loading');
            submitBtn.disabled = true;
            
                       try {
                const formData = new FormData(this);

             // Validate deadline is in the future
                const deadline = formData.get('deadline');
                const deadlineDate = new Date(deadline + 'T12:00:00'); // Force noon time to avoid timezone issues
                const today = new Date();
                today.setHours(0, 0, 0, 0); // Reset time to start of day
                
                if (deadlineDate < today) {
                    throw new Error('Project deadline cannot be in the past. Please select a future date.');
                }
                
                // Parse budget range
                const budgetRange = formData.get('budgetRange');
                let budgetMin = 0, budgetMax = 0;
                
                if (budgetRange) {
                    if (budgetRange === 'under-100') {
                        budgetMin = 0; budgetMax = 100;
                    } else if (budgetRange === '100-300') {
                        budgetMin = 100; budgetMax = 300;
                    } else if (budgetRange === '300-500') {
                        budgetMin = 300; budgetMax = 500;
                    } else if (budgetRange === '500-1000') {
                        budgetMin = 500; budgetMax = 1000;
                    } else if (budgetRange === '1000-2000') {
                        budgetMin = 1000; budgetMax = 2000;
                    } else if (budgetRange === '2000+') {
                        budgetMin = 2000; budgetMax = 10000;
                    }
                }
                
  // Calculate expiration date
const expirationDaysRaw = formData.get('jobExpiration');
const expirationDays = parseInt(expirationDaysRaw);
const expirationDate = new Date();

// Debug expiration values
console.log(' EXPIRATION DEBUG:');
console.log('Raw expiration value:', expirationDaysRaw);
console.log('Parsed expiration days:', expirationDays);
console.log('Is NaN?:', isNaN(expirationDays));

// Validate expiration days
if (isNaN(expirationDays) || expirationDays < 1) {
    throw new Error('Invalid job post expiration selected. Please choose a valid expiration period.');
}

expirationDate.setDate(expirationDate.getDate() + expirationDays);

// Validate the resulting date
if (isNaN(expirationDate.getTime())) {
    throw new Error('Invalid expiration date calculated. Please try again.');
}
// Debug date values
console.log(' DEBUG - Date validation:');
console.log('Raw deadline input:', deadline);
console.log('Parsed deadline date:', deadlineDate);
console.log('Today:', today);
console.log('Deadline valid?', deadlineDate >= today);
console.log('Expiration date:', expirationDate.toISOString());

console.log(' SENDING TO SERVER:');
console.log('Deadline being sent:', deadline + 'T12:00:00');
console.log('Expiration being sent:', expirationDate.toISOString());
console.log('Expiration days:', expirationDays);

const projectResponse = await apiCall('/api/projects', {
    method: 'POST',
    body: JSON.stringify({
        title: formData.get('title'),
        description: formData.get('description'),
        language: formData.get('language'),
        genre: formData.get('genre'),
        voiceGender: formData.get('voiceGender'),
        budgetMin: budgetMin,
        budgetMax: budgetMax,
        estimatedDuration: formData.get('estimatedDuration'),
        deadline: deadline + 'T12:00:00',
        clientEmail: formData.get('clientEmail'),
        expiration_date: expirationDate.toISOString(),
        expirationDays: expirationDays,
        paymentProtection: formData.get('paymentProtection')
    })
});

// If payment protection was selected, set it up immediately
const paymentProtection = formData.get('paymentProtection');
if (paymentProtection && paymentProtection !== '' && projectResponse.projectId) {
    setTimeout(() => {
        const projectTitle = formData.get('title');
        showPaymentSetupModal(projectResponse.projectId, 'Future Talent', projectTitle, budgetMin, budgetMax);
    }, 2000);
}            showNotification(' Project posted successfully! You will receive applications via email.', 'success');
                this.reset();
                
                setTimeout(() => {
                    showNotification(' Qualified voice talent will start applying within hours!', 'success');
                    loadProjectsData(); // Refresh projects list
                }, 2000);
                
          } catch (error) {
                console.error(' Project submission error details:', error);
                console.error(' Error message:', error.message);
                showNotification(` ${error.message}`, 'error');
            } finally {
                submitBtn.classList.remove('loading');
                submitBtn.disabled = false;
            }
        });

        // Contact form submission
        document.getElementById('contact-form').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const submitBtn = this.querySelector('button[type="submit"]');
            const originalText = submitBtn.innerHTML;
            submitBtn.classList.add('loading');
            submitBtn.disabled = true;
            
            try {
                const formData = new FormData(this);
                
                // Extract form data
                const contactData = {
                    name: formData.get('name'),
                    email: formData.get('email'),
                    subject: formData.get('subject'),
                    message: formData.get('message')
                };
                
                // Debug logging
                console.log('Contact form data:', contactData);
                console.log('API Base URL:', API_BASE_URL);
                
                // Validate required fields
                if (!contactData.name || !contactData.email || !contactData.subject || !contactData.message) {
                    throw new Error('Please fill in all required fields');
                }
                
                // Try multiple possible endpoints
                let response;
                let endpoint = '/api/contact';
                
                try {
                    response = await apiCall(endpoint, {
                        method: 'POST',
                        body: JSON.stringify(contactData)
                    });
                } catch (firstError) {
                    console.log('First endpoint failed, trying /contact:', firstError);
                    
                    // Try alternative endpoint
                    try {
                        endpoint = '/contact';
                        response = await apiCall(endpoint, {
                            method: 'POST',
                            body: JSON.stringify(contactData)
                        });
                    } catch (secondError) {
                        console.log('Second endpoint failed, trying direct fetch:', secondError);
                        
                        // Try direct fetch with different headers
                        const directResponse = await fetch(`${API_BASE_URL}/api/contact`, {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                                'Accept': 'application/json'
                            },
                            body: JSON.stringify(contactData)
                        });
                        
                        if (!directResponse.ok) {
                            const errorText = await directResponse.text();
                            console.error('Server response:', directResponse.status, errorText);
                            throw new Error(`Server error (${directResponse.status}): ${errorText || 'Contact form submission failed'}`);
                        }
                        
                        try {
                            response = await directResponse.json();
                        } catch (parseError) {
                            // Server might return plain text success
                            response = { success: true, message: 'Message sent successfully' };
                        }
                    }
                }
                
                console.log('Contact form response:', response);
                
                showNotification(' Message sent successfully! We\'ll get back to you within 24 hours.', 'success');
                this.reset();
                
            } catch (error) {
                console.error('Contact form error:', error);
                
                // More specific error messages
                if (error.message.includes('fetch')) {
                    showNotification(' Network error. Please check your connection and try again.', 'error');
                } else if (error.message.includes('500')) {
                    showNotification(' Server error. Please try again later or email us directly.', 'error');
                } else if (error.message.includes('404')) {
                    showNotification(' Contact endpoint not found. Please email us directly at support@voicecastingpro.com', 'error');
                } else {
                    showNotification(` ${error.message}`, 'error');
                }
            } finally {
                submitBtn.classList.remove('loading');
                submitBtn.disabled = false;
                submitBtn.innerHTML = originalText;
            }
        });

        // Talent signup functions
        function nextStep(step) {
            if (currentStep === 1) {
                const form = document.getElementById('profile-form');
                if (!form.checkValidity()) {
                    form.reportValidity();
                    return;
                }
                
                // Save profile data
                saveProfileData();
            }

            if (currentStep === 2) {
                talentProfileComplete = true;
                showNotification(' Profile created! Now choose your subscription to start applying to projects.', 'success');
            }

            showStep(step);
        }

        function prevStep(step) {
            showStep(step);
        }

        function showStep(step) {
            document.querySelectorAll('.signup-step').forEach(stepEl => {
                stepEl.classList.remove('active');
            });

            document.getElementById(`step${step}`).classList.add('active');

            updateProgress(step);
            updateStepIndicator(step);

            currentStep = step;
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function updateProgress(step) {
            const progressFill = document.getElementById('progress-fill');
            const progressPercent = (step / 3) * 100;
            progressFill.style.width = `${progressPercent}%`;
        }

        function updateStepIndicator(step) {
            for (let i = 1; i <= 3; i++) {
                const dot = document.getElementById(`step${i}-dot`);
                dot.classList.remove('active', 'completed');
                
                if (i < step) {
                    dot.classList.add('completed');
                    dot.innerHTML = '<i class="fas fa-check"></i>';
                } else if (i === step) {
                    dot.classList.add('active');
                    dot.innerHTML = i;
                } else {
                    dot.innerHTML = i;
                }
            }
        }

        function resetSignupProcess() {
            currentStep = 1;
            talentProfileComplete = false;
            talentSubscribed = false;
            showStep(1);
            
            const profileForm = document.getElementById('profile-form');
            const demoForm = document.getElementById('demo-form');
            if (profileForm) profileForm.reset();
            if (demoForm) demoForm.reset();
            
            const paypalContainer = document.getElementById('paypal-button-container');
            if (paypalContainer) paypalContainer.style.display = 'none';
        }

        // Save profile data (for talent signup)
        async function saveProfileData() {
            try {
                const form = document.getElementById('profile-form');
                const formData = new FormData(form);
                
                // First register the user
                const response = await apiCall('/api/auth/register', {
                    method: 'POST',
                    body: JSON.stringify({
                        email: formData.get('email'),
                        password: formData.get('password'),
                        firstName: formData.get('firstName'),
                        lastName: formData.get('lastName'),
                        accountType: 'talent'
                    })
                });
                
                // Store authentication data
                try {
                    localStorage.setItem('token', response.token);
                    localStorage.setItem('user', JSON.stringify(response.user));
                } catch (error) {
                    console.log('localStorage not available - will work when deployed to Render.com');
                }
                
                authToken = response.token;
                currentUser = response.user;
                isUserSignedIn = true;
                
                // Save talent profile
                const rateRange = formData.get('hourlyRateRange');
                let hourlyRateMin = 50, hourlyRateMax = 100;
                
                if (rateRange === '100-200') {
                    hourlyRateMin = 100; hourlyRateMax = 200;
                } else if (rateRange === '200-300') {
                    hourlyRateMin = 200; hourlyRateMax = 300;
                } else if (rateRange === '300-500') {
                    hourlyRateMin = 300; hourlyRateMax = 500;
                } else if (rateRange === '500+') {
                    hourlyRateMin = 500; hourlyRateMax = 1000;
                }
                
                await apiCall('/api/talent/profile', {
                    method: 'POST',
                    body: JSON.stringify({
                        bio: formData.get('bio'),
                        languages: formData.get('languages'),
                        specialties: formData.get('specialties'),
                        hourlyRateMin: hourlyRateMin,
                        hourlyRateMax: hourlyRateMax,
                        experienceYears: parseInt(formData.get('experienceYears')) || 0,
                        equipmentDescription: formData.get('equipmentDescription') || ''
                    })
                });
                
                talentProfileComplete = true;
                
            } catch (error) {
                showNotification(` ${error.message}`, 'error');
                throw error;
            }
        }

        // Plan selection
        function selectPlan(planType, price) {
            selectedPlan = planType;
            planPrice = price;
            
            showPayPalForm(planType, price);
        }

// PayPal integration
function showPayPalForm(planType, price) {
    const paypalContainer = document.getElementById('paypal-button-container');
    paypalContainer.style.display = 'block';
    paypalContainer.innerHTML = '<div style="display: flex; align-items: center; justify-content: center; gap: 0.5rem; color: var(--text-secondary); font-style: italic;"><i class="fas fa-spinner fa-spin"></i> Loading PayPal...</div>';

    // Check if PayPal SDK is loaded
    if (typeof paypal === 'undefined') {
        console.error('PayPal SDK not loaded');
        setTimeout(() => {
            paypalContainer.innerHTML = `
                <div style="text-align: center; padding: 2rem; border: 2px dashed var(--warning-color); border-radius: 15px;">
                    <h4 style="color: var(--warning-color); margin-bottom: 1rem;"> PayPal SDK Error</h4>
                    <p style="color: var(--text-secondary); margin-bottom: 1.5rem;">
                        PayPal SDK failed to load. Please refresh the page and try again.
                    </p>
                    <div style="display: flex; gap: 1rem; justify-content: center;">
                        <button class="btn btn-secondary" onclick="location.reload()">
                            <i class="fas fa-refresh"></i>
                            Refresh Page
                        </button>
                       <div style="display: flex; gap: 1rem; justify-content: center;">
                            <button class="btn btn-secondary" onclick="location.reload()">
                                <i class="fas fa-refresh"></i>
                                Refresh Page
                            </button>
                            <button class="btn btn-primary" onclick="showPage('contact-us')">
                                <i class="fas fa-envelope"></i>
                                Contact Support
                            </button>
                        </div>
                    </div>
                </div>
            `;
        }, 1000);
        return;
    }

    // Initialize PayPal buttons
    setTimeout(() => {
        console.log('Initializing PayPal buttons for:', planType, price);
        
        paypalContainer.innerHTML = '<div id="paypal-buttons-wrapper"></div>';
        
        try {
              paypal.Buttons({
                style: {
                    layout: 'vertical',
                    color: 'blue',
                    shape: 'rect',
                    label: 'subscribe',
                    height: 50,
                    tagline: false
                },
                
                funding: {
                    allowed: [paypal.FUNDING.PAYPAL],
                    disallowed: [
                        paypal.FUNDING.CREDIT, 
                        paypal.FUNDING.CARD, 
                        paypal.FUNDING.VENMO, 
                        paypal.FUNDING.PAYLATER,
                        paypal.FUNDING.BANCONTACT,
                        paypal.FUNDING.BLIK,
                        paypal.FUNDING.EPS,
                        paypal.FUNDING.GIROPAY,
                        paypal.FUNDING.IDEAL,
                        paypal.FUNDING.MERCADOPAGO,
                        paypal.FUNDING.MYBANK,
                        paypal.FUNDING.P24,
                        paypal.FUNDING.SEPA,
                        paypal.FUNDING.SOFORT
                    ]
                },

                createSubscription: function(data, actions) {
                    console.log('Creating PayPal subscription for:', planType);
                    
                    // Create subscription with PayPal
                   return actions.subscription.create({
    'plan_id': planType === 'monthly' ? 'P-9S326696RR694991PNBKG3DA' : 'P-1V7209565P631870VNBKG36Q',
    'custom_id': currentUser ? String(currentUser.id) : 'demo-user',
    'application_context': {
        'brand_name': 'VoicecastingPro',
        'locale': 'en-US',
        'shipping_preference': 'NO_SHIPPING',
        'user_action': 'SUBSCRIBE_NOW'
    }
});
                },
                
                onApprove: function(data, actions) {
                    console.log('PayPal subscription approved:', data);
                    
                    // Process the subscription approval
                    return fetch(`${API_BASE_URL}/api/subscriptions/create`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': authToken ? `Bearer ${authToken}` : ''
                        },
                        body: JSON.stringify({
                            subscriptionID: data.subscriptionID,
                            planType: planType,
                            orderID: data.orderID
                        })
                    }).then(function(response) {
                        if (!response.ok) {
                            throw new Error('Subscription processing failed');
                        }
                        return response.json();
                   }).then(function(details) {
    console.log('Subscription processed successfully:', details);
    
    // Set subscription status and persist it
    talentSubscribed = true;
    talentProfileComplete = true;
    
    try {
        localStorage.setItem('talentSubscribed', 'true');
        localStorage.setItem('talentProfileComplete', 'true');
    } catch (error) {
        console.log('localStorage not available');
    }
    
    // Update UI immediately
    updateUIForSignedInUser();
    
    const planName = planType === 'monthly' ? 'Monthly' : 'Annual';
    showNotification(` ${planName} subscription activated! Welcome to VoicecastingPro!`, 'success');
    
    setTimeout(() => {
        showNotification(' Setup complete! You can now browse and apply to projects.', 'success');
        
        setTimeout(() => {
            showPage('projects');
            // Force refresh of projects page access
            updateProjectsPageAccess();
        }, 2000);
    }, 2000);
                        
                    }).catch(function(error) {
                        console.error('Subscription processing error:', error);
                        showNotification(' Subscription processing failed. Please contact support.', 'error');
                    });
                },
                
                onError: function(err) {
                    console.error('PayPal error:', err);
                    showNotification(' PayPal payment failed. Please try again.', 'error');
                },
                
                onCancel: function(data) {
                    console.log('PayPal payment cancelled:', data);
                    showNotification(' Payment cancelled. Your subscription was not activated.', 'error');
                }
                
          }).render('#paypal-buttons-wrapper').catch(function(error) {
    console.error('PayPal render error:', error);
    
    paypalContainer.innerHTML = `
        <div style="text-align: center; padding: 2rem; border: 2px dashed var(--warning-color); border-radius: 15px;">
            <h4 style="color: var(--warning-color); margin-bottom: 1rem;"> Payment System Error</h4>
            <p style="color: var(--text-secondary); margin-bottom: 1.5rem;">
                PayPal payment system is temporarily unavailable. Please try again in a few minutes.
            </p>
            <div style="display: flex; gap: 1rem; justify-content: center;">
                <button class="btn btn-secondary" onclick="location.reload()">
                    <i class="fas fa-refresh"></i>
                    Refresh Page
                </button>
                <button class="btn btn-primary" onclick="showPage('contact-us')">
                    <i class="fas fa-envelope"></i>
                    Contact Support
                </button>
            </div>
        </div>
    `;
});
        } catch (error) {
            console.error('PayPal initialization error:', error);
            
            // Fallback UI
            paypalContainer.innerHTML = `
                <div style="text-align: center; padding: 2rem; border: 2px dashed var(--warning-color); border-radius: 15px;">
                    <h4 style="color: var(--warning-color); margin-bottom: 1rem;"> PayPal Error</h4>
                    <p style="color: var(--text-secondary); margin-bottom: 1rem;">
                        ${planType === 'monthly' ? 'Monthly' : 'Annual'} Subscription - $${price}${planType === 'annual' ? ' (billed annually)' : '/month'}
                    </p>
                    <p style="font-size: 0.9rem; color: var(--text-secondary); margin-bottom: 1.5rem;">
                        PayPal integration error. Please try demo mode or contact support.
                    </p>
                    <div style="display: flex; gap: 1rem; justify-content: center; margin-top: 1rem;">
                            <button class="btn btn-secondary" onclick="location.reload()">
                                <i class="fas fa-refresh"></i>
                                Refresh Page
                            </button>
                            <button class="btn btn-primary" onclick="showPage('contact-us')">
                                <i class="fas fa-envelope"></i>
                                Contact Support
                            </button>
                        </div>
                    </div>
                </div>
            `;
        }
        
        paypalContainer.scrollIntoView({ behavior: 'smooth', block: 'center' });
    }, 1000);
}

// Handle plan selection from pricing page - for logged in and new users
        function handlePricingPlanSelection(planType, price) {
            // [all the function code I provided above]
        }

        // Show PayPal directly for existing talent
        function showDirectPayPalForExistingTalent(planType, price) {
            // [all the function code I provided above]
        }

        // Show PayPal in the direct modal
        function showPayPalInDirectModal() {
            // [all the function code I provided above]
        }

        // Close direct PayPal modal
        function closeDirectPayPalModal() {
            // [all the function code I provided above]
        }

        // Notification system
        function showNotification(message, type = 'success') {
            // existing notification code...
        }

        // Notification system
    function showNotification(message, type = 'success') {
    // Create custom notification instead of using browser default
    const notification = document.getElementById('notification');
    if (notification) {
        notification.innerHTML = `<strong>VoicecastingPro:</strong> ${message}`;
        notification.className = `notification ${type}`;
        notification.classList.add('show');
        
        setTimeout(() => {
            notification.classList.remove('show');
        }, 4000);
    } else {
        // Fallback to browser alert with custom prefix
        alert(`VoicecastingPro: ${message}`);
    }
}

// File selection handling for messaging
function handleFileSelection(input) {
    const file = input.files[0];
    if (!file) return;
    
    // Validate file for personal information
    const validation = validateFileAttachment(file);
    if (!validation.valid) {
        showNotification(validation.message, 'error');
        input.value = '';
        return;
    }
    
    const fileInfo = document.getElementById('selected-file-info');
    const fileName = document.getElementById('selected-file-name');
    
   // Validate file type - allow all types for everyone
const allowedTypes = ['.txt', '.pdf', '.doc', '.docx', '.mp3', '.wav', '.aiff', '.m4a', '.jpg', '.jpeg', '.png'];
const fileExtension = '.' + file.name.split('.').pop().toLowerCase();

if (!allowedTypes.includes(fileExtension)) {
    showNotification(' Please select: Audio (MP3, WAV, M4A), Script (PDF, DOC, TXT), or Image (JPG, PNG)', 'error');
    input.value = '';
    return;
}

// Validate file size - 20MB for all files
const maxSize = 20 * 1024 * 1024; // 20MB for all files
    if (file.size > maxSize) {
        showNotification(` File too large. Maximum size is ${isClient ? '5MB' : '20MB'}`, 'error');
        input.value = '';
        return;
    }
    
    fileName.textContent = file.name;
    fileInfo.style.display = 'flex';
    fileInfo.style.alignItems = 'center';
    fileInfo.style.gap = '0.5rem';
}

function clearSelectedFile() {
    document.getElementById('message-file-input').value = '';
    document.getElementById('selected-file-info').style.display = 'none';
}


    // Search functionality
        document.getElementById('talent-search')?.addEventListener('input', function(e) {
            // Implement talent search filtering
            console.log('Searching talent:', e.target.value);
        });

        document.getElementById('project-search')?.addEventListener('input', function(e) {
            // Implement project search filtering
            console.log('Searching projects:', e.target.value);
        });

        // Filter functionality
        document.querySelectorAll('.filter-select').forEach(select => {
            select.addEventListener('change', function() {
                // Implement filtering logic
                console.log('Filter changed:', this.value);
            });
        });

        // Close mobile menu when clicking outside
        document.addEventListener('click', function(e) {
            const mobileMenu = document.getElementById('mobile-menu');
            const menuToggle = document.querySelector('.mobile-menu-toggle');
            
            if (mobileMenu.classList.contains('active') && 
                !mobileMenu.contains(e.target) && 
                !menuToggle.contains(e.target)) {
                closeMobileMenu();
            }
        });

        // Close mobile menu on window resize if open
        window.addEventListener('resize', function() {
            if (window.innerWidth > 768) {
                closeMobileMenu();
            }
        });

        // Account Settings Functions
       function initializeAccountSettings() {
    const accountContent = document.getElementById('account-content');
    const loginPrompt = document.getElementById('account-login-prompt');
    
    if (isUserSignedIn && currentUser) {
        accountContent.style.display = 'block';
        loginPrompt.style.display = 'none';
        
        loadAccountInfo();
        
        // Show subscription section only for talent
        if (currentUser.account_type === 'talent') {
            document.getElementById('subscription-section').style.display = 'block';
            loadSubscriptionInfo();
            
            // Show demo management for talent
            document.getElementById('demo-management-section').style.display = 'block';
} else if (currentUser.account_type === 'client') {
    // Show project management for clients
    document.getElementById('client-project-management-section').style.display = 'block';
    // Hide talent-specific sections for clients
    document.getElementById('demo-management-section').style.display = 'none';
} 

// Always hide inappropriate sections
if (currentUser.account_type === 'talent') {
    document.getElementById('client-project-management-section').style.display = 'none';
} else if (currentUser.account_type === 'client') {
    document.getElementById('demo-management-section').style.display = 'none';
    document.getElementById('subscription-section').style.display = 'none';
}
    } else {
        accountContent.style.display = 'none';
        loginPrompt.style.display = 'block';
    }
}
        function loadAccountInfo() {
            const profileInfo = document.getElementById('profile-info');
            
            if (!currentUser) return;
            
            const accountType = currentUser.account_type === 'talent' ? 'Voice Talent' : 'Client';
            
   profileInfo.innerHTML = `
                <div style="display: flex; align-items: center; gap: 1.5rem; margin-bottom: 2rem; padding-bottom: 1.5rem; border-bottom: 1px solid var(--glass-border);">
                    <div style="width: 100px; height: 100px; border-radius: 50%; background: var(--primary-gradient); display: flex; align-items: center; justify-content: center; font-size: 2rem; font-weight: 800; color: white; overflow: hidden;">
                        ${currentUser.profile_photo ? 
                            `<img src="${API_BASE_URL}/uploads/profiles/${currentUser.profile_photo}" style="width: 100%; height: 100%; object-fit: cover;" alt="Profile">` : 
                            `${currentUser.first_name[0]}${currentUser.last_name[0]}`
                        }
                    </div>
                    <div>
                        <h4 style="margin: 0; color: var(--text-primary);">${currentUser.first_name} ${currentUser.last_name}</h4>
                        <p style="margin: 0; color: var(--text-secondary);">${accountType}</p>
                        <button onclick="changeProfilePhoto()" class="btn btn-secondary" style="margin-top: 0.5rem; padding: 0.4rem 1rem; font-size: 0.9rem;">
                            <i class="fas fa-camera"></i>
                            Change Photo
                        </button>
                    </div>
                </div>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1rem;">
                    <div>
                        <label style="color: var(--text-secondary); font-size: 0.9rem;">Name</label>
                        <p style="margin: 0; font-weight: 600;">${currentUser.first_name} ${currentUser.last_name}</p>
                    </div>
                    <div>
                        <label style="color: var(--text-secondary); font-size: 0.9rem;">Email</label>
                        <p style="margin: 0; font-weight: 600;">${currentUser.email}</p>
                    </div>
                    <div>
                        <label style="color: var(--text-secondary); font-size: 0.9rem;">Account Type</label>
                        <p style="margin: 0; font-weight: 600;">${accountType}</p>
                    </div>
                    <div>
                        <label style="color: var(--text-secondary); font-size: 0.9rem;">Member Since</label>
                        <p style="margin: 0; font-weight: 600;">${new Date(currentUser.created_at || Date.now()).toLocaleDateString()}</p>
                    </div>
                </div>
            `;
        }

        async function loadSubscriptionInfo() {
            try {
                const response = await apiCall('/api/subscriptions/status');
                const subscriptionInfo = document.getElementById('subscription-info');
                
                if (response.subscription) {
                    const sub = response.subscription;
                    const isActive = sub.status === 'active';
                    const planName = sub.plan_type === 'monthly' ? 'Monthly' : 'Annual';
                    const amount = sub.plan_type === 'monthly' ? '$35/month' : '$29/month (billed annually)';
                    
                    subscriptionInfo.innerHTML = `
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem;">
                            <div>
                                <label style="color: var(--text-secondary); font-size: 0.9rem;">Status</label>
                                <p style="margin: 0; font-weight: 600; color: ${isActive ? 'var(--success-color)' : 'var(--warning-color)'};">
                                    <i class="fas fa-circle" style="font-size: 0.5rem; margin-right: 0.5rem;"></i>
                                    ${isActive ? 'Active' : 'Inactive'}
                                </p>
                            </div>
                            <div>
                                <label style="color: var(--text-secondary); font-size: 0.9rem;">Plan</label>
                                <p style="margin: 0; font-weight: 600;">${planName} Plan</p>
                            </div>
                            <div>
                                <label style="color: var(--text-secondary); font-size: 0.9rem;">Amount</label>
                                <p style="margin: 0; font-weight: 600;">${amount}</p>
                            </div>
                            <div>
                                <label style="color: var(--text-secondary); font-size: 0.9rem;">Next Billing</label>
                                <p style="margin: 0; font-weight: 600;">${new Date(sub.next_billing_date).toLocaleDateString()}</p>
                            </div>
                        </div>
                    `;
                } else {
                    subscriptionInfo.innerHTML = `
                        <div style="text-align: center; padding: 2rem;">
                            <p style="color: var(--text-secondary); margin-bottom: 1rem;">No active subscription found.</p>
                            <button class="btn btn-primary" onclick="showPage('talent-signup'); showStep(3);">
                                <i class="fas fa-crown"></i> Subscribe Now
                            </button>
                        </div>
                    `;
                }
            } catch (error) {
                console.error('Failed to load subscription info:', error);
                document.getElementById('subscription-info').innerHTML = `
                    <p style="color: var(--warning-color);">Failed to load subscription information.</p>
                `;
            }
        }

        async function cancelSubscription() {
            const confirmed = confirm(`Are you sure you want to cancel your subscription?\n\n` +
                ` You'll lose access to premium features\n` +
                ` You won't be able to apply to new projects\n` +
                ` Your profile will become inactive\n\n` +
                `Your subscription will remain active until the end of your current billing period.`);
            
            if (!confirmed) return;

            try {
                const response = await apiCall('/api/subscriptions/cancel', {
                    method: 'POST'
                });
                
                showNotification(' Subscription cancelled successfully. You can still use premium features until your current billing period ends.', 'success');
                loadSubscriptionInfo();
                talentSubscribed = false;
                
            } catch (error) {
                console.error('Cancel subscription error:', error);
                showNotification(` Failed to cancel subscription: ${error.message}`, 'error');
            }
        }

     function changeSubscriptionPlan() {
            showPlanChangeModal();
        }

        // Plan change modal
        function showPlanChangeModal() {
            const modal = document.createElement('div');
            modal.className = 'plan-change-modal';
            modal.style.cssText = `
                position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
                background: rgba(0, 0, 0, 0.8); z-index: 1002; 
                backdrop-filter: blur(10px); display: flex; 
                align-items: center; justify-content: center; padding: 2rem;
            `;
            
            modal.innerHTML = `
                <div class="glass-card" style="max-width: 900px; width: 100%; margin: 0 1rem; max-height: 80vh; overflow-y: auto;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                        <h3 style="color: var(--accent-color); margin: 0;"> Change Subscription Plan</h3>
                        <button onclick="closePlanChangeModal()" 
                                style="background: none; border: none; color: var(--text-secondary); font-size: 1.5rem; cursor: pointer;">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    
                    <div style="background: rgba(102, 126, 234, 0.1); border-radius: 10px; padding: 1rem; margin-bottom: 2rem;">
                        <h4 style="color: var(--accent-color); margin: 0 0 0.5rem 0;"> Current Plan</h4>
                        <div id="current-plan-info" style="color: var(--text-secondary);">
                            <i class="fas fa-spinner fa-spin"></i> Loading current plan...
                        </div>
                    </div>

                    <h4 style="color: var(--accent-color); margin-bottom: 1.5rem;">Choose New Plan</h4>
                    
                    <!-- Pricing Cards for Plan Change -->
                    <div class="pricing-cards" style="margin-bottom: 2rem;">
                        <!-- Monthly Plan -->
                        <div class="pricing-card" id="change-monthly-card">
                            <div class="pricing-badge">Monthly Plan</div>
                            <div class="pricing-amount">$35</div>
                            <div class="pricing-period">per month</div>
                            <ul class="pricing-features">
                                <li><span class="check"></span> Unlimited project applications</li>
                                <li><span class="check"></span> Featured profile placement</li>
                                <li><span class="check"></span> Direct client contact</li>
                                <li><span class="check"></span> Audio demo hosting</li>
                                <li><span class="check"></span> Analytics and insights</li>
                                <li><span class="check"></span> Priority customer support</li>
                            </ul>
                            <button class="btn btn-primary" style="width: 100%; margin-top: 1rem;" onclick="changeToPlan('monthly', 35)">
                                <i class="fas fa-exchange-alt"></i>
                                Switch to Monthly
                            </button>
                        </div>

                        <!-- Annual Plan -->
                        <div class="pricing-card recommended" id="change-annual-card">
                            <div class="pricing-badge">Best Value</div>
                            <div class="discount-badge">Save $84/year</div>
                            <div class="pricing-amount">$29</div>
                            <div class="pricing-period">per month<br><small style="color: var(--text-secondary);">billed annually ($348)</small></div>
                            <ul class="pricing-features">
                                <li><span class="check"></span> Unlimited project applications</li>
                                <li><span class="check"></span> Featured profile placement</li>
                                <li><span class="check"></span> Direct client contact</li>
                                <li><span class="check"></span> Audio demo hosting</li>
                                <li><span class="check"></span> Analytics and insights</li>
                                <li><span class="check"></span> Priority customer support</li>
                            </ul>
                            <button class="btn btn-primary" style="width: 100%; margin-top: 1rem;" onclick="changeToPlan('annual', 348)">
                                <i class="fas fa-crown"></i>
                                Switch to Annual
                            </button>
                        </div>
                    </div>

                    <!-- PayPal Container for Plan Changes -->
                    <div id="plan-change-paypal-container" style="display: none; margin-top: 2rem;"></div>
                    
                    <div style="text-align: center; margin-top: 2rem; padding: 1rem; background: rgba(0, 212, 255, 0.1); border-radius: 10px;">
                        <p style="color: var(--text-secondary); margin: 0; font-size: 0.9rem;">
                            <i class="fas fa-info-circle"></i> 
                            Plan changes take effect immediately. Any prorated amounts will be calculated automatically.
                        </p>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            document.body.style.overflow = 'hidden';
            
            // Load current plan info
            loadCurrentPlanInfo();
            
            // Close on background click
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    closePlanChangeModal();
                }
            });
        }

function closePlanChangeModal() {
    // Method 1: Try to find by class name (cleaner)
    const modal = document.querySelector('.plan-change-modal');
    if (modal && modal.parentNode) {
        modal.parentNode.removeChild(modal);
        document.body.style.overflow = '';
        return;
    }
    
    // Method 2: Fallback - find by content and styling (more robust)
    const modals = document.querySelectorAll('div[style*="position: fixed"][style*="z-index: 1002"]');
    modals.forEach(modal => {
        if (modal.innerHTML.includes('Change Subscription Plan')) {
            modal.remove();
        }
    });
    document.body.style.overflow = '';
}

        async function loadCurrentPlanInfo() {
            try {
                const response = await apiCall('/api/subscriptions/status');
                const currentPlanInfo = document.getElementById('current-plan-info');
                
                if (response.subscription) {
                    const sub = response.subscription;
                    const planName = sub.plan_type === 'monthly' ? 'Monthly' : 'Annual';
                    const amount = sub.plan_type === 'monthly' ? '$35/month' : '$29/month (billed annually)';
                    const nextBilling = new Date(sub.next_billing_date).toLocaleDateString();
                    
                    currentPlanInfo.innerHTML = `
                        <div style="display: flex; align-items: center; gap: 1rem;">
                            <div style="width: 50px; height: 50px; background: var(--success-color); border-radius: 50%; display: flex; align-items: center; justify-content: center;">
                                <i class="fas fa-crown" style="color: white; font-size: 1.2rem;"></i>
                            </div>
                            <div>
                                <p style="margin: 0; font-weight: 600; color: var(--text-primary);">${planName} Plan - ${amount}</p>
                                <p style="margin: 0; font-size: 0.9rem;">Next billing: ${nextBilling}</p>
                                <span style="color: var(--success-color); font-size: 0.9rem;">
                                    <i class="fas fa-circle" style="font-size: 0.5rem; margin-right: 0.3rem;"></i>
                                    Active
                                </span>
                            </div>
                        </div>
                    `;
                    
                    // Highlight current plan and disable its button
                    if (sub.plan_type === 'monthly') {
                        const monthlyCard = document.getElementById('change-monthly-card');
                        if (monthlyCard) {
                            monthlyCard.style.border = '2px solid var(--success-color)';
                            monthlyCard.querySelector('button').innerHTML = `
                                <i class="fas fa-check"></i>
                                Current Plan
                            `;
                            monthlyCard.querySelector('button').disabled = true;
                            monthlyCard.querySelector('button').style.background = 'var(--success-color)';
                        }
                    } else {
                        const annualCard = document.getElementById('change-annual-card');
                        if (annualCard) {
                            annualCard.style.border = '2px solid var(--success-color)';
                            annualCard.querySelector('button').innerHTML = `
                                <i class="fas fa-check"></i>
                                Current Plan
                            `;
                            annualCard.querySelector('button').disabled = true;
                            annualCard.querySelector('button').style.background = 'var(--success-color)';
                        }
                    }
                } else {
                    currentPlanInfo.innerHTML = `
                        <div style="color: var(--warning-color);">
                            <i class="fas fa-exclamation-triangle"></i>
                            No active subscription found. Please subscribe first.
                        </div>
                    `;
                }
            } catch (error) {
                console.error('Failed to load current plan:', error);
                document.getElementById('current-plan-info').innerHTML = `
                    <div style="color: var(--warning-color);">
                        <i class="fas fa-exclamation-triangle"></i>
                        Failed to load current plan information.
                    </div>
                `;
            }
        }

        function changeToPlan(newPlanType, price) {
            const confirmed = confirm(`Are you sure you want to change to the ${newPlanType} plan?\n\n` +
                `This will:\n` +
                ` Change your billing to ${newPlanType === 'monthly' ? '$35/month' : '$29/month (billed annually)'}\n` +
                ` Apply any prorated charges immediately\n` +
                ` Update your next billing date\n\n` +
                `Click OK to proceed with PayPal.`);
            
            if (!confirmed) return;

            // Show PayPal for plan change
            showPlanChangePayPal(newPlanType, price);
        }

        function showPlanChangePayPal(planType, price) {
            const paypalContainer = document.getElementById('plan-change-paypal-container');
            paypalContainer.style.display = 'block';
            paypalContainer.innerHTML = '<div style="text-align: center; color: var(--text-secondary);"><i class="fas fa-spinner fa-spin"></i> Loading PayPal for plan change...</div>';

            // Check if PayPal SDK is loaded
            if (typeof paypal === 'undefined') {
                setTimeout(() => {
                    paypalContainer.innerHTML = `
                        <div style="text-align: center; padding: 2rem; border: 2px dashed var(--warning-color); border-radius: 15px;">
                            <h4 style="color: var(--warning-color); margin-bottom: 1rem;"> PayPal SDK Error</h4>
                            <p style="color: var(--text-secondary); margin-bottom: 1.5rem;">
                                PayPal SDK failed to load. Please refresh and try again.
                            </p>
                            <button class="btn btn-secondary" onclick="location.reload()">
                                <i class="fas fa-refresh"></i>
                                Refresh Page
                            </button>
                        </div>
                    `;
                }, 1000);
                return;
            }

            // Initialize PayPal buttons for plan change
            setTimeout(() => {
                paypalContainer.innerHTML = '<div id="plan-change-paypal-buttons"></div>';
                
                try {
                   paypal.Buttons({
                        style: {
                            layout: 'vertical',
                            color: 'blue',
                            shape: 'rect',
                            label: 'subscribe',
                            height: 50,
                            tagline: false
                        },
                        
                        funding: {
                            allowed: [paypal.FUNDING.PAYPAL],
                            disallowed: [
                                paypal.FUNDING.CREDIT, 
                                paypal.FUNDING.CARD, 
                                paypal.FUNDING.VENMO, 
                                paypal.FUNDING.PAYLATER,
                                paypal.FUNDING.BANCONTACT,
                                paypal.FUNDING.BLIK,
                                paypal.FUNDING.EPS,
                                paypal.FUNDING.GIROPAY,
                                paypal.FUNDING.IDEAL,
                                paypal.FUNDING.MERCADOPAGO,
                                paypal.FUNDING.MYBANK,
                                paypal.FUNDING.P24,
                                paypal.FUNDING.SEPA,
                                paypal.FUNDING.SOFORT
                            ]
                        },
                        
                        createSubscription: function(data, actions) {
                            return actions.subscription.create({
                                'plan_id': planType === 'monthly' ? 'P-9S326696RR694991PNBKG3DA' : 'P-1V7209565P631870VNBKG36Q', // Replace with your actual plan IDs
                                'custom_id': currentUser ? currentUser.id : 'demo-user',
                                'application_context': {
                                    'brand_name': 'VoicecastingPro - Plan Change',
                                    'locale': 'en-US',
                                    'shipping_preference': 'NO_SHIPPING',
                                    'user_action': 'SUBSCRIBE_NOW',
                                    'return_url': `${window.location.origin}/plan-change-success`,
                                    'cancel_url': `${window.location.origin}/plan-change-cancelled`
                                }
                            });
                        },
                        
                        onApprove: function(data, actions) {
                            return fetch(`${API_BASE_URL}/api/subscriptions/change-plan`, {
                                method: 'POST',
                                headers: {
                                    'Content-Type': 'application/json',
                                    'Authorization': authToken ? `Bearer ${authToken}` : ''
                                },
                                body: JSON.stringify({
                                    newSubscriptionID: data.subscriptionID,
                                    newPlanType: planType,
                                    orderID: data.orderID
                                })
                            }).then(function(response) {
                                if (!response.ok) {
                                    throw new Error('Plan change processing failed');
                                }
                                return response.json();
                            }).then(function(details) {
                                const planName = planType === 'monthly' ? 'Monthly' : 'Annual';
                                showNotification(` Successfully changed to ${planName} plan!`, 'success');
                                
                                closePlanChangeModal();
                                loadSubscriptionInfo(); // Refresh subscription info
                                
                                setTimeout(() => {
                                    showNotification(' Your billing will be updated according to the new plan.', 'success');
                                }, 2000);
                                
                            }).catch(function(error) {
                                console.error('Plan change processing error:', error);
                                showNotification(' Plan change failed. Please contact support.', 'error');
                            });
                        },
                        
                        onError: function(err) {
                            console.error('PayPal error:', err);
                            showNotification(' PayPal error occurred. Please try again.', 'error');
                        },
                        
                        onCancel: function(data) {
                            showNotification(' Plan change cancelled.', 'error');
                            paypalContainer.style.display = 'none';
                        }
                        
                    }).render('#plan-change-paypal-buttons').catch(function(error) {
                        console.error('PayPal render error:', error);
                        paypalContainer.innerHTML = `
                            <div style="text-align: center; padding: 2rem; border: 2px dashed var(--warning-color); border-radius: 15px;">
                                <h4 style="color: var(--warning-color); margin-bottom: 1rem;"> PayPal Error</h4>
                                <p style="color: var(--text-secondary); margin-bottom: 1.5rem;">
                                    PayPal buttons failed to load. Please contact support for plan changes.
                                </p>
                                <button class="btn btn-secondary" onclick="closePlanChangeModal()">
                                    <i class="fas fa-times"></i>
                                    Close
                                </button>
                            </div>
                        `;
                    });
                    
                } catch (error) {
                    console.error('PayPal initialization error:', error);
                    paypalContainer.innerHTML = `
                        <div style="text-align: center; padding: 2rem; border: 2px dashed var(--warning-color); border-radius: 15px;">
                            <h4 style="color: var(--warning-color); margin-bottom: 1rem;"> PayPal Error</h4>
                            <p style="color: var(--text-secondary); margin-bottom: 1.5rem;">
                                Unable to initialize PayPal for plan changes. Please contact support.
                            </p>
                        </div>
                    `;
                }
                
                paypalContainer.scrollIntoView({ behavior: 'smooth', block: 'center' });
            }, 1000);
        }

   function editProfile() {
    showProfileEditModal();
}

// Profile edit modal
function showProfileEditModal() {
    const modal = document.createElement('div');
    modal.className = 'profile-edit-modal';
    modal.style.cssText = `
        position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
        background: rgba(0, 0, 0, 0.8); z-index: 1002; 
        backdrop-filter: blur(10px); display: flex; 
        align-items: center; justify-content: center; padding: 2rem;
    `;
    
    modal.innerHTML = `
        <div class="glass-card" style="max-width: 700px; width: 100%; margin: 0 1rem; max-height: 80vh; overflow-y: auto;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                <h3 style="color: var(--accent-color); margin: 0;"> Edit Profile</h3>
                <button class="modal-close-btn" type="button"
                        style="background: none; border: none; color: var(--text-secondary); font-size: 1.5rem; cursor: pointer;">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
        <form id="edit-profile-form">
    <div class="form-grid">
        <div class="form-group">
            <label class="form-label">First Name *</label>
            <input type="text" name="firstName" class="form-input" value="${currentUser.first_name}" required>
        </div>
        <div class="form-group">
            <label class="form-label">Last Name *</label>
            <input type="text" name="lastName" class="form-input" value="${currentUser.last_name}" required>
        </div>
    </div>

                <div class="form-group">
                    <label class="form-label">Profile Photo</label>
                    <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 1rem;">
                        <div id="current-profile-photo" style="width: 80px; height: 80px; border-radius: 50%; background: var(--primary-gradient); display: flex; align-items: center; justify-content: center; font-size: 1.5rem; font-weight: 800; color: white; overflow: hidden;">
                            ${currentUser.profile_photo ? 
                                `<img src="${API_BASE_URL}/uploads/profiles/${currentUser.profile_photo}" style="width: 100%; height: 100%; object-fit: cover;" alt="Profile">` : 
                                `${currentUser.first_name[0]}${currentUser.last_name[0]}`
                            }
                        </div>
                        <div style="flex: 1;">
                            <input type="file" name="profilePhoto" class="form-input" accept=".jpg,.jpeg,.png,.gif" style="padding: 0.8rem;">
                            <small style="color: var(--text-secondary); font-size: 0.9rem; display: block; margin-top: 0.5rem;">
                                Upload new photo (JPG, PNG, GIF - max 5MB)
                            </small>
                        </div>
                    </div>
                </div>

                ${currentUser.account_type === 'talent' ? `
                    <div class="form-group">
                        <label class="form-label">Professional Bio</label>
                        <textarea name="bio" class="form-textarea" rows="4" id="edit-bio" placeholder="Tell clients about your experience..."></textarea>
                    </div>

                    <div class="form-grid">
                        <div class="form-group">
                            <label class="form-label">Languages</label>
                            <input type="text" name="languages" class="form-input" id="edit-languages" placeholder="e.g., English (Native), Spanish (Fluent)">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Specialties</label>
                            <input type="text" name="specialties" class="form-input" id="edit-specialties" placeholder="e.g., Commercial, Narration">
                        </div>
                    </div>

                    <div class="form-grid">
                        <div class="form-group">
                            <label class="form-label">Min Hourly Rate ($)</label>
                            <input type="number" name="hourlyRateMin" class="form-input" id="edit-rate-min" min="1">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Max Hourly Rate ($)</label>
                            <input type="number" name="hourlyRateMax" class="form-input" id="edit-rate-max" min="1">
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Years of Experience</label>
                        <select name="experienceYears" class="form-select" id="edit-experience">
                            <option value="0">Less than 1 year</option>
                            <option value="1">1-3 years</option>
                            <option value="3">3-5 years</option>
                            <option value="5">5-10 years</option>
                            <option value="10">10+ years</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Equipment Description</label>
                        <textarea name="equipmentDescription" class="form-textarea" rows="3" id="edit-equipment" placeholder="Describe your microphone, audio interface, recording setup..."></textarea>
                    </div>
                ` : ''}

<div style="display: flex; gap: 1rem; margin-top: 2rem;">
    <button type="button" class="btn btn-secondary cancel-btn" style="flex: 1;" onclick="closeEditProjectModal(document.querySelector('.edit-project-modal'))">
        <i class="fas fa-times"></i>
        Cancel & Close
    </button>
    <button type="submit" class="btn btn-primary" style="flex: 2;">
        <i class="fas fa-save"></i>
        Save Changes
    </button>
</div>
            </form>
        </div>
    `;
    
    document.body.appendChild(modal);
    document.body.style.overflow = 'hidden';
    
    // Add proper event listeners
    const closeBtn = modal.querySelector('.modal-close-btn');
    const cancelBtn = modal.querySelector('.cancel-btn');
    
    closeBtn.addEventListener('click', function() {
        closeProfileEditModal(modal);
    });
    
    cancelBtn.addEventListener('click', function() {
        closeProfileEditModal(modal);
    });
    
    // Close on background click
    modal.addEventListener('click', function(e) {
        if (e.target === modal) {
            closeProfileEditModal(modal);
        }
    });
    
    if (currentUser.account_type === 'talent') {
        loadCurrentProfileData();
    }
    
    modal.querySelector('#edit-profile-form').addEventListener('submit', handleProfileUpdate);
}

// Close profile edit modal
function closeProfileEditModal(modal) {
    if (modal && modal.parentNode) {
        modal.parentNode.removeChild(modal);
    }
    document.body.style.overflow = '';
}

// Load current profile data
async function loadCurrentProfileData() {
    try {
        const response = await apiCall('/api/talent/profile/me');
        const profile = response.profile;
        
        if (profile) {
            document.getElementById('edit-bio').value = profile.bio || '';
            document.getElementById('edit-languages').value = profile.languages || '';
            document.getElementById('edit-specialties').value = profile.specialties || '';
            document.getElementById('edit-rate-min').value = profile.hourly_rate_min || '';
            document.getElementById('edit-rate-max').value = profile.hourly_rate_max || '';
            document.getElementById('edit-experience').value = profile.experience_years || '0';
            document.getElementById('edit-equipment').value = profile.equipment_description || '';
        }
    } catch (error) {
        console.error('Failed to load profile data:', error);
    }
}

// Handle profile update
async function handleProfileUpdate(e) {
    e.preventDefault();
    
    const form = e.target;
    const formData = new FormData(form);
    const submitBtn = form.querySelector('button[type="submit"]');
    
    submitBtn.classList.add('loading');
    submitBtn.disabled = true;
    
    try {
        await apiCall('/api/auth/update-profile', {
            method: 'PUT',
            body: JSON.stringify({
                firstName: formData.get('firstName'),
                lastName: formData.get('lastName')
            })
        });
        
        if (currentUser.account_type === 'talent') {
            await apiCall('/api/talent/profile', {
                method: 'POST',
                body: JSON.stringify({
                    bio: formData.get('bio'),
                    languages: formData.get('languages'),
                    specialties: formData.get('specialties'),
                    hourlyRateMin: parseInt(formData.get('hourlyRateMin')) || 50,
                    hourlyRateMax: parseInt(formData.get('hourlyRateMax')) || 100,
                    experienceYears: parseInt(formData.get('experienceYears')) || 0,
                    equipmentDescription: formData.get('equipmentDescription')
                })
            });
        }
        
        currentUser.first_name = formData.get('firstName');
        currentUser.last_name = formData.get('lastName');
        
        try {
            localStorage.setItem('user', JSON.stringify(currentUser));
        } catch (error) {
            console.log('localStorage not available');
        }
        
       updateUIForSignedInUser();
        
     showNotification(' Profile updated successfully!', 'success');
loadAccountInfo();

// Close modal properly with delay to show success message
setTimeout(() => {
    const modal = form.closest('.profile-edit-modal');
    closeProfileEditModal(modal);
}, 1500);
        
    } catch (error) {
        console.error('Profile update error:', error);
        showNotification(` Failed to update profile: ${error.message}`, 'error');
    } finally {
        submitBtn.classList.remove('loading');
        submitBtn.disabled = false;
    }
}

       async function deleteAccount() {
    const confirmText = prompt(`Type "DELETE" to confirm account deletion:\n\n` +
        ` This will permanently:\n` +
        ` Delete your profile and all data\n` +
        ` Cancel any active subscriptions\n` +
        ` Remove you from all projects\n` +
        ` Delete all your messages\n` +
        ` This action CANNOT be undone\n\n` +
        `Type "DELETE" to confirm:`);
    
    if (confirmText !== 'DELETE') {
        if (confirmText !== null) {
            showNotification(' Account deletion cancelled - confirmation text did not match.', 'error');
        }
        return;
    }

    const finalConfirm = confirm(`Last chance - are you absolutely sure?\n\nThis will permanently delete your account and cannot be undone.`);
    
    if (!finalConfirm) return;

    try {
        showNotification(' Processing account deletion...', 'success');
        
        // Step 1: Cancel active subscriptions first (for talent accounts)
        if (currentUser.account_type === 'talent' && talentSubscribed) {
            try {
                console.log(' Cancelling subscription before account deletion...');
                await apiCall('/api/subscriptions/cancel', {
                    method: 'POST'
                });
                console.log(' Subscription cancelled');
            } catch (subError) {
                console.warn(' Subscription cancellation failed:', subError);
                // Continue with deletion even if subscription cancellation fails
            }
        }
        
        // Step 2: Delete the account and all related data
        console.log(' Deleting account and all related data...');
        await apiCall('/api/account/delete', {
            method: 'DELETE'
        });
        
        // Step 3: Clear all local data and reset application state
        try {
            localStorage.removeItem('token');
            localStorage.removeItem('user');
            localStorage.removeItem('talentProfileComplete');
            localStorage.removeItem('talentSubscribed');
            localStorage.clear(); // Clear all localStorage
        } catch (error) {
            console.log('localStorage not available - this is normal in sandboxed environments');
        }
        
        // Reset all global variables
        authToken = null;
        currentUser = null;
        isUserSignedIn = false;
        talentProfileComplete = false;
        talentSubscribed = false;
        currentConversation = null;
        selectedPlan = null;
        planPrice = 0;
        currentStep = 1;
               // Update UI to signed-out state
        const navAuth = document.getElementById('nav-auth');
        if (navAuth) {
            navAuth.innerHTML = `
                <div class="nav-signin" onclick="showPage('signin')">
                    <i class="fas fa-sign-in-alt"></i>
                    <span>Sign In</span>
                </div>
                <div class="nav-cta" onclick="showPage('client-signup')" style="margin-right: 0.5rem;">
                    <div class="nav-cta-icon white"></div>
                    <span>Join as Client</span>
                </div>
                <div class="nav-cta" onclick="showPage('talent-signup')">
                    <div class="nav-cta-icon"></div>
                    <span>Join as Talent</span>
                </div>
                <button class="mobile-menu-toggle" onclick="toggleMobileMenu()">
                    <i class="fas fa-bars" id="menu-icon"></i>
                </button>
            `;
        }
        
        // Update mobile menu
        updateMobileMenuContent();
        
        // Hide post project nav
        const postProjectNav = document.getElementById('post-project-nav');
        if (postProjectNav) {
            postProjectNav.style.display = 'none';
        }
        
        showNotification(' Account deleted successfully. We\'re sorry to see you go!', 'success');
        
        setTimeout(() => {
            showPage('home');
            showNotification(' You have been signed out. Thank you for using VoicecastingPro.', 'success');
        }, 2000);
        
    } catch (error) {
        console.error(' Delete account error:', error);
        
        if (error.message.includes('404') || error.message.includes('not found')) {
            showNotification(' Account deletion endpoint not available. Please contact support.', 'error');
        } else if (error.message.includes('401') || error.message.includes('unauthorized')) {
            showNotification(' Authentication failed. Please sign in again and try deletion.', 'error');
            setTimeout(() => showPage('signin'), 2000);
        } else {
            showNotification(` Failed to delete account: ${error.message}`, 'error');
        }
    }
}
      // Show demo management modal
function showDemoManagement() {
    const modal = document.createElement('div');
    modal.className = 'demo-management-modal';
    modal.style.cssText = `
        position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
        background: rgba(0, 0, 0, 0.8); z-index: 1002; 
        backdrop-filter: blur(10px); display: flex; 
        align-items: center; justify-content: center; padding: 2rem;
    `;
    
    modal.innerHTML = `
        <div class="glass-card" style="max-width: 800px; width: 100%; margin: 0 1rem; max-height: 80vh; overflow-y: auto;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                <h3 style="color: var(--accent-color); margin: 0;"> Manage Audio Demos</h3>
              <button class="modal-close-btn" type="button"
        style="background: rgba(255, 107, 107, 0.8); border: none; color: white; font-size: 1.2rem; cursor: pointer; width: 35px; height: 35px; border-radius: 50%; display: flex; align-items: center; justify-content: center; transition: all 0.2s ease;"
        title="Close">
    <i class="fas fa-times"></i>
</button>
            </div>
            
            <div class="glass-card" style="margin-bottom: 2rem; background: rgba(102, 126, 234, 0.1);">
                <h4 style="color: var(--accent-color); margin-bottom: 1rem;"> Upload New Demo</h4>
                <form id="demo-upload-form">
                    <div class="form-group">
                        <label class="form-label">Demo Title *</label>
                        <input type="text" name="title" class="form-input" placeholder="e.g., Commercial Demo Reel" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Description</label>
                        <textarea name="description" class="form-textarea" rows="2" placeholder="Describe this demo - style, genre, character..."></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Audio File *</label>
                        <input type="file" name="audioFile" class="form-input" accept=".mp3,.wav,.aiff,.m4a" required>
                        <small style="color: var(--text-secondary); font-size: 0.9rem; display: block; margin-top: 0.5rem;">
                            Supported formats: MP3, WAV, AIFF, M4A (max 10MB)
                        </small>
                    </div>
                    
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-upload"></i>
                        Upload Demo
                    </button>
                </form>
            </div>
            
            <div id="current-demos">
                <h4 style="color: var(--accent-color); margin-bottom: 1rem;"> Your Current Demos</h4>
                <div id="demos-list-manage">
                    <div style="text-align: center; color: var(--text-secondary);">
                        <i class="fas fa-spinner fa-spin"></i> Loading demos...
                    </div>
                </div>
            </div>
        </div>
    `;
    
    document.body.appendChild(modal);
    document.body.style.overflow = 'hidden';
    
    // Add proper event listeners
    const closeBtn = modal.querySelector('.modal-close-btn');
    closeBtn.addEventListener('click', function() {
        closeDemoManagementModal(modal);
    });
    
    // Close on background click
    modal.addEventListener('click', function(e) {
        if (e.target === modal) {
            closeDemoManagementModal(modal);
        }
    });
    
    loadUserDemos();
    modal.querySelector('#demo-upload-form').addEventListener('submit', handleDemoUpload);
}

// Proper modal close function
function closeDemoManagementModal(modal) {
    if (modal && modal.parentNode) {
        modal.parentNode.removeChild(modal);
    }
    document.body.style.overflow = '';
}
// Show client project management modal
function showClientProjectManagement() {
    const modal = document.createElement('div');
    modal.className = 'client-project-modal';
    modal.style.cssText = `
        position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
        background: rgba(0, 0, 0, 0.8); z-index: 1002; 
        backdrop-filter: blur(10px); display: flex; 
        align-items: center; justify-content: center; padding: 2rem;
    `;
    
    modal.innerHTML = `
        <div class="glass-card" style="max-width: 1000px; width: 100%; margin: 0 1rem; max-height: 80vh; overflow-y: auto;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                <h3 style="color: var(--accent-color); margin: 0;"> Manage My Projects</h3>
                <button class="modal-close-btn" type="button"
                        style="background: none; border: none; color: var(--text-secondary); font-size: 1.5rem; cursor: pointer;">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div style="display: flex; gap: 1rem; margin-bottom: 2rem; flex-wrap: wrap; justify-content: center;">
                <button class="btn btn-primary" onclick="showPage('post-project'); closeClientProjectModal()">
                    <i class="fas fa-plus-circle"></i>
                    Post New Project
                </button>
                <button class="btn btn-secondary" onclick="cleanupExpiredProjects()">
                    <i class="fas fa-broom"></i>
                    Clean Up Expired Projects
                </button>
            </div>
            
            <div class="glass-card" style="background: rgba(0, 212, 255, 0.1); margin-bottom: 2rem;">
                <h4 style="color: var(--accent-color); margin-bottom: 1rem;"> Project Management Info</h4>
                <div style="color: var(--text-secondary); font-size: 0.9rem;">
                    <p style="margin: 0 0 0.5rem 0;"> Projects are automatically removed after 60 days</p>
                    <p style="margin: 0 0 0.5rem 0;"> You can manually delete projects anytime</p>
                    <p style="margin: 0;"> Project applications are sent to your email</p>
                </div>
            </div>
            
            <div id="client-projects-grid">
                <div style="text-align: center; color: var(--text-secondary);">
                    <i class="fas fa-spinner fa-spin"></i> Loading your projects...
                </div>
            </div>
        </div>
    `;
    
    document.body.appendChild(modal);
    document.body.style.overflow = 'hidden';
    
    // Add event listeners
    const closeBtn = modal.querySelector('.modal-close-btn');
    closeBtn.addEventListener('click', function() {
        closeClientProjectModal();
    });
    
    // Close on background click
    modal.addEventListener('click', function(e) {
        if (e.target === modal) {
            closeClientProjectModal();
        }
    });
    
    loadClientProjectsInModal();
}

function closeClientProjectModal() {
    const modal = document.querySelector('.client-project-modal');
    if (modal && modal.parentNode) {
        modal.parentNode.removeChild(modal);
    }
    document.body.style.overflow = '';
}


// Load user's demos
async function loadUserDemos() {
    try {
        const response = await apiCall('/api/talent/demos');
        const demos = response.demos || [];
        
        const demosList = document.getElementById('demos-list-manage');
        
        if (demos.length === 0) {
            demosList.innerHTML = `
                <div style="text-align: center; color: var(--text-secondary); padding: 2rem;">
                    <i class="fas fa-microphone-slash" style="font-size: 2rem; margin-bottom: 1rem;"></i>
                    <p>No demos uploaded yet. Upload your first demo above!</p>
                </div>
            `;
            return;
        }
        
        demosList.innerHTML = demos.map(demo => {
            const safeDemoId = String(demo.id || '').replace(/'/g, '&#39;');
            const safeDemoTitle = String(demo.title || 'Demo').replace(/'/g, '&#39;');
            
            return `
            <div class="glass-card" style="margin-bottom: 1rem; background: rgba(255, 255, 255, 0.05);">
                <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 1rem;">
                    <div style="flex: 1;">
                        <h5 style="margin: 0; color: var(--text-primary);">${demo.title}</h5>
                        <p style="margin: 0.5rem 0; color: var(--text-secondary); font-size: 0.9rem;">${demo.description || 'No description'}</p>
                        <div style="display: flex; gap: 1rem; font-size: 0.8rem; color: var(--text-secondary);">
                            <span><i class="fas fa-calendar"></i> ${new Date(demo.created_at).toLocaleDateString()}</span>
                            ${demo.duration ? `<span><i class="fas fa-clock"></i> ${demo.duration}</span>` : ''}
                        </div>
                    </div>
                    <button onclick="deleteDemo('${safeDemoId}', '${safeDemoTitle}')" 
                            class="btn" style="background: var(--warning-color); color: white; padding: 0.5rem 1rem; margin-left: 1rem;">
                        <i class="fas fa-trash"></i>
                        Delete
                    </button>
                </div>
                
                <div style="background: rgba(0, 0, 0, 0.3); border-radius: 10px; padding: 1rem;">
                    <audio controls style="width: 100%;" preload="metadata" 
                           data-demo-id="${safeDemoId}"
                           onloadstart="console.log('Loading demo: ${safeDemoTitle}')" 
                           onerror="handleAudioError(this, '${safeDemoId}')">
                        <source src="${getAudioUrl(demo.url)}" type="audio/mpeg">
                        <source src="${getAudioUrl(demo.url)}" type="audio/wav">
                        <source src="${getAudioUrl(demo.url)}" type="audio/mp4">
                        Your browser does not support the audio element.
                    </audio>
                    <div class="audio-error-message" style="display: none; color: var(--warning-color); text-align: center; margin-top: 0.5rem; font-size: 0.9rem;">
                        <i class="fas fa-exclamation-triangle"></i>
                        Failed to load audio file. Check that the file was uploaded correctly.
                        <button onclick="retryAudio(this)" style="background: none; border: none; color: var(--accent-color); cursor: pointer; text-decoration: underline; margin-left: 0.5rem;">Retry</button>
                    </div>
                </div>
            </div>
        `;
        }).join('');
        
        // Debug audio URLs
        demos.forEach(demo => {
            console.log(`Demo "${demo.title}" URL:`, getAudioUrl(demo.url));
        });
        
    } catch (error) {
        console.error('Failed to load demos:', error);
        document.getElementById('demos-list-manage').innerHTML = `
            <div style="text-align: center; color: var(--warning-color); padding: 2rem;">
                <i class="fas fa-exclamation-triangle" style="font-size: 2rem; margin-bottom: 1rem;"></i>
                <p>Failed to load demos. Please try again.</p>
                <button onclick="loadUserDemos()" class="btn btn-secondary" style="margin-top: 1rem;">
                    <i class="fas fa-refresh"></i> Retry
                </button>
            </div>
        `;
    }
}

// Handle demo upload
async function handleDemoUpload(e) {
    e.preventDefault();
    
    const form = e.target;
    const formData = new FormData(form);
    const submitBtn = form.querySelector('button[type="submit"]');
    
    const audioFile = formData.get('audioFile');
    if (!audioFile || audioFile.size === 0) {
        showNotification(' Please select an audio file', 'error');
        return;
    }
    
    if (audioFile.size > 10 * 1024 * 1024) {
        showNotification(' File too large. Maximum size is 10MB', 'error');
        return;
    }
    
    submitBtn.classList.add('loading');
    submitBtn.disabled = true;
    
    try {
        // Use FormData for file uploads, not JSON
        const uploadFormData = new FormData();
        uploadFormData.append('title', formData.get('title'));
        uploadFormData.append('description', formData.get('description') || '');
        uploadFormData.append('audioFile', audioFile);
        
        const response = await fetch(`${API_BASE_URL}/api/talent/demos`, {
            method: 'POST',
            headers: {
                'Authorization': authToken ? `Bearer ${authToken}` : ''
            },
            body: uploadFormData // Send FormData directly, not JSON
        });
        
        if (!response.ok) {
            const errorText = await response.text();
            throw new Error(errorText || 'Upload failed');
        }
        
        showNotification(' Demo uploaded successfully!', 'success');
        form.reset();
        loadUserDemos();
        loadTalentData();
        
    } catch (error) {
        console.error('Demo upload error:', error);
        showNotification(` Upload failed: ${error.message}`, 'error');
    } finally {
        submitBtn.classList.remove('loading');
        submitBtn.disabled = false;
    }
}

// Delete demo
async function deleteDemo(demoId, demoTitle) {
    const confirmed = confirm(`Are you sure you want to delete "${demoTitle}"?\n\nThis action cannot be undone.`);
    
    if (!confirmed) return;
    
    try {
        await apiCall(`/api/talent/demos/${demoId}`, {
            method: 'DELETE'
        });
        
        showNotification(' Demo deleted successfully', 'success');
        loadUserDemos();
        loadTalentData();
        
    } catch (error) {
        console.error('Delete demo error:', error);
        showNotification(` Failed to delete demo: ${error.message}`, 'error');
    }
}
             
// Toggle bio read more/less functionality
function toggleBio(button) {
    const bioElement = button.parentNode.querySelector('.talent-bio');
    const isExpanded = bioElement.classList.contains('expanded');
    
    if (isExpanded) {
        bioElement.classList.remove('expanded');
        button.textContent = 'Read more';
        button.style.color = 'var(--accent-color)';
    } else {
        bioElement.classList.add('expanded');
        button.textContent = 'Read less';
        button.style.color = 'var(--accent-color)';
    }
}

// Toggle bio read more/less functionality
function toggleBio(button) {
    const bioElement = button.parentNode.querySelector('.talent-bio');
    const isExpanded = bioElement.classList.contains('expanded');
    
    if (isExpanded) {
        bioElement.classList.remove('expanded');
        button.textContent = 'Read more';
        button.style.color = 'var(--accent-color)';
    } else {
        bioElement.classList.add('expanded');
        button.textContent = 'Read less';
        button.style.color = 'var(--accent-color)';
    }
}

// Toggle project description read more/less functionality
function toggleProjectDescription(button) {
    const descElement = button.parentNode.querySelector('.project-description');
    const isExpanded = descElement.classList.contains('expanded');
    
    if (isExpanded) {
        descElement.classList.remove('expanded');
        button.textContent = 'Read more';
        button.style.color = 'var(--accent-color)';
    } else {
        descElement.classList.add('expanded');
        button.textContent = 'Read less';
        button.style.color = 'var(--accent-color)';
    }
}


        // Profile photo functions
        function changeProfilePhoto() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.jpg,.jpeg,.png,.gif';
            input.style.display = 'none';
            
            input.addEventListener('change', async function(e) {
                const file = e.target.files[0];
                if (!file) return;
                
                if (file.size > 5 * 1024 * 1024) {
                    showNotification(' File too large. Maximum size is 5MB', 'error');
                    return;
                }
                
                await uploadProfilePhoto(file);
            });
            
            document.body.appendChild(input);
            input.click();
            document.body.removeChild(input);
        }

        async function uploadProfilePhoto(file) {
            try {
                showNotification(' Uploading profile photo...', 'success');
                
                const formData = new FormData();
                formData.append('profilePhoto', file);
                
                const response = await fetch(`${API_BASE_URL}/api/auth/upload-profile-photo`, {
                    method: 'POST',
                    headers: {
                        'Authorization': authToken ? `Bearer ${authToken}` : ''
                    },
                    body: formData
                });
                
                if (!response.ok) {
                    const errorText = await response.text();
                    throw new Error(errorText || 'Upload failed');
                }
                
                const result = await response.json();
                currentUser.profile_photo = result.filename;
                
                try {
                    localStorage.setItem('user', JSON.stringify(currentUser));
                } catch (error) {
                    console.log('localStorage not available');
                }
                
                showNotification(' Profile photo updated successfully!', 'success');
                loadAccountInfo();
                updateUIForSignedInUser();
                loadTalentData();
                
            } catch (error) {
                console.error('Profile photo upload error:', error);
                showNotification(` Upload failed: ${error.message}`, 'error');
            }
        }
// Messaging System Functions
        let currentConversation = null;

        // Load conversations for messages page
      // Load conversations for messages page
       async function loadConversations() {
    console.log(' Loading conversations...', { isUserSignedIn, currentUser, authToken });
    
    // Check authentication with retry logic for email link scenarios
    if (!isUserSignedIn || !currentUser || !authToken) {
        console.log(' Authentication not ready, attempting to restore...');
        
        // Try to restore authentication from localStorage
        try {
            const token = localStorage.getItem('token');
            const user = localStorage.getItem('user');
            
            if (token && user) {
                authToken = token;
                currentUser = JSON.parse(user);
                isUserSignedIn = true;
                console.log(' Authentication restored from localStorage');
            } else {
                console.log(' No stored authentication found');
                document.getElementById('conversations-list').innerHTML = `
                    <div style="text-align: center; padding: 2rem;">
                        <h4>Sign In Required</h4>
                        <p style="color: var(--text-secondary);">Please sign in to view your messages.</p>
                        <button class="btn btn-primary" onclick="showPage('signin')">Sign In</button>
                    </div>
                `;
                return;
            }
        } catch (error) {
            console.error('Failed to restore authentication:', error);
            document.getElementById('conversations-list').innerHTML = `
                <div style="text-align: center; padding: 2rem;">
                    <h4>Sign In Required</h4>
                    <p style="color: var(--text-secondary);">Please sign in to view your messages.</p>
                    <button class="btn btn-primary" onclick="showPage('signin')">Sign In</button>
                </div>
            `;
            return;
        }
    }

    // Show loading state
    document.getElementById('conversations-list').innerHTML = `
        <div style="text-align: center; padding: 2rem;">
            <i class="fas fa-spinner fa-spin" style="font-size: 2rem; margin-bottom: 1rem; color: var(--accent-color);"></i>
            <p style="color: var(--text-secondary);">Loading your conversations...</p>
        </div>
    `;

    try {
        console.log(' Making API call to /api/conversations');
        const response = await apiCall('/api/conversations');
        console.log(' Conversations API response:', response);
        const conversations = response.conversations || [];

        const conversationsList = document.getElementById('conversations-list');
        
        if (conversations.length === 0) {
            conversationsList.innerHTML = `
                <div style="text-align: center; padding: 2rem;">
                    <div style="font-size: 3rem; margin-bottom: 1rem;"></div>
                    <h4>No Conversations Yet</h4>
                    <p style="color: var(--text-secondary);">
                        ${currentUser.account_type === 'client' ? 
                            'When talent apply to your projects, conversations will appear here.' :
                            'When you apply to projects, conversations with clients will appear here.'
                        }
                    </p>
                    ${currentUser.account_type === 'client' ? 
                        '<button class="btn btn-primary" onclick="showPage(\'post-project\')">Post a Project</button>' :
                        '<button class="btn btn-primary" onclick="showPage(\'projects\')">Browse Projects</button>'
                    }
                </div>
            `;
            return;
        }

        conversationsList.innerHTML = conversations.map(conv => {
            const participantName = currentUser.account_type === 'client' ? conv.talent_name : conv.client_name;
            const participantId = currentUser.account_type === 'client' ? conv.talent_id : conv.client_id;
            const participantPhoto = currentUser.account_type === 'client' ? conv.talent_photo : conv.client_photo;
            const specialties = currentUser.account_type === 'client' && conv.talent_specialties ? conv.talent_specialties : '';
            
            const lastMessagePreview = conv.last_message ? 
                (conv.last_message.length > 60 ? conv.last_message.substring(0, 60) + '...' : conv.last_message) : 
                'No messages yet';
            
            const timeAgo = new Date(conv.last_message_time).toLocaleDateString();
            const unreadBadge = conv.unread_count > 0 ? 
                `<span style="background: var(--warning-color); color: white; padding: 0.3rem 0.6rem; border-radius: 50%; font-size: 0.8rem; font-weight: bold;">${conv.unread_count}</span>` : '';
            
            return `
                <div class="glass-card hover-lift" style="margin-bottom: 1rem; cursor: pointer; ${conv.unread_count > 0 ? 'border-color: var(--accent-color);' : ''}" 
                     onclick="openSpecificConversation(${conv.project_id}, ${participantId}, '${conv.project_title}', '${participantName}')">
                    <div style="display: flex; align-items: center; gap: 1rem;">
                        <div style="width: 60px; height: 60px; border-radius: 50%; background: var(--primary-gradient); display: flex; align-items: center; justify-content: center; font-size: 1.2rem; font-weight: 800; color: white; overflow: hidden; flex-shrink: 0;">
                            ${participantPhoto ? 
                                `<img src="${API_BASE_URL}/uploads/profiles/${participantPhoto}" style="width: 100%; height: 100%; object-fit: cover;" alt="${participantName}">` : 
                                `${participantName.split(' ').map(n => n[0]).join('')}`
                            }
                        </div>
                        <div style="flex: 1; min-width: 0;">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
                                <h4 style="margin: 0; color: var(--text-primary); font-size: 1.1rem; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">
                                    ${participantName}
                                </h4>
                                <div style="display: flex; align-items: center; gap: 0.5rem;">
                                    ${unreadBadge}
                                    <span style="color: var(--text-secondary); font-size: 0.8rem; white-space: nowrap;">${timeAgo}</span>
                                </div>
                            </div>
                            <p style="margin: 0 0 0.5rem 0; color: var(--accent-color); font-size: 0.9rem; font-weight: 500; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">
                                 ${conv.project_title}
                            </p>
                            ${specialties ? `<p style="margin: 0 0 0.5rem 0; color: var(--text-secondary); font-size: 0.8rem;">${specialties}</p>` : ''}
                            <p style="margin: 0; color: var(--text-secondary); font-size: 0.9rem; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">
                                ${lastMessagePreview}
                            </p>
                        </div>
                        <div style="color: var(--accent-color); font-size: 1.2rem; flex-shrink: 0;">
                            <i class="fas fa-chevron-right"></i>
                        </div>
                    </div>
                </div>
            `;
        }).join('');

    } catch (error) {
        console.error(' Failed to load conversations:', error);
        
        // Check if it's an authentication error
        if (error.message.includes('401') || error.message.includes('unauthorized')) {
            console.log(' Authentication error detected, redirecting to sign in');
            document.getElementById('conversations-list').innerHTML = `
                <div style="text-align: center; padding: 2rem;">
                    <div style="font-size: 2rem; margin-bottom: 1rem;"></div>
                    <h4>Session Expired</h4>
                    <p style="color: var(--text-secondary);">Please sign in again to view your messages.</p>
                    <button class="btn btn-primary" onclick="showPage('signin')">Sign In</button>
                </div>
            `;
            
            // Clear invalid authentication
            try {
                localStorage.removeItem('token');
                localStorage.removeItem('user');
            } catch (e) {}
            
            authToken = null;
            currentUser = null;
            isUserSignedIn = false;
            
        } else {
            document.getElementById('conversations-list').innerHTML = `
                <div style="text-align: center; padding: 2rem; color: var(--warning-color);">
                    <div style="font-size: 2rem; margin-bottom: 1rem;"></div>
                    <h4>Failed to Load Conversations</h4>
                    <p>Error: ${error.message}</p>
                    <p style="font-size: 0.9rem; color: var(--text-secondary);">Please check your connection and try again.</p>
                    <div style="display: flex; gap: 1rem; justify-content: center; margin-top: 1rem;">
                        <button class="btn btn-secondary" onclick="loadConversations()">
                            <i class="fas fa-refresh"></i> Retry
                        </button>
                        <button class="btn btn-primary" onclick="showPage('signin')">
                            <i class="fas fa-sign-in-alt"></i> Sign In Again
                        </button>
                    </div>
                </div>
            `;
        }
    }
}
        // Open a conversation thread
// Open a specific conversation thread
        async function openSpecificConversation(projectId, participantId, projectTitle, participantName) {
            currentConversation = { projectId, participantId, projectTitle, participantName };
            
            document.getElementById('thread-title').textContent = `${participantName} - ${projectTitle}`;
            document.getElementById('message-thread').style.display = 'block';
            
            await loadConversationMessages(projectId, participantId);
        }

        // Legacy function for backward compatibility
        async function openConversation(projectId, projectTitle) {
            // This shouldn't be used anymore, but keeping for safety
            console.warn('Using deprecated openConversation function');
            showNotification(' Please refresh and try again', 'error');
        }

        // Load messages for a project
       // Load messages for a specific conversation
        async function loadConversationMessages(projectId, participantId) {
            try {
                const response = await apiCall(`/api/conversations/${projectId}/${participantId}/messages`);
                const messages = response.messages || [];
                
                const messagesList = document.getElementById('messages-list');
                
                if (messages.length === 0) {
                    messagesList.innerHTML = `
                        <div style="text-align: center; color: var(--text-secondary); padding: 2rem;">
                            <i class="fas fa-comment-slash" style="font-size: 2rem; margin-bottom: 1rem;"></i>
                            <p>No messages yet. Start the conversation!</p>
                        </div>
                    `;
                    return;
                }

              // Update the message display in loadConversationMessages function
messagesList.innerHTML = messages.map(msg => {
    const isMyMessage = msg.sender_id === currentUser.id;
    const messageId = String(msg.id || '').replace(/'/g, '&#39;');
    
  // Handle attachments
    let attachmentHTML = '';
    if (msg.attachment_url) {
        const attachmentName = msg.attachment_original_name || msg.attachment_url.split('/').pop();
        const isAudio = attachmentName.match(/\.(mp3|wav|aiff|m4a)$/i);
        const isScript = attachmentName.match(/\.(pdf|doc|docx|txt)$/i);
        const isImage = attachmentName.match(/\.(jpg|jpeg|png)$/i);
        
        if (isAudio) {
            attachmentHTML = `
                <div style="margin-top: 1rem; padding: 1rem; background: rgba(0, 0, 0, 0.2); border-radius: 10px;">
                    <div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.5rem;">
                        <i class="fas fa-music"></i>
                        <span style="font-weight: 600;">${attachmentName}</span>
                    </div>
                    <audio controls style="width: 100%;" preload="metadata">
                        <source src="${API_BASE_URL}${msg.attachment_url}" type="audio/mpeg">
                        <source src="${API_BASE_URL}${msg.attachment_url}" type="audio/wav">
                        Your browser does not support the audio element.
                    </audio>
                </div>
            `;
        } else if (isScript) {
            attachmentHTML = `
                <div style="margin-top: 1rem; padding: 1rem; background: rgba(0, 0, 0, 0.2); border-radius: 10px;">
                    <div style="display: flex; align-items: center; justify-content: space-between;">
                        <div style="display: flex; align-items: center; gap: 0.5rem;">
                            <i class="fas fa-file-text"></i>
                            <span style="font-weight: 600;">${attachmentName}</span>
                        </div>
                        <a href="${API_BASE_URL}${msg.attachment_url}" download="${attachmentName}" 
                           class="btn btn-secondary" style="padding: 0.4rem 0.8rem; font-size: 0.8rem;">
                            <i class="fas fa-download"></i>
                            Download
                        </a>
                    </div>
                </div>
            `;
        } else if (isImage) {
            attachmentHTML = `
                <div style="margin-top: 1rem; padding: 1rem; background: rgba(0, 0, 0, 0.2); border-radius: 10px;">
                    <div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.5rem;">
                        <i class="fas fa-image"></i>
                        <span style="font-weight: 600;">${attachmentName}</span>
                    </div>
                    <img src="${API_BASE_URL}${msg.attachment_url}" 
                         style="max-width: 100%; max-height: 300px; border-radius: 5px; cursor: pointer;" 
                         onclick="window.open('${API_BASE_URL}${msg.attachment_url}', '_blank')"
                         alt="${attachmentName}">
                </div>
            `;
        }
    }
    
    return `
        <div style="display: flex; ${isMyMessage ? 'justify-content: flex-end' : 'justify-content: flex-start'}; margin-bottom: 1rem;" 
             id="message-${messageId}">
            <div style="
                max-width: 70%; 
                padding: 1rem; 
                border-radius: 15px; 
                position: relative;
                ${isMyMessage ? 
                    'background: var(--primary-gradient); color: white; margin-left: 2rem;' : 
                    'background: rgba(255, 255, 255, 0.1); margin-right: 2rem;'
                }
            ">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
                    <div style="font-weight: 600; font-size: 0.9rem; ${isMyMessage ? 'color: rgba(255, 255, 255, 0.8)' : 'color: var(--accent-color)'};">
                        ${isMyMessage ? 'You' : msg.sender_name}
                    </div>
                    <button onclick="deleteMessage('${messageId}')" 
                            style="background: none; border: none; color: ${isMyMessage ? 'rgba(255, 255, 255, 0.6)' : 'var(--text-secondary)'}; cursor: pointer; padding: 0.2rem; border-radius: 3px; font-size: 0.8rem; opacity: 0.7; transition: all 0.2s ease;"
                            title="Delete this message">
                        <i class="fas fa-trash"></i>
                    </button>
                </div>
                ${msg.message_text ? `
                    <div style="line-height: 1.5; margin-bottom: ${attachmentHTML ? '0' : '0.5rem'};">
                        ${msg.message_text.replace(/\n/g, '<br>')}
                    </div>
                ` : ''}
                ${attachmentHTML}
                <div style="font-size: 0.8rem; margin-top: 0.5rem; ${isMyMessage ? 'color: rgba(255, 255, 255, 0.6)' : 'color: var(--text-secondary)'};">
                    ${new Date(msg.created_at).toLocaleString()}
                </div>
            </div>
        </div>
    `;
}).join('');
                // Scroll to bottom
                const container = document.getElementById('messages-container');
                container.scrollTop = container.scrollHeight;

          } catch (error) {
                console.error('Failed to load conversation messages:', error);
                document.getElementById('messages-list').innerHTML = `
                    <div style="text-align: center; color: var(--warning-color); padding: 2rem;">
                        <p>Failed to load messages. Please try again.</p>
                    </div>
                `;
            }
        }

        // Delete a message
        async function deleteMessage(messageId) {
            const confirmed = confirm('Are you sure you want to delete this message?\n\nThis will remove it from your view only.');
            
            if (!confirmed) return;
            
            try {
                await apiCall(`/api/messages/${messageId}`, {
                    method: 'DELETE'
                });
                
                // Remove the message from the UI immediately
                const messageElement = document.getElementById(`message-${messageId}`);
                if (messageElement) {
                    messageElement.style.animation = 'fadeOut 0.3s ease';
                    setTimeout(() => {
                        messageElement.remove();
                    }, 300);
                }
                
                showNotification(' Message deleted successfully', 'success');
                
                // Refresh the conversation list to update last message previews
                setTimeout(() => {
                    if (document.getElementById('conversations-list')) {
                        loadConversations();
                    }
                }, 500);
                
            } catch (error) {
                console.error('Delete message error:', error);
                showNotification(` Failed to delete message: ${error.message}`, 'error');
            }
        }

        // Legacy function for backward compatibility
        async function loadMessages(projectId) {
            console.warn('Using deprecated loadMessages function');
            showNotification(' Please refresh and try again', 'error');
        }

// Close message thread
        function closeMessageThread() {
            document.getElementById('message-thread').style.display = 'none';
            currentConversation = null;
        }

        // Delete a message
        async function deleteMessage(messageId) {
            const confirmed = confirm('Are you sure you want to delete this message?\n\nThis will remove it from your view only.');
            
            if (!confirmed) return;
            
            try {
                await apiCall(`/api/messages/${messageId}`, {
                    method: 'DELETE'
                });
                
                // Remove the message from the UI immediately
                const messageElement = document.getElementById(`message-${messageId}`);
                if (messageElement) {
                    messageElement.style.animation = 'fadeOut 0.3s ease';
                    setTimeout(() => {
                        messageElement.remove();
                    }, 300);
                }
                
                showNotification(' Message deleted successfully', 'success');
                
                // Refresh the conversation list to update last message previews
                setTimeout(() => {
                    if (document.getElementById('conversations-list')) {
                        loadConversations();
                    }
                }, 500);
                
            } catch (error) {
                console.error('Delete message error:', error);
                showNotification(` Failed to delete message: ${error.message}`, 'error');
            }
        }

// Send message form handler
const sendMessageForm = document.getElementById('send-message-form');
if (sendMessageForm) {
    sendMessageForm.addEventListener('submit', async function(e) {
        e.preventDefault();
        
        if (!currentConversation) return;
        
        const messageInput = document.getElementById('message-input');
        const fileInput = document.getElementById('message-file-input');
        const message = messageInput.value.trim();
        const file = fileInput ? fileInput.files[0] : null;
        
        if (!message && !file) {
            showNotification(' Please enter a message or attach a file', 'error');
            return;
        }

        // Check for personal information in text messages
        if (message) {
            const violations = detectPersonalInfo(message);
            if (violations.length > 0) {
                showPersonalInfoWarning(violations);
                return; // Stop message sending
            }
        }

        // Check filename for personal info
        if (file) {
            const filenameViolations = detectPersonalInfo(file.name);
            if (filenameViolations.length > 0) {
                showNotification(' Please rename your file to remove personal information before uploading.', 'error');
                return;
            }
        }        
        const submitBtn = this.querySelector('button[type="submit"]');
        const originalText = submitBtn.innerHTML;
        submitBtn.classList.add('loading');
        submitBtn.disabled = true;
        
        try {
            if (file) {
                // Use FormData for file uploads
                const formData = new FormData();
                formData.append('message', message || '');
                formData.append('attachment', file);
                
                const response = await fetch(`${API_BASE_URL}/api/conversations/${currentConversation.projectId}/${currentConversation.participantId}/messages`, {
                    method: 'POST',
                    headers: {
                        'Authorization': authToken ? `Bearer ${authToken}` : ''
                    },
                    body: formData
                });
                
                if (!response.ok) {
                    const errorText = await response.text();
                    throw new Error(errorText || 'Failed to send message');
                }
            } else {
                // Regular text message
                await apiCall(`/api/conversations/${currentConversation.projectId}/${currentConversation.participantId}/messages`, {
                    method: 'POST',
                    body: JSON.stringify({
                        message: message
                    })
                });
            }

            messageInput.value = '';
            if (window.clearSelectedFile) clearSelectedFile();
            await loadConversationMessages(currentConversation.projectId, currentConversation.participantId);
            showNotification(' Message sent successfully!', 'success');
            
        } catch (error) {
            console.error('Failed to send message:', error);
            showNotification(' Failed to send message: ' + error.message, 'error');
        } finally {
            submitBtn.classList.remove('loading');
            submitBtn.disabled = false;
            submitBtn.innerHTML = originalText;
        }
    });
}

// Real-time message input validation
        function validateMessageInput(input) {
            const message = input.value.trim();
            const warningDiv = document.getElementById('message-validation-warning');
            const detailsDiv = document.getElementById('validation-details');
            const submitBtn = document.querySelector('#send-message-form button[type="submit"]');
            
            if (!message) {
                warningDiv.style.display = 'none';
                if (submitBtn) submitBtn.disabled = false;
                return;
            }
            
            const violations = detectPersonalInfo(message);
            
            if (violations.length > 0) {
                warningDiv.style.display = 'block';
                detailsDiv.innerHTML = violations.map(v => 
                    `<div style="margin-bottom: 0.3rem;"> ${v.message}</div>`
                ).join('');
                
                // Show what was detected (first few characters only)
                const detectedItems = violations.flatMap(v => v.matches).map(match => 
                    match.length > 10 ? match.substring(0, 7) + '...' : match
                );
                if (detectedItems.length > 0) {
                    detailsDiv.innerHTML += `<div style="margin-top: 0.5rem; padding: 0.5rem; background: rgba(255, 107, 107, 0.2); border-radius: 5px; font-size: 0.8rem;">Detected: ${detectedItems.join(', ')}</div>`;
                }
                
                // Disable send button when violations are detected
                if (submitBtn) {
                    submitBtn.disabled = true;
                    submitBtn.innerHTML = '<i class="fas fa-exclamation-triangle"></i> Fix Issues to Send';
                    submitBtn.style.background = 'var(--warning-color)';
                }
            } else {
                warningDiv.style.display = 'none';
                if (submitBtn) {
                    submitBtn.disabled = false;
                    submitBtn.innerHTML = '<i class="fas fa-paper-plane"></i> Send Message';
                    submitBtn.style.background = '';
                }
            }
        }

        // Enhanced file validation for attachments
        function validateFileAttachment(file) {
            if (!file) return { valid: true };
            
            // Check filename for personal info
            const filenameViolations = detectPersonalInfo(file.name);
            if (filenameViolations.length > 0) {
                return {
                    valid: false,
                    message: 'Please rename your file to remove personal information before uploading.',
                    violations: filenameViolations
                };
            }
            
            // Check for suspicious file types that might contain contact info
            const suspiciousExtensions = ['.vcf', '.contact', '.txt'];
            const fileExt = '.' + file.name.split('.').pop().toLowerCase();
            
            if (suspiciousExtensions.includes(fileExt)) {
                return {
                    valid: false,
                    message: 'This file type is not allowed as it may contain personal contact information.'
                };
            }
            
            return { valid: true };
        }

        // Report current conversation
        function reportCurrentConversation() {
            if (!currentConversation) {
                showNotification(' No active conversation to report', 'error');
                return;
            }
            
            reportSuspiciousBehavior(
                currentConversation.projectId, 
                currentConversation.participantId, 
                'communication_violation'
            );
        }
// Handle payment setup from project listings
        function setupProjectPayment(projectId, projectTitle, budgetMin, budgetMax) {
            if (!isUserSignedIn) {
                showNotification(' Please sign in to set up payment protection', 'error');
                setTimeout(() => showPage('signin'), 1500);
                return;
            }
            
            if (currentUser.account_type !== 'client') {
                showNotification(' Only clients can set up payment protection for projects', 'error');
                return;
            }
            
            // Show payment setup modal (we'll use "Project Team" as placeholder for talent name)
            showPaymentSetupModal(projectId, 'Project Team', projectTitle, budgetMin, budgetMax);
        }

// Payment Protection and Escrow Functions
        function showPaymentSetupModal(projectId, talentName, projectTitle, budgetMin, budgetMax) {
            const modal = document.createElement('div');
            modal.className = 'payment-setup-modal';
            modal.style.cssText = `
                position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
                background: rgba(0, 0, 0, 0.8); z-index: 1003; 
                backdrop-filter: blur(10px); display: flex; 
                align-items: center; justify-content: center; padding: 2rem;
            `;
            
            const estimatedAmount = budgetMax || budgetMin || 500;
            
            modal.innerHTML = `
                <div class="glass-card" style="max-width: 700px; width: 100%; margin: 0 1rem; max-height: 80vh; overflow-y: auto;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                        <h3 style="color: var(--accent-color); margin: 0;"> Secure Payment Setup</h3>
                        <button onclick="closePaymentModal()" 
                                style="background: none; border: none; color: var(--text-secondary); font-size: 1.5rem; cursor: pointer;"></button>
                    </div>
                    
                    <div style="background: rgba(78, 205, 196, 0.1); border-radius: 10px; padding: 1.5rem; margin-bottom: 2rem;">
                        <h4 style="color: var(--success-color); margin-bottom: 1rem;"> Payment Protection Required</h4>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; color: var(--text-secondary); font-size: 0.9rem;">
                            <div><strong>Project:</strong> ${projectTitle}</div>
                            <div><strong>Talent:</strong> ${talentName}</div>
                            <div><strong>Budget Range:</strong> $${budgetMin}-${budgetMax}</div>
                            <div><strong>Recommended:</strong> Escrow Protection</div>
                        </div>
                    </div>

                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem; margin-bottom: 2rem;">
                  <!-- Escrow Option -->
                        <div class="glass-card" style="border-color: var(--success-color); background: rgba(78, 205, 196, 0.05);">
                            <div style="text-align: center; margin-bottom: 1rem;">
                                <div style="font-size: 2rem; margin-bottom: 0.5rem;"></div>
                                <h4 style="color: var(--success-color); margin: 0;">Secure Escrow</h4>
                                <div style="background: var(--success-color); color: white; padding: 0.3rem 0.8rem; border-radius: 15px; font-size: 0.8rem; margin-top: 0.5rem; display: inline-block;">
                                    RECOMMENDED
                                </div>
                            </div>
                            <ul style="text-align: left; color: var(--text-secondary); font-size: 0.9rem; margin-bottom: 1rem;">
                                <li> Funds held safely until delivery</li>
                                <li> Talent guaranteed payment</li>
                                <li> Automatic release on approval</li>
                                <li> Full dispute protection</li>
                                <li> No additional fees</li>
                            </ul>
                            
                            <div style="margin-bottom: 1.5rem;">
                                <label style="display: block; color: var(--text-primary); font-weight: 600; margin-bottom: 0.5rem;">
                                     Escrow Amount ($)
                                </label>
                                <input type="number" id="escrow-amount-input" class="form-input" 
                                       value="${estimatedAmount}" min="50" max="10000" step="1"
                                       placeholder="Enter amount to secure"
                                       style="text-align: center; font-size: 1.1rem; font-weight: 600;">
                                <small style="color: var(--text-secondary); font-size: 0.8rem; display: block; margin-top: 0.3rem;">
                                    Suggested: $${budgetMin}-${budgetMax}  Minimum: $50
                                </small>
                            </div>
                            
                            <button class="btn btn-primary" style="width: 100%;" onclick="setupEscrowWithCustomAmount('${projectId}', '${talentName}')">
                                <i class="fas fa-shield-alt"></i>
                                Setup Custom Escrow
                            </button>
                        </div>

                        <!-- Milestone Option -->
                        <div class="glass-card">
                            <div style="text-align: center; margin-bottom: 1rem;">
                                <div style="font-size: 2rem; margin-bottom: 0.5rem;"></div>
                                <h4 style="color: var(--accent-color); margin: 0;">Milestone Payments</h4>
                            </div>
                            <ul style="text-align: left; color: var(--text-secondary); font-size: 0.9rem; margin-bottom: 1.5rem;">
                                <li> Pay in phases</li>
                                <li> Reduced upfront payment</li>
                                <li> Track progress closely</li>
                                <li> Good for large projects</li>
                            </ul>
                            <button class="btn btn-secondary" onclick="setupMilestonePayment('${projectId}', ${estimatedAmount})" style="width: 100%;">
                                <i class="fas fa-list-check"></i>
                                Setup Milestones
                            </button>
                        </div>
                    </div>

                    <!-- PayPal Integration Container -->
                    <div id="paypal-escrow-container" style="display: none; margin-bottom: 2rem;">
                        <h4 style="color: var(--accent-color); margin-bottom: 1rem; text-align: center;">Complete Payment Setup</h4>
                        <div id="paypal-escrow-buttons" style="max-width: 400px; margin: 0 auto;"></div>
                    </div>

                    <div style="text-align: center; padding: 1rem; background: rgba(0, 212, 255, 0.1); border-radius: 10px;">
                        <p style="color: var(--text-secondary); margin: 0; font-size: 0.9rem;">
                            <i class="fas fa-info-circle"></i>
                            <strong>Why Payment Protection?</strong> Protected projects receive 300% more applications and complete 85% faster with higher quality results.
                        </p>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            document.body.style.overflow = 'hidden';
        }

        function closePaymentModal() {
            const modal = document.querySelector('.payment-setup-modal');
            if (modal) {
                modal.remove();
                document.body.style.overflow = '';
            }
        }

     // PayPal Escrow Setup - IMPROVED VERSION with Better Error Handling
async function setupEscrowPayment(projectId, amount, talentName) {
    try {
        showNotification(' Setting up secure escrow payment...', 'success');
        
        // Show PayPal container
        const paypalContainer = document.getElementById('paypal-escrow-container');
        paypalContainer.style.display = 'block';
        
        // Clear any existing content
        document.getElementById('paypal-escrow-buttons').innerHTML = '';
        
      // Skip backend health check - use frontend-only PayPal
        console.log('Using frontend-only PayPal escrow payments');
        
        // Try to load PayPal SDK specifically for payments
        try {
            await loadPayPalForPayments();
        } catch (sdkError) {
            console.error('PayPal SDK loading failed:', sdkError);
            showFallbackPaymentOption(projectId, amount, talentName);
            return;
        }
        
        // Verify PayPal is available
        if (typeof paypal === 'undefined') {
            console.error('PayPal SDK not available after loading');
            showFallbackPaymentOption(projectId, amount, talentName);
            return;
        }
        
// Load PayPal SDK specifically for payments (not subscriptions) - IMPROVED VERSION
async function loadPayPalForPayments() {
    // Check if we already have a payment-capable PayPal instance
    if (window.paypalPaymentsLoaded && typeof paypal !== 'undefined') {
        try {
            // Test if this PayPal instance can handle payments
            return Promise.resolve();
        } catch (e) {
            console.warn('Existing PayPal instance not suitable for payments');
        }
    }
    
    return new Promise((resolve, reject) => {
        // Show loading message
        const paypalContainer = document.getElementById('paypal-escrow-buttons');
        if (paypalContainer) {
            paypalContainer.innerHTML = '<div style="text-align: center; color: var(--text-secondary);"><i class="fas fa-spinner fa-spin"></i> Loading payment system...</div>';
        }
        
        // Create a new script tag for payment-specific PayPal SDK
        const script = document.createElement('script');
        script.src = 'https://www.paypal.com/sdk/js?client-id=AXOrnxVTPG4w2eAqaY2KnZKplxouVL3lfU2AWdU-S6U5Waq8CnpUzs9Zdjkkm3I1tdyv4o3XDZPTPLe9&intent=capture&currency=USD&disable-funding=venmo,paylater';
        script.async = true;
        script.id = 'paypal-payments-sdk';
        
        script.onload = function() {
            console.log(' PayPal SDK loaded for payments');
            window.paypalPaymentsLoaded = true;
            
            // Clear loading message
            if (paypalContainer) {
                paypalContainer.innerHTML = '';
            }
            
            resolve();
        };
        
        script.onerror = function() {
            console.error(' Failed to load PayPal SDK for payments');
            
            if (paypalContainer) {
                paypalContainer.innerHTML = `
                    <div style="text-align: center; padding: 2rem; border: 2px dashed var(--warning-color); border-radius: 15px;">
                        <h4 style="color: var(--warning-color); margin-bottom: 1rem;"> Payment System Error</h4>
                        <p style="color: var(--text-secondary); margin-bottom: 1.5rem;">
                            PayPal payment system is temporarily unavailable. Please try again.
                        </p>
                        <button class="btn btn-secondary" onclick="location.reload()">
                            <i class="fas fa-refresh"></i>
                            Refresh Page
                        </button>
                    </div>
                `;
            }
            
            reject(new Error('PayPal SDK failed to load'));
        };
        
        // Remove any existing PayPal payment scripts first
        const existingPaymentScript = document.getElementById('paypal-payments-sdk');
        if (existingPaymentScript) {
            existingPaymentScript.remove();
        }
        
        document.head.appendChild(script);
    });
}

// Show enhanced fallback payment option when PayPal fails
function showFallbackPaymentOption(projectId, amount, talentName) {
    const paypalContainer = document.getElementById('paypal-escrow-buttons');
    if (paypalContainer) {
        paypalContainer.innerHTML = `
            <div style="text-align: center; padding: 2rem; border: 2px dashed var(--warning-color); border-radius: 15px;">
                <h4 style="color: var(--warning-color); margin-bottom: 1rem;"> PayPal Integration Temporarily Unavailable</h4>
                <p style="color: var(--text-secondary); margin-bottom: 1.5rem;">
                    Our PayPal escrow system is experiencing technical difficulties. You can still proceed with these alternatives:
                </p>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 1.5rem;">
                    <div style="background: rgba(0, 212, 255, 0.1); border-radius: 10px; padding: 1rem;">
                        <h5 style="color: var(--accent-color); margin-bottom: 0.5rem;"> Direct Payment</h5>
                        <p style="color: var(--text-secondary); font-size: 0.9rem; margin: 0;">
                            Arrange payment terms directly with the talent
                        </p>
                    </div>
                    <div style="background: rgba(0, 212, 255, 0.1); border-radius: 10px; padding: 1rem;">
                        <h5 style="color: var(--accent-color); margin-bottom: 0.5rem;"> Bank Transfer</h5>
                        <p style="color: var(--text-secondary); font-size: 0.9rem; margin: 0;">
                            Use secure bank transfer with our guidance
                        </p>
                    </div>
                </div>
                
                <div style="display: flex; gap: 1rem; justify-content: center; flex-wrap: wrap; margin-bottom: 1.5rem;">
                    <button class="btn btn-secondary" onclick="location.reload()">
                        <i class="fas fa-refresh"></i>
                        Refresh & Try Again
                    </button>
                    <button class="btn btn-primary" onclick="proceedWithAlternativePayment('${projectId}', '${amount}', '${talentName}')">
                        <i class="fas fa-handshake"></i>
                        Setup Alternative Payment
                    </button>
                    <button class="btn btn-secondary" onclick="contactPaymentSupport('${projectId}', '${amount}')">
                        <i class="fas fa-headset"></i>
                        Get Help
                    </button>
                </div>
                
                <div style="padding: 1rem; background: rgba(0, 212, 255, 0.1); border-radius: 10px; font-size: 0.9rem; color: var(--text-secondary);">
                    <strong> Tech Issue:</strong> PayPal authentication failed on our servers. Our team has been notified and is working to resolve this. 
                    You can still work with talent and set up payment protection manually.
                </div>
            </div>
        `;
    }
}

// Setup alternative payment method
function proceedWithAlternativePayment(projectId, amount, talentName) {
    const modal = document.createElement('div');
    modal.className = 'alternative-payment-modal';
    modal.style.cssText = `
        position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
        background: rgba(0, 0, 0, 0.8); z-index: 1004; 
        backdrop-filter: blur(10px); display: flex; 
        align-items: center; justify-content: center; padding: 2rem;
    `;
    
    modal.innerHTML = `
        <div class="glass-card" style="max-width: 700px; width: 100%; margin: 0 1rem; max-height: 80vh; overflow-y: auto;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                <h3 style="color: var(--accent-color); margin: 0;"> Alternative Payment Setup</h3>
                <button onclick="this.closest('.alternative-payment-modal').remove(); document.body.style.overflow = ''" 
                        style="background: none; border: none; color: var(--text-secondary); font-size: 1.5rem; cursor: pointer;"></button>
            </div>
            
            <div style="background: rgba(0, 212, 255, 0.1); border-radius: 10px; padding: 1.5rem; margin-bottom: 2rem;">
                <h4 style="color: var(--accent-color); margin-bottom: 1rem;"> Project Details</h4>
                <div style="color: var(--text-secondary);">
                    <p><strong>Project ID:</strong> ${projectId}</p>
                    <p><strong>Talent:</strong> ${talentName}</p>
                    <p><strong>Estimated Amount:</strong> $${amount}</p>
                </div>
            </div>

            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem; margin-bottom: 2rem;">
                <div class="glass-card" style="text-align: center; padding: 1.5rem;">
                    <div style="font-size: 2rem; margin-bottom: 1rem;"></div>
                    <h4 style="color: var(--accent-color); margin-bottom: 1rem;">Direct Arrangement</h4>
                    <p style="color: var(--text-secondary); font-size: 0.9rem; margin-bottom: 1.5rem;">
                        Work directly with the talent to arrange payment terms that work for both parties.
                    </p>
                    <button class="btn btn-primary" onclick="proceedWithDirectArrangement('${projectId}', '${talentName}')" style="width: 100%;">
                        <i class="fas fa-handshake"></i>
                        Proceed Direct
                    </button>
                </div>

                <div class="glass-card" style="text-align: center; padding: 1.5rem;">
                    <div style="font-size: 2rem; margin-bottom: 1rem;"></div>
                    <h4 style="color: var(--accent-color); margin-bottom: 1rem;">Guided Protection</h4>
                    <p style="color: var(--text-secondary); font-size: 0.9rem; margin-bottom: 1.5rem;">
                        Get help from our team to set up secure payment protection manually.
                    </p>
                    <button class="btn btn-secondary" onclick="requestGuidedPayment('${projectId}', '${amount}', '${talentName}')" style="width: 100%;">
                        <i class="fas fa-shield-alt"></i>
                        Get Guidance
                    </button>
                </div>
            </div>

            <div style="background: rgba(78, 205, 196, 0.1); border-radius: 10px; padding: 1.5rem; text-align: center;">
                <h4 style="color: var(--success-color); margin-bottom: 1rem;"> Payment Protection Tips</h4>
                <ul style="color: var(--text-secondary); font-size: 0.9rem; text-align: left; margin: 0;">
                    <li>Always define clear project milestones</li>
                    <li>Request samples or demos before full payment</li>
                    <li>Use written agreements for larger projects</li>
                    <li>Consider partial payments tied to deliverables</li>
                    <li>Keep all communication on VoicecastingPro</li>
                </ul>
            </div>
        </div>
    `;
    
    document.body.appendChild(modal);
    document.body.style.overflow = 'hidden';
}

// Proceed with direct arrangement
function proceedWithDirectArrangement(projectId, talentName) {
    const confirmed = confirm(`Proceed with direct payment arrangement?\n\n` +
        ` Project ID: ${projectId}\n` +
        ` Talent: ${talentName}\n\n` +
        `You'll work directly with the talent to arrange payment terms. ` +
        `We recommend discussing milestones and payment schedule before starting work.\n\n` +
        `Click OK to continue.`);
    
    if (!confirmed) return;
    
    // Close all modals
    document.querySelectorAll('.alternative-payment-modal, .payment-setup-modal').forEach(modal => modal.remove());
    document.body.style.overflow = '';
    
    showNotification(' Direct arrangement selected. Work with the talent to define payment terms and project milestones.', 'success');
    
    setTimeout(() => {
        showNotification(' Tip: Define clear deliverables and consider milestone-based payments for larger projects.', 'success');
    }, 3000);
}

// Request guided payment setup
function requestGuidedPayment(projectId, amount, talentName) {
    const email = currentUser ? currentUser.email : 'unknown';
    const subject = encodeURIComponent(`Guided Payment Setup Request - Project ${projectId}`);
    const body = encodeURIComponent(`Hi VoicecastingPro Support,

I need help setting up payment protection for my project since PayPal escrow is currently unavailable.

Project Details:
- Project ID: ${projectId}
- Talent: ${talentName}
- Estimated Amount: $${amount}
- Client Email: ${email}

Please contact me to discuss secure payment options.

Thank you!`);
    
    window.open(`mailto:support@voicecastingpro.com?subject=${subject}&body=${body}`, '_blank');
    
    // Close modals
    document.querySelectorAll('.alternative-payment-modal, .payment-setup-modal').forEach(modal => modal.remove());
    document.body.style.overflow = '';
    
    showNotification(' Support request sent! Our team will contact you within 24 hours to help set up payment protection.', 'success');
}

// Contact payment support
function contactPaymentSupport(projectId, amount) {
    const email = currentUser ? currentUser.email : 'unknown';
    const subject = encodeURIComponent(`PayPal Payment Issue - Project ${projectId}`);
    const body = encodeURIComponent(`Hi VoicecastingPro Support,

I'm experiencing issues with the PayPal escrow payment system.

Issue Details:
- Project ID: ${projectId}
- Attempted Amount: $${amount}
- User Email: ${email}
- Error: PayPal authentication failed
- Timestamp: ${new Date().toISOString()}

Please help resolve this payment issue.

Thank you!`);
    
    window.open(`mailto:support@voicecastingpro.com?subject=${subject}&body=${body}`, '_blank');
    showNotification(' Support request sent! Our team will help resolve the PayPal issue.', 'success');
}

        // Initialize PayPal buttons for escrow with enhanced error handling
        try {
            await paypal.Buttons({
                style: {
                    layout: 'vertical',
                    color: 'blue',
                    shape: 'rect',
                    label: 'pay',
                    height: 50
                },

                createOrder: function(data, actions) {
                    console.log(' Creating escrow order via backend...');
                    
                    // First try backend integration
                    return fetch(`${API_BASE_URL}/api/payments/paypal/create-order`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': authToken ? `Bearer ${authToken}` : ''
                        },
                        body: JSON.stringify({
                            amount: amount,
                            projectId: projectId,
                            talentName: talentName,
                            paymentType: 'escrow',
                            description: `Escrow Payment - Project ${projectId}`
                        })
                    }).then(function(response) {
                        console.log('Backend response status:', response.status);
                        
                        if (!response.ok) {
                            console.error('Backend create order failed:', response.status);
                            // Fallback to frontend-only PayPal order creation
                            return actions.order.create({
                                purchase_units: [{
                                    amount: {
                                        value: amount.toString(),
                                        currency_code: 'USD'
                                    },
                                    description: `Escrow Payment - Project ${projectId}`,
                                    custom_id: `project_${projectId}_client_${currentUser.id}`,
                                    invoice_id: `INV_${projectId}_${Date.now()}`
                                }],
                                application_context: {
                                    brand_name: 'VoicecastingPro Escrow',
                                    locale: 'en-US',
                                    landing_page: 'BILLING',
                                    shipping_preference: 'NO_SHIPPING',
                                    user_action: 'PAY_NOW'
                                }
                            });
                        }
                        return response.json();
                }).then(function(orderData) {
    console.log(' Order created:', orderData);
    // Handle different response formats from backend vs PayPal
    if (typeof orderData === 'string') {
        return orderData; // PayPal direct response (order ID string)
    } else if (orderData && orderData.id) {
        return orderData.id; // Backend response with id property
    } else if (orderData && orderData.orderId) {
        return orderData.orderId; // Backend response with orderId property
    } else {
        console.error('Unexpected order data format:', orderData);
        throw new Error('Invalid order response format');
    }
}).catch(function(error) {
                        console.error(' Create order error:', error);
                        
                        // Final fallback - try direct PayPal order creation
                        return actions.order.create({
                            purchase_units: [{
                                amount: {
                                    value: amount.toString(),
                                    currency_code: 'USD'
                                },
                                description: `Escrow Payment - Project ${projectId}`,
                                custom_id: `project_${projectId}_fallback`,
                                invoice_id: `INV_FALLBACK_${Date.now()}`
                            }],
                            application_context: {
                                brand_name: 'VoicecastingPro Payment',
                                locale: 'en-US',
                                landing_page: 'BILLING',
                                shipping_preference: 'NO_SHIPPING',
                                user_action: 'PAY_NOW'
                            }
                        });
                    });
                },

                onApprove: function(data, actions) {
                    console.log(' PayPal payment approved:', data);
                    
                    // Try to capture via backend first
                    return fetch(`${API_BASE_URL}/api/payments/paypal/capture/${data.orderID}`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': authToken ? `Bearer ${authToken}` : ''
                        },
                        body: JSON.stringify({
                            projectId: projectId,
                            talentName: talentName,
                            paymentType: 'escrow'
                        })
                    }).then(function(response) {
                        if (response.ok) {
                            return response.json();
                        } else {
                            console.warn('Backend capture failed, using frontend capture');
                            // Fallback to frontend capture
                            return actions.order.capture();
                        }
                    }).then(function(captureData) {
                        console.log(' Payment captured:', captureData);
                        
                        // Show success regardless of backend/frontend capture
                        showNotification(' Payment successful! Your funds are being processed.', 'success');
                        closePaymentModal();
                        
                        // Show confirmation
                        setTimeout(() => {
                            showManualEscrowConfirmation(projectId, amount, talentName, data.orderID);
                        }, 1000);
                        
                        return captureData;
                    }).catch(function(error) {
                        console.error(' Capture error:', error);
                        
                        // Even if capture fails, show partial success
                        showNotification(' Payment approved but processing incomplete. Please contact support with Order ID: ' + data.orderID, 'warning');
                        closePaymentModal();
                        
                        setTimeout(() => {
                            showManualEscrowConfirmation(projectId, amount, talentName, data.orderID);
                        }, 1000);
                    });
                },

                onError: function(err) {
                    console.error('PayPal payment error:', err);
                    showNotification(' PayPal payment failed. Please try the alternative payment option.', 'error');
                    showFallbackPaymentOption(projectId, amount, talentName);
                },

                onCancel: function(data) {
                    console.log('PayPal payment cancelled:', data);
                    showNotification(' Payment cancelled. You can try again or use alternative payment.', 'warning');
                }

            }).render('#paypal-escrow-buttons');
            
            console.log(' PayPal buttons rendered successfully');
            
        } catch (renderError) {
            console.error('PayPal render error:', renderError);
            showFallbackPaymentOption(projectId, amount, talentName);
            return;
        }

        // Scroll to PayPal buttons
        paypalContainer.scrollIntoView({ behavior: 'smooth', block: 'center' });
        
    } catch (error) {
        console.error('Escrow setup error:', error);
        showNotification(' Failed to set up escrow payment: ' + error.message, 'error');
        showFallbackPaymentOption(projectId, amount, talentName);
    }
}
   // Setup escrow with custom amount
        async function setupEscrowWithCustomAmount(projectId, talentName) {
            const amountInput = document.getElementById('escrow-amount-input');
            const customAmount = parseInt(amountInput.value);
            
            // Validate amount
            if (!customAmount || customAmount < 50) {
                showNotification(' Please enter a valid amount (minimum $50)', 'error');
                amountInput.focus();
                return;
            }
            
            if (customAmount > 10000) {
                showNotification(' Maximum escrow amount is $10,000. For larger amounts, please contact support.', 'error');
                amountInput.focus();
                return;
            }
            
            // Confirm the amount
            const confirmed = confirm(`Set up escrow payment for $${customAmount}?\n\n` +
                ` Amount: $${customAmount}\n` +
                ` Talent: ${talentName}\n` +
                ` Project: ${projectId}\n\n` +
                `This amount will be held securely until project completion.`);
            
            if (!confirmed) return;
            
            // Proceed with custom amount
            await setupEscrowPayment(projectId, customAmount, talentName);
        }

     // Show manual escrow confirmation (when backend fails)
        function showManualEscrowConfirmation(projectId, amount, talentName, orderID) {
            const modal = document.createElement('div');
            modal.className = 'manual-escrow-confirmation-modal';
            modal.style.cssText = `
                position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
                background: rgba(0, 0, 0, 0.8); z-index: 1003; 
                backdrop-filter: blur(10px); display: flex; 
                align-items: center; justify-content: center; padding: 2rem;
            `;
            
            modal.innerHTML = `
                <div class="glass-card" style="max-width: 600px; width: 100%; margin: 0 1rem; text-align: center;">
                    <div style="font-size: 3rem; margin-bottom: 1rem;"></div>
                    <h3 style="color: var(--accent-color); margin-bottom: 1rem;">Payment Received - Manual Setup Required</h3>
                    
                    <div style="background: rgba(78, 205, 196, 0.1); border-radius: 10px; padding: 1.5rem; margin-bottom: 2rem; text-align: left;">
                        <h4 style="color: var(--success-color); margin-bottom: 1rem;"> Payment Successful</h4>
                        <div style="color: var(--text-secondary);">
                            <p><strong>Amount Paid:</strong> $${amount}</p>
                            <p><strong>PayPal Order ID:</strong> ${orderID}</p>
                            <p><strong>Talent:</strong> ${talentName}</p>
                            <p><strong>Project ID:</strong> ${projectId}</p>
                        </div>
                    </div>

                    <div style="background: rgba(255, 193, 7, 0.1); border-radius: 10px; padding: 1.5rem; margin-bottom: 2rem; text-align: left;">
                        <h4 style="color: var(--warning-color); margin-bottom: 1rem;"> Setup Required</h4>
                        <div style="color: var(--text-secondary); font-size: 0.9rem;">
                            <p>Your payment was successful, but automatic escrow setup failed. We need to manually configure the payment protection.</p>
                            <p style="margin-top: 1rem;"><strong>Next steps:</strong></p>
                            <ol style="margin: 0.5rem 0 0 1.5rem;">
                                <li>Save your PayPal Order ID: <strong>${orderID}</strong></li>
                                <li>Our team will contact you within 24 hours</li>
                                <li>We'll set up escrow protection manually</li>
                                <li>You'll receive confirmation once complete</li>
                            </ol>
                        </div>
                    </div>

                    <div style="display: flex; gap: 1rem; flex-wrap: wrap;">
                        <button class="btn btn-secondary" onclick="copyOrderID('${orderID}')" style="flex: 1; min-width: 150px;">
                            <i class="fas fa-copy"></i>
                            Copy Order ID
                        </button>
                        <button class="btn btn-primary" onclick="contactSupportWithOrderID('${orderID}', '${projectId}')" style="flex: 1; min-width: 150px;">
                            <i class="fas fa-envelope"></i>
                            Contact Support
                        </button>
                        <button class="btn btn-secondary" onclick="this.closest('.manual-escrow-confirmation-modal').remove(); document.body.style.overflow = ''" style="flex: 1; min-width: 150px;">
                            <i class="fas fa-check"></i>
                            Got It
                        </button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            document.body.style.overflow = 'hidden';
        }

        // Copy order ID to clipboard
        function copyOrderID(orderID) {
            if (navigator.clipboard) {
                navigator.clipboard.writeText(orderID).then(function() {
                    showNotification(' Order ID copied to clipboard!', 'success');
                }).catch(function() {
                    // Fallback for older browsers
                    const textArea = document.createElement('textarea');
                    textArea.value = orderID;
                    document.body.appendChild(textArea);
                    textArea.select();
                    document.execCommand('copy');
                    document.body.removeChild(textArea);
                    showNotification(' Order ID copied to clipboard!', 'success');
                });
            } else {
                // Manual copy fallback
                prompt('Copy this Order ID and save it:', orderID);
            }
        }

        // Contact support with order ID
        function contactSupportWithOrderID(orderID, projectID) {
            const subject = encodeURIComponent(`Escrow Setup Required - Order ${orderID}`);
            const body = encodeURIComponent(`Hi VoicecastingPro Support,

I completed a PayPal payment but the automatic escrow setup failed. Please help me set up payment protection manually.

Payment Details:
- PayPal Order ID: ${orderID}
- Project ID: ${projectID}
- User: ${currentUser ? currentUser.email : 'Unknown'}

Please contact me to complete the escrow setup.

Thank you!`);
            
            window.open(`mailto:support@voicecastingpro.com?subject=${subject}&body=${body}`, '_blank');
        }

        // Show escrow confirmation (when everything works properly)
        function showEscrowConfirmation(projectId, amount, talentName) {
            const modal = document.createElement('div');
            modal.className = 'escrow-confirmation-modal';
            modal.style.cssText = `
                position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
                background: rgba(0, 0, 0, 0.8); z-index: 1003; 
                backdrop-filter: blur(10px); display: flex; 
                align-items: center; justify-content: center; padding: 2rem;
            `;
            
            modal.innerHTML = `
                <div class="glass-card" style="max-width: 500px; width: 100%; margin: 0 1rem; text-align: center;">
                    <div style="font-size: 3rem; margin-bottom: 1rem;"></div>
                    <h3 style="color: var(--success-color); margin-bottom: 1rem;">Escrow Payment Successful!</h3>
                    
                    <div style="background: rgba(78, 205, 196, 0.1); border-radius: 10px; padding: 1.5rem; margin-bottom: 2rem; text-align: left;">
                        <h4 style="color: var(--success-color); margin-bottom: 1rem;"> Payment Details</h4>
                        <div style="color: var(--text-secondary);">
                            <p><strong>Amount Secured:</strong> $${amount}</p>
                            <p><strong>Talent:</strong> ${talentName}</p>
                            <p><strong>Project ID:</strong> ${projectId}</p>
                            <p><strong>Status:</strong> Funds held in escrow</p>
                        </div>
                    </div>

                    <div style="background: rgba(0, 212, 255, 0.1); border-radius: 10px; padding: 1.5rem; margin-bottom: 2rem; text-align: left;">
                        <h4 style="color: var(--accent-color); margin-bottom: 1rem;"> Next Steps</h4>
                        <ol style="color: var(--text-secondary); margin: 0; padding-left: 1.5rem;">
                            <li>Talent will be notified of secured payment</li>
                            <li>Work will begin once talent accepts the project</li>
                            <li>You'll approve work when delivered</li>
                            <li>Funds automatically release to talent</li>
                        </ol>
                    </div>

                    <div style="display: flex; gap: 1rem;">
                        <button class="btn btn-secondary" onclick="this.closest('.escrow-confirmation-modal').remove(); document.body.style.overflow = ''" style="flex: 1;">
                            <i class="fas fa-check"></i>
                            Got It
                        </button>
                        <button class="btn btn-primary" onclick="showPage('messages'); this.closest('.escrow-confirmation-modal').remove(); document.body.style.overflow = ''" style="flex: 1;">
                            <i class="fas fa-comments"></i>
                            View Messages
                        </button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            document.body.style.overflow = 'hidden';
        }

        // Milestone payment setup
        function setupMilestonePayment(projectId, totalAmount) {
            const modal = document.createElement('div');
            modal.className = 'milestone-setup-modal';
            modal.style.cssText = `
                position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
                background: rgba(0, 0, 0, 0.8); z-index: 1004; 
                backdrop-filter: blur(10px); display: flex; 
                align-items: center; justify-content: center; padding: 2rem;
            `;
            
            modal.innerHTML = `
                <div class="glass-card" style="max-width: 700px; width: 100%; margin: 0 1rem; max-height: 80vh; overflow-y: auto;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                        <h3 style="color: var(--accent-color); margin: 0;"> Set Up Milestone Payments</h3>
                        <button onclick="this.closest('.milestone-setup-modal').remove(); document.body.style.overflow = ''" 
                                style="background: none; border: none; color: var(--text-secondary); font-size: 1.5rem; cursor: pointer;"></button>
                    </div>
                    
                    <div style="background: rgba(0, 212, 255, 0.1); border-radius: 10px; padding: 1.5rem; margin-bottom: 2rem;">
                        <h4 style="color: var(--accent-color); margin-bottom: 1rem;"> How Milestone Payments Work</h4>
                        <ul style="color: var(--text-secondary); margin: 0; font-size: 0.9rem;">
                            <li>Break your project into phases with separate payments</li>
                            <li>Each milestone requires approval before payment</li>
                            <li>Reduces upfront payment while ensuring talent security</li>
                            <li>Perfect for larger or complex projects</li>
                        </ul>
                    </div>
                    
                    <form id="milestone-form">
                        <div id="milestones-container">
                            <div class="milestone-item" style="background: rgba(102, 126, 234, 0.1); border-radius: 10px; padding: 1.5rem; margin-bottom: 1rem;">
                                <h4 style="color: var(--accent-color); margin-bottom: 1rem;">Milestone 1</h4>
                                <div class="form-grid">
                                    <div class="form-group">
                                        <label class="form-label">Description</label>
                                        <input type="text" name="milestone1_desc" class="form-input" placeholder="e.g., Script review and voice sample" required>
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">Payment Amount ($)</label>
                                        <input type="number" name="milestone1_amount" class="form-input" placeholder="${Math.round(totalAmount * 0.5)}" min="1" required>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div style="text-align: center; margin-bottom: 2rem;">
                            <button type="button" class="btn btn-secondary" onclick="addMilestone(${totalAmount})">
                                <i class="fas fa-plus"></i>
                                Add Another Milestone
                            </button>
                        </div>
                        
                        <div style="display: flex; gap: 1rem;">
                            <button type="button" class="btn btn-secondary" style="flex: 1;" 
                                    onclick="this.closest('.milestone-setup-modal').remove(); document.body.style.overflow = ''">
                                Cancel
                            </button>
                            <button type="submit" class="btn btn-primary" style="flex: 2;">
                                <i class="fas fa-credit-card"></i>
                                Set Up Milestone Payments
                            </button>
                        </div>
                    </form>
                </div>
            `;
            
            document.body.appendChild(modal);
            document.body.style.overflow = 'hidden';
            
            let milestoneCount = 1;
            window.addMilestone = function(totalAmount) {
                milestoneCount++;
                const container = document.getElementById('milestones-container');
                const newMilestone = document.createElement('div');
                newMilestone.className = 'milestone-item';
                newMilestone.style.cssText = 'background: rgba(102, 126, 234, 0.1); border-radius: 10px; padding: 1.5rem; margin-bottom: 1rem;';
                newMilestone.innerHTML = `
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                        <h4 style="color: var(--accent-color); margin: 0;">Milestone ${milestoneCount}</h4>
                        <button type="button" onclick="this.closest('.milestone-item').remove()" 
                                style="background: var(--warning-color); border: none; color: white; padding: 0.3rem 0.8rem; border-radius: 5px; cursor: pointer;">
                            Remove
                        </button>
                    </div>
                    <div class="form-grid">
                        <div class="form-group">
                            <label class="form-label">Description</label>
                            <input type="text" name="milestone${milestoneCount}_desc" class="form-input" placeholder="e.g., First revision completed" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Payment Amount ($)</label>
                            <input type="number" name="milestone${milestoneCount}_amount" class="form-input" placeholder="${Math.round(totalAmount * 0.3)}" min="1" required>
                        </div>
                    </div>
                `;
                container.appendChild(newMilestone);
            };
            
            modal.querySelector('#milestone-form').addEventListener('submit', async function(e) {
                e.preventDefault();
                
                try {
                    const formData = new FormData(this);
                    const milestones = [];
                    
                    for (let i = 1; i <= milestoneCount; i++) {
                        const desc = formData.get(`milestone${i}_desc`);
                        const amount = formData.get(`milestone${i}_amount`);
                        if (desc && amount) {
                            milestones.push({ description: desc, amount: parseFloat(amount) });
                        }
                    }
                    
                    await apiCall('/api/payments/milestones/create', {
                        method: 'POST',
                        body: JSON.stringify({
                            projectId: projectId,
                            milestones: milestones,
                            clientId: currentUser.id
                        })
                    });
                    
                    showNotification(' Milestone payments set up successfully!', 'success');
                    modal.remove();
                    document.body.style.overflow = '';
                    closePaymentModal();
                    
                } catch (error) {
                    showNotification(' Failed to set up milestones. Please try again.', 'error');
                }
            });
        }

        // Report suspicious behavior
        function reportSuspiciousBehavior(projectId, participantId, reason) {
            const modal = document.createElement('div');
            modal.className = 'report-modal';
            modal.style.cssText = `
                position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
                background: rgba(0, 0, 0, 0.8); z-index: 1003; 
                backdrop-filter: blur(10px); display: flex; 
                align-items: center; justify-content: center; padding: 2rem;
            `;
            
            modal.innerHTML = `
                <div class="glass-card" style="max-width: 500px; width: 100%; margin: 0 1rem;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                        <h3 style="color: var(--warning-color); margin: 0;"> Report Suspicious Behavior</h3>
                        <button onclick="this.closest('.report-modal').remove(); document.body.style.overflow = ''" 
                                style="background: none; border: none; color: var(--text-secondary); font-size: 1.5rem; cursor: pointer;"></button>
                    </div>
                    
                    <form id="report-form">
                        <div style="margin-bottom: 1rem;">
                            <label style="display: block; margin-bottom: 0.5rem; color: var(--text-primary);">Reason for Report:</label>
                            <select class="form-select" name="reason" required>
                                <option value="">Select a reason</option>
                                <option value="requesting_personal_info">Requesting personal contact information</option>
                                <option value="sharing_personal_info">Sharing personal contact information</option>
                                <option value="external_communication">Trying to move communication off-platform</option>
                                <option value="inappropriate_behavior">Inappropriate or unprofessional behavior</option>
                                <option value="spam">Spam or repetitive messages</option>
                                <option value="other">Other</option>
                            </select>
                        </div>
                        
                        <div style="margin-bottom: 1.5rem;">
                            <label style="display: block; margin-bottom: 0.5rem; color: var(--text-primary);">Additional Details:</label>
                            <textarea class="form-textarea" name="details" rows="3" 
                                      placeholder="Please provide specific details about the concerning behavior..."></textarea>
                        </div>
                        
                        <div style="display: flex; gap: 1rem;">
                            <button type="button" class="btn btn-secondary" style="flex: 1;" 
                                    onclick="this.closest('.report-modal').remove(); document.body.style.overflow = ''">
                                Cancel
                            </button>
                            <button type="submit" class="btn" style="background: var(--warning-color); color: white; flex: 1;">
                                Submit Report
                            </button>
                        </div>
                    </form>
                </div>
            `;
            
            document.body.appendChild(modal);
            document.body.style.overflow = 'hidden';
            
            modal.querySelector('#report-form').addEventListener('submit', async function(e) {
                e.preventDefault();
                const formData = new FormData(this);
                
                try {
                    await apiCall('/api/reports', {
                        method: 'POST',
                        body: JSON.stringify({
                            projectId: projectId,
                            reportedUserId: participantId,
                            reason: formData.get('reason'),
                            details: formData.get('details'),
                            reportType: 'communication_violation'
                        })
                    });
                    
                    showNotification(' Report submitted successfully. Our team will review it.', 'success');
                    modal.remove();
                    document.body.style.overflow = '';
                    
                } catch (error) {
                    showNotification(' Failed to submit report. Please try again.', 'error');
                }
            });
        }

        // Initialize platform policy reminders
        function initializePlatformSafeguards() {
            // Show reminder when messages page is first visited
            const messagesPage = document.getElementById('messages');
            if (messagesPage) {
                const observer = new MutationObserver(function(mutations) {
                    mutations.forEach(function(mutation) {
                        if (mutation.target.classList.contains('active')) {
                            setTimeout(() => {
                                showPlatformPolicyReminder();
                            }, 2000);
                        }
                    });
                });
                
                observer.observe(messagesPage, { attributes: true, attributeFilter: ['class'] });
            }
        }

        // Show platform policy reminder
        function showPlatformPolicyReminder() {
            const reminder = document.createElement('div');
            reminder.className = 'policy-reminder';
            reminder.style.cssText = `
                position: fixed; top: 20px; right: 20px; 
                background: rgba(0, 212, 255, 0.9); color: white; 
                padding: 1rem 1.5rem; border-radius: 10px; z-index: 1001;
                max-width: 350px; box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
                animation: slideInRight 0.3s ease;
            `;
            
            reminder.innerHTML = `
                <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 0.5rem;">
                    <strong> Platform Policy</strong>
                    <button onclick="this.parentElement.parentElement.remove()" 
                            style="background: none; border: none; color: white; cursor: pointer; font-size: 1.2rem; line-height: 1;"></button>
                </div>
                <div style="font-size: 0.9rem; line-height: 1.4;">
                    Keep all communication on VoicecastingPro for your protection and the best user experience.
                </div>
            `;
            
            document.body.appendChild(reminder);
            
            // Auto-remove after 8 seconds
            setTimeout(() => {
                if (reminder.parentNode) {
                    reminder.remove();
                }
            }, 8000);
        }

// Override showPage to load conversations for messages page
                  const originalShowPage = window.showPage;
            window.showPage = function(pageId) {
                originalShowPage(pageId);
                if (pageId === 'messages') {
                    setTimeout(loadConversations, 500);
                }
            };

        // Back to Top Button Functionality
        function scrollToTop() {
            window.scrollTo({
                top: 0,
                behavior: 'smooth'
            });
        }

        // Show/hide back to top button based on scroll position
        window.addEventListener('scroll', function() {
            const backToTopBtn = document.getElementById('back-to-top');
            
            if (window.pageYOffset > 300) {
                backToTopBtn.classList.add('show');
            } else {
                backToTopBtn.classList.remove('show');
            }
        });

        // Initialize back to top button state
        document.addEventListener('DOMContentLoaded', function() {
            const backToTopBtn = document.getElementById('back-to-top');
            if (window.pageYOffset <= 300) {
                backToTopBtn.classList.remove('show');
            }
        });
    </script>

    <!-- Back to Top Button -->
    <button id="back-to-top" onclick="scrollToTop()" title="Back to Top" style="
        position: fixed;
        bottom: 30px;
        right: 30px;
        width: 60px;
        height: 60px;
        background: var(--primary-gradient);
        border: none;
        border-radius: 50%;
        color: white;
        font-size: 1.5rem;
        cursor: pointer;
        box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
        z-index: 1000;
        opacity: 0;
        visibility: hidden;
        transform: translateY(20px);
        transition: all 0.3s ease;
        backdrop-filter: blur(10px);
    ">
        <i class="fas fa-chevron-up"></i>
    </button>
</body>
</html>